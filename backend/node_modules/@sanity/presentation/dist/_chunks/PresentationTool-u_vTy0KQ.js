import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{applySourceDocuments as r,studioPath as i}from"@sanity/client/csm";import{Card as o,Flex as a,Container as s,Stack as c,Text as d,Inline as l,Box as u,Button as p,Code as h,Label as f,ErrorBoundary as m,TextInput as v,Switch as g,usePrefersReducedMotion as w,TooltipDelayGroupProvider as y,Tooltip as b,MenuButton as S,Menu as k,MenuItem as x,Spinner as P,useToast as I,BoundaryElementProvider as E}from"@sanity/ui";import{useContext as z,forwardRef as C,useCallback as D,useMemo as $,useState as U,useEffect as L,useSyncExternalStore as j,createContext as _,memo as O,useLayoutEffect as M,useRef as T,createElement as R,startTransition as N}from"react";import{useUnique as W,getPublishedId as A,useEditState as K,useClient as F,useActiveWorkspace as q,Hotkeys as J,useCurrentUser as B,useProjectId as V,useDataset as G}from"sanity";import{StateLink as Q,useRouter as H}from"sanity/router";import X from"styled-components";import{P as Z,L as Y,a as ee,b as te,M as ne,A as re,c as ie,D as oe}from"./index-kKxp98ju.js";import{PaneRouterContext as ae,PaneLayout as se,DeskToolProvider as ce,DocumentListPane as de,useDeskTool as le,DocumentPane as ue}from"sanity/desk";import{unstable__getDocumentCacheKey as pe,unstable__documentsCache as he}from"@sanity/groq-store";import{applyPatch as fe}from"mendoza";import{ResetIcon as me,LaunchIcon as ve,PanelLeftIcon as ge,RefreshIcon as we,ShareIcon as ye,ChevronDownIcon as be,CheckmarkIcon as Se,DesktopIcon as ke,MobileDeviceIcon as xe,CopyIcon as Pe,EditIcon as Ie,PublishIcon as Ee,DatabaseIcon as ze}from"@sanity/icons";import{createPreviewSecret as Ce}from"@sanity/preview-url-secret/create-secret";import{withoutSecretSearchParams as De,hasSecretSearchParams as $e,setSecretSearchParams as Ue}from"@sanity/preview-url-secret/without-secret-search-params";import{motion as Le,MotionConfig as je,AnimatePresence as _e}from"framer-motion";import Oe from"lodash.isequal";import{definePreviewUrl as Me}from"@sanity/preview-url-secret/define-preview-url";import{suspend as Te}from"suspend-react";let Re;const Ne=new Uint8Array(16);function We(){if(!Re&&(Re="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Re))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Re(Ne)}const Ae=[];for(let e=0;e<256;++e)Ae.push((e+256).toString(16).slice(1));var Ke={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Fe(e,t,n){if(Ke.randomUUID&&!t&&!e)return Ke.randomUUID();const r=(e=e||{}).random||(e.rng||We)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return Ae[e[t+0]]+Ae[e[t+1]]+Ae[e[t+2]]+Ae[e[t+3]]+"-"+Ae[e[t+4]]+Ae[e[t+5]]+"-"+Ae[e[t+6]]+Ae[e[t+7]]+"-"+Ae[e[t+8]]+Ae[e[t+9]]+"-"+Ae[e[t+10]]+Ae[e[t+11]]+Ae[e[t+12]]+Ae[e[t+13]]+Ae[e[t+14]]+Ae[e[t+15]]}(r)}const qe=1e3,Je=1e3,Be=500,Ve=["handshake/syn","handshake/syn-ack","handshake/ack"],Ge=e=>Ve.some((t=>t===e)),Qe=({data:e={}})=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&!("domain"in e)&&["id","type","from","to"].every((t=>t in e))&&e.type.startsWith("handshake/");function He(e){const t=e.target,n=e.connectTo.map((e=>({buffer:[],config:e,id:"",handler:i,status:"connecting",interval:void 0,heartbeat:void 0})));function r(e){window.clearInterval(e.interval)}function i(e){const{data:t}=e;if(Ge(t.type)){const e=n.find((e=>e.config.id===t.from));e&&"handshake/syn-ack"===t.type&&(c(e,"connected"),d(e,"handshake/ack",{id:e.id}))}}const o=t=>{const{data:r}=t;if(!Ge(r.type)&&n.find((e=>e.id===r.connectionId))){const t=n.find((e=>e.config.id===r.from));if(t){const n=[r.type,r.data];t.config.onEvent?.(...n),e.onEvent?.(...n),l(t,"channel/response",{responseTo:r.id},!1)}}};function a(t){if(Qe(t))console.error("Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\nhttps://github.com/sanity-io/visual-editing");else if(function(t){const{data:r,origin:i}=t;return"sanity/channels"===r.domain&&r.to==e.id&&n.map((e=>e.config.id)).includes(r.from)&&"channel/response"!==r.type&&i===e.targetOrigin}(t)){const{data:e}=t;n.find((t=>t.config.id===e.from))?.handler(t)}}function s(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function c(t,n){t.status=n,t.config.onStatusUpdate?.(n,t.config.id),e.onStatusUpdate?.(n,t.config.id),"connecting"===n||"reconnecting"===n?(t.handler=i,s(t),function(e){e.id=Fe(),e.interval=window.setInterval((()=>{d(e,"handshake/syn",{id:e.id})}),Be)}(t)):"connected"===n?(t.handler=o,r(t),function(e){if(s(e),e.config.heartbeat){const t="number"==typeof e.config.heartbeat?e.config.heartbeat:Je;e.heartbeat=window.setInterval((()=>{l(e,"channel/heartbeat")}),t)}}(t),function(e){const t=[...e.buffer];e.buffer.splice(0,e.buffer.length),t.forEach((({type:t,data:n})=>{l(e,t,n)}))}(t)):"disconnected"===n&&(t.id=null,t.handler=i,r(t),s(t))}function d(n,r,i){if(!n.id)throw new Error("No channel ID set");const o={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:Fe(),to:n.config.id,type:r};try{t?.postMessage(o,{targetOrigin:"*"})}catch(t){throw new Error(`Failed to postMessage '${o.id}' on '${e.id}'`)}}function l(n,r,i,o=!0){const a=Fe();if("connecting"===n.status||"reconnecting"===n.status||"disconnected"===n.status)return void n.buffer.push({type:r,data:i});if(!n.id)throw new Error("No channel ID set");const s={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:a,to:n.config.id,type:r};if(o){const t=setTimeout((()=>{s.connectionId===n.id&&(window.removeEventListener("message",o,!1),"channel/heartbeat"!==r&&n.buffer.push({type:r,data:i}),c(n,"reconnecting"),console.warn(`Received no response to message '${s.type}' on client '${e.id}' (ID: '${s.id}').`))}),qe),o=e=>{const{data:n}=e;"channel/response"===n.type&&n.data?.responseTo&&n.data.responseTo===s.id&&(window.removeEventListener("message",o,!1),clearTimeout(t))};window.addEventListener("message",o,!1)}try{t?.postMessage(s,{targetOrigin:e.targetOrigin})}catch(t){throw new Error(`Failed to postMessage '${s.id}' on client '${e.id}'`)}}return window.addEventListener("message",a,!1),n.forEach((e=>{c(e,"connecting")})),{destroy:function(){n.forEach((e=>{["disconnected"].includes(e.status)||(l(e,"channel/disconnect",{id:e.id},!1),c(e,"disconnected"))})),window.removeEventListener("message",a,!1),n.forEach((e=>{s(e),r(e)}))},send:function(e,t,r){(e?Array.isArray(e)?[...e]:[e]:n).forEach((e=>{const i=n.find((t=>t.config.id===e));if(!i)throw new Error("Invalid channel ID");l(i,t,r)}))}}}function Xe(e){return null!==e&&Array.isArray(e)}const Ze=/^([A-Za-z]+):([0-9]+)$/,Ye=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,et=/^([A-Za-z]+):([a-z0-9]+)$/;const tt={alt:"altKey",ctrl:"ctrlKey",mod:"undefined"!=typeof window&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function nt(e,t){return e.every((e=>tt[e]?t[tt[e]]:t.key===e.toUpperCase()))}function rt(e){return"Alt"===e.key}function it(n){const{children:r,message:i,onRetry:h,onContinueAnyway:f,...m}=n,v=e(p,{fontSize:1,mode:"ghost",onClick:h,text:"Retry"}),g=e(p,{fontSize:1,mode:"ghost",tone:"critical",onClick:f,text:"Continue anyway"});return e(o,{height:"fill",...m,children:e(a,{align:"center",height:"fill",justify:"center",children:e(s,{padding:4,sizing:"border",width:0,children:t(c,{space:4,children:[t(c,{space:3,children:[e(d,{size:1,weight:"semibold",children:"An error occured"}),e(d,{muted:!0,size:1,children:i})]}),r,h&&f?t(l,{space:2,children:[v,g]}):h?e(u,{children:v}):f?e(u,{children:g}):null]})})})})}function ot(){const e=z(Z);if(!e)throw new Error("Presentation context is missing");return e}function at(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(e={}){const t=Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&");return t.length?`?${t}`:""}(Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>null==n?e:{...e,[t]:n}),{}))}const st=C((function(t,n){const{deskParams:r,params:i}=ot();return e(Q,{...t,ref:n,state:{type:void 0,_searchParams:Object.entries({...r,preview:i.preview})},title:void 0})})),ct=C((function(t,n){const{documentId:r,documentType:i,...o}=t;return e(Q,{...o,ref:n,state:{id:r,type:i},title:void 0})}));function dt(t){const{children:r,params:i,onDeskParams:o,previewUrl:a,refs:s}=t,{state:c,resolvePathFromState:d}=H(),l=W(Object.fromEntries(c._searchParams||[])),u=D((e=>`${d(c)}${at({...l,...e})}`),[d,l,c]),p=$((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:i,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:t=>{const{childId:n,...r}=t,i=s?.find((e=>A(e._id)===n));return i?e(Q,{...r,state:{id:i._id,type:i._type,_searchParams:Object.entries({preview:a})}}):e("div",{...r})},BackLink:st,ReferenceChildLink:ct,ParameterizedLink:()=>e(n,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{o({...e,inspect:e.inspect??void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,t,n)=>{console.warn("navigateIntent",e,t,n)},createPathWithParams:u})),[u,o,i,a,s]);return e(ae.Provider,{value:p,children:r})}const lt=X(se)`
  height: 100%;
`,ut=X(a)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,pt=X(h)`
  white-space: pre-wrap;
`;function ht(n){const{onDeskParams:r,previewUrl:i,refs:a}=n,{devMode:s}=ot(),d=$((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:a.map((e=>e._id))}},schemaTypeName:"",title:"Documents on this page",type:"documentList"})),[a]),[l,u]=U(null),p=D((()=>u(null)),[]),h=$((()=>({})),[]);return L((()=>u(null)),[a]),l?e(it,{flex:1,message:"Could not render the document list",onRetry:p,children:s&&e(o,{overflow:"auto",padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(f,{muted:!0,size:0,children:"Error message"}),e(pt,{size:1,children:l.error.message})]})})}):e(m,{onCatch:u,children:e(lt,{children:e(ce,{children:e(dt,{params:h,onDeskParams:r,previewUrl:i,refs:a,children:e(ut,{direction:"column",flex:1,children:e(de,{index:0,itemId:"$root",pane:d,paneKey:"$root"})})})})})})}function ft(t){const{onDeskParams:n,previewUrl:r,refs:i}=t;return e(ht,{onDeskParams:n,previewUrl:r,refs:i})}const mt=X(h)`
  white-space: pre-wrap;
`;function vt(n){const{documentId:r,documentType:i,params:a,onDeskParams:s,onFocusPath:d}=n,{devMode:l}=ot(),u=$((()=>({id:r,options:{id:r,type:i},title:"",type:"document"})),[r,i]),[p,h]=U(null),v=D((()=>h(null)),[]);L((()=>{h(null)}),[r,i,a]);const{setLayoutCollapsed:g}=le(),w=D((()=>g(!0)),[g]),y=D((()=>g(!1)),[g]);return p?e(it,{flex:1,message:"Could not render the document editor",onRetry:v,children:l&&e(o,{overflow:"auto",padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(f,{muted:!0,size:0,children:"Error message"}),e(mt,{size:1,children:p.error.message})]})})}):e(m,{onCatch:h,children:e(se,{style:{height:"100%"},onExpand:y,onCollapse:w,children:e(dt,{onDeskParams:s,params:a,children:e(ue,{paneKey:"document",index:1,itemId:"document",pane:u,onFocusPath:d})})})})}function gt(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a,onDocumentChange:s}=t,c=K(r,i),d=c.draft||c.published;L((()=>s(d)),[d,s]);const l=D((e=>{d?._id&&a(d._id,e)}),[d,a]);return e(ce,{children:e(vt,{documentId:r,documentType:i,params:n,onDeskParams:o,onFocusPath:l})})}function wt(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a,onDocumentChange:s,previewUrl:c,refs:d}=t;return r&&i?e(gt,{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a,onDocumentChange:s}):e(ft,{onDeskParams:o,previewUrl:c,refs:d})}function yt(e){return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)}const bt=_(null);_(null);const St=_(!1);let kt=!1;function xt(e,t,n,i,o,a){if("raw"===o)throw new Error("turboChargeResultIfSourceMap does not support raw perspective");return r(i,a,(r=>{if(r._projectId)return void(kt||(console.warn("Cross dataset references are not supported yet, ignoring source document",r),kt=!0));if(e?._id===r._id&&e?._type===r._type)return e;const i=pe({projectId:t,dataset:n,perspective:o},r);return he.get(i)}),((e,{previousValue:t})=>"number"==typeof e&&"string"==typeof t?`${e}`:e))}function Pt(e,t,n){return`${e}-${t}-${JSON.stringify(n)}`}const It=O((function(n){const{liveDocument:r,children:i,client:o,refreshInterval:a=2e3,perspective:s}=n;if("raw"===s)throw new Error("LiveStoreProvider does not support the raw perspective");const[c,d]=U([]),[l]=U((()=>new Map)),u=function(e){const[t]=U((()=>new Map)),n=D(((n,r,i,o,a)=>{t.has(n)||(t.set(n,{perspective:r,query:i,params:o,listeners:new Set}),e((e=>e.includes(n)?e:[...e,n])));const s=t.get(n);if(!s||!s.listeners)throw new TypeError("Inconsistent cache for key: "+n);const{listeners:c}=s;return c.add(a),()=>{c.delete(a),0===c.size&&(t.delete(n),e((e=>e.includes(n)?e.filter((e=>e!==n)):e)))}}),[t,e]);return $((()=>({cache:t,subscribe:n})),[t,n])}(d),[p]=U((()=>function(e,t,n){const r=Pt(s,t,n);return{subscribe:e=>{const i=u.subscribe(r,s,t,n,e);return()=>i()},getSnapshot:()=>l.get(r)}})),[h,f]=U([]),m=D((e=>{const t=new Set;if(e.documents?.length)for(const{_id:n}of e.documents)t.add(n);f((e=>{const n=Array.from(new Set([...e,...t]));return JSON.stringify(n.sort())===JSON.stringify(e.sort())?e:n}))}),[]);return t(bt.Provider,{value:p,children:[e(St.Provider,{value:!0,children:i}),e(Ct,{liveDocument:r,cache:u.cache,client:o,setTurboIds:f,snapshots:l,turboIds:h,perspective:s}),c.map((t=>{if(!u.cache.has(t))return null;const{query:n,params:i,listeners:c}=u.cache.get(t);return e(zt,{liveDocument:r,client:o,listeners:c,params:i,query:n,refreshInterval:a,snapshots:l,turboIdsFromSourceMap:m,perspective:s},t)}))]})}));It.displayName="LiveStoreProvider";var Et=It;const zt=O((function(e){const{liveDocument:t,client:n,refreshInterval:r,query:i,params:o,listeners:a,snapshots:s,turboIdsFromSourceMap:c,perspective:d}=e,{projectId:l,dataset:u}=$((()=>{const{projectId:e,dataset:t}=n.config();return{projectId:e,dataset:t}}),[n]),[p,h]=U(null);if(p)throw p;const[f,m]=function(e){const{refreshInterval:t}=e,n=function(){const[e,t]=U(!1);L((()=>{t(navigator.onLine);const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e),window.addEventListener("offline",n),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}),[]);const n=j(yt,(()=>document.visibilityState),(()=>"hidden"));return!e||"hidden"===n}(),[r,i]=U("hit"),o=D((()=>(i("inflight"),()=>i("hit"))),[]);return L((()=>{if(!t||"hit"!==r)return;const e=setTimeout((()=>i("stale")),t);return()=>clearTimeout(e)}),[t,r]),L((()=>{if("hit"!==r)return;const e=()=>i("stale");return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)}),[t,r]),L((()=>{n&&"hit"===r&&i("stale"),n||"stale"!==r||i("refresh")}),[n,r]),[r,o]}({refreshInterval:r}),v="refresh"===f||"inflight"===f;return L((()=>{if(!v)return;let e=!1,r=!1;const p=new AbortController;const f=m();return async function(){const{signal:h}=p;r=!0;const{result:f,resultSourceMap:m}=await n.fetch(i,o,{tag:"presentation-loader",signal:h,perspective:d,filterResponse:!1});if(r=!1,!h.aborted){s.set(Pt(d,i,o),{result:m?xt(t,l,u,f,d,m):f,resultSourceMap:m}),m&&c(m);for(const e of a.values())e();e=!0}}().catch((e=>{r=!1,"AbortError"!==e.name&&h(e)})).finally(f),()=>{e||r||p.abort()}}),[t,n,u,a,o,l,i,v,s,m,c,d]),null}));zt.displayName="QuerySubscription";const Ct=O((function(t){const{liveDocument:r,client:i,snapshots:o,cache:a,turboIds:s,setTurboIds:c,perspective:d}=t,{projectId:l,dataset:u}=$((()=>{const{projectId:e,dataset:t}=i.config();return{projectId:e,dataset:t}}),[i]);L((()=>{const e=new Set;for(const{perspective:t,query:n,params:r}of a.values()){const i=Pt(t,n,r),a=o.get(i);if(a&&a.resultSourceMap?.documents?.length)for(const{_id:t}of a.resultSourceMap.documents)e.add(t)}const t=[...e].sort();JSON.stringify(s)!==JSON.stringify(t)&&c(t)}),[a,c,o,s]);const[p,h]=U([]);L((()=>{const e=new Set(p.flat()),t=new Set;for(const n of s)e.has(n)||he.has(pe({projectId:l,dataset:u,perspective:d},{_id:n}))||t.add(n);const n=[...t].slice(0,Y);0!==n.length&&h((e=>[...e.slice(-Y),n]))}),[p,u,d,l,s]);const[f,m]=U();L((()=>{const e=i.listen("published"===d?'*[!(_id in path("drafts.**"))]':'*[_id in path("drafts.**")]',{},{events:["mutation"],effectFormat:"mendoza",includePreviousRevision:!1,includeResult:!1,tag:"presentation-loader"}).subscribe((e=>{if("mutation"!==e.type||!e.effects?.apply?.length)return;const t=pe({projectId:l,dataset:u,perspective:d},{_id:e.documentId}),n=he.peek(t);if(n){const r={...n};delete r._rev;const i=fe(r,e.effects.apply);he.set(t,i)}m(e.documentId)}));return()=>e.unsubscribe()}),[i,u,d,l]),L((()=>{if(!f||!s.includes(f))return;const e=[];for(const[t,n]of o.entries())n.resultSourceMap?.documents?.length&&(n.result=xt(r,l,u,n.result,d,n.resultSourceMap),e.push(t));for(const t of e){const e=a.get(t)?.listeners;if(e)for(const t of e)t()}m(void 0)}),[r,a,u,f,d,l,o,s]);const[v,g]=U();return L((()=>{if(!v)return;const e=[];for(const[t,n]of o.entries())n.resultSourceMap?.documents?.length&&(n.result=xt(r,l,u,n.result,d,n.resultSourceMap),e.push(t));for(const t of e){const e=a.get(t)?.listeners;if(e)for(const t of e)t()}}),[a,u,r,v,d,l,o]),L((()=>{r&&g(r._rev)}),[r]),e(n,{children:p.map((t=>e(Dt,{client:i,projectId:l,dataset:u,ids:t,perspective:d},JSON.stringify(t))))})}));Ct.displayName="Turbo";const Dt=O((function(e){const{client:t,projectId:n,dataset:r,ids:i,perspective:o}=e;return L((()=>{const e=i.filter((e=>!he.has(pe({projectId:n,dataset:r,perspective:o},{_id:e}))));0!==e.length&&t.getDocuments(e).then((e=>{for(const t of e)t&&t?._id&&he.set(pe({projectId:n,dataset:r,perspective:o},t),t)}),console.error)}),[t,r,i,o,n]),null}));function $t(e,t,n){const r=z(bt);if(!r)throw new Error("useLiveQuery must be used inside a <LiveQueryProvider />");const i=function(e){const t=$((()=>JSON.stringify(e||{})),[e]);return $((()=>JSON.parse(t)),[t])}(n),o=$((()=>r(e,t,i)),[r,e,i,t]),[a]=U((()=>{if(void 0===e)throw new Error("initialSnapshot can't be undefined, if you don't want an initial value use null instead");try{return JSON.parse(JSON.stringify(e))}catch(t){return console.warn("Failed to deep clone initialSnapshot, this is likely an error and an indication that the snapshot isn't JSON serializable",{initialSnapshot:e,error:t}),e}})),s=D((()=>a),[a]);return j(o.subscribe,o.getSnapshot,s)}function Ut(t){const{activePerspective:n,liveDocument:r,channel:i,perspective:o,liveQueries:a}=t,s=F({apiVersion:"2023-10-16"}),c=$((()=>s.config()),[s]),d=$((()=>s.withConfig({perspective:o,resultSourceMap:"withKeyArraySelector"})),[o,s]);return L((()=>{if(i&&n){const{projectId:e,dataset:t}=c;i.send("loaders","loader/perspective",{projectId:e,dataset:t,perspective:o})}}),[n,i,c,o]),e(Et,{liveDocument:r,client:d,perspective:o,refreshInterval:n?2e3:0,children:Object.entries(a).map((([t,{query:n,params:r}])=>e(Lt,{projectId:c.projectId,dataset:c.dataset,perspective:o,query:n,params:r,channel:i},`${t}${o}`)))})}function Lt(e){const{projectId:t,dataset:n,perspective:r,query:i,params:o,channel:a}=e,s=$t(null,i,o),c=s?.result,d=s?.resultSourceMap;return L((()=>{d&&a.send("loaders","loader/query-change",{projectId:t,dataset:n,perspective:r,query:i,params:o,result:c,resultSourceMap:d})}),[a,n,o,r,t,i,c,d]),null}Dt.displayName="GetDocuments";const jt=_(null);jt.displayName="PanelsContext";const _t=X.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,Ot=function({children:t,defaultSize:n=null,id:r,minWidth:i,maxWidth:o,order:a=0}){const s=z(jt);if(null===s)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:c,registerElement:d,unregisterElement:l}=s,u=c(r);return M((()=>(d(r,{id:r,type:"panel",defaultSize:n,maxWidth:o??null,minWidth:i??0,order:a}),()=>{l(r)})),[r,n,a,o,i,d,l]),e(_t,{style:u,children:t})};const Mt=X.div`
  position: relative;
`,Tt=X.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-border-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  "}
`,Rt=function({id:n,order:r,disabled:i=!1}){const o=T(null),a=z(jt);if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const s=function(e){return T(e||Fe()).current}(n),{activeResizer:c,drag:d,startDragging:l,stopDragging:u,registerElement:p,unregisterElement:h}=a,f=c===s;if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const m=D((e=>{l(s,e.nativeEvent)}),[s,l]),v=D((e=>{d(s,e)}),[s,d]),g=D((()=>{o.current.blur(),u()}),[u]);return L((()=>{if(f&&!i)return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g)}}),[i,f,v,g]),M((()=>(p(s,{id:s,order:r,type:"resizer",el:o}),()=>{h(s)})),[s,r,p,h]),e(Mt,{onMouseDown:m,ref:o,children:t(Tt,{$disabled:i,children:[e("span",{}),e("span",{})]})})};function Nt(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(e,r)}),t)}}const Wt="presentation/panels",At=()=>JSON.parse(localStorage.getItem(Wt)||"{}"),Kt=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function Ft(){return $((()=>{const e=(e,t)=>{(e=>{localStorage.setItem(Wt,JSON.stringify(e))})({...At(),[Kt(e)]:t})};return{get:e=>At()[Kt(e)],set:e,setDebounced:Nt(e,100)}}),[])}function qt(e,t,n){const{maxWidth:r,minWidth:i}=e,o=null==r?100:r/n*100,a=i/n*100;return Math.min(o,Math.max(a,t))}function Jt(e,t,n){if(1===e.length)return"100";const r=n[e.findIndex((e=>e.id===t))];return null==r?"0":r.toPrecision(10)}function Bt(e,t,n=0,r=null){return e.clientX-(r||t.getBoundingClientRect()).left-n}function Vt(e){return"panel"===e.type}function Gt(e){return"resizer"===e.type}function Qt(e){return Array.from(e.values()).sort((({order:e},{order:t})=>null==e&&null==t?0:null==e?-1:null==t?1:e-t))}function Ht(e,t,n){const r=t.reduce(((e,t)=>e+t),0),i=[...t].map((e=>e/r*100));let o=0;for(let t=0;t<e.length;t++){const r=e[t],a=i[t],s=qt(r,a,n);a!=s&&(o+=a-s,i[t]=s)}if("0.000"!==o.toFixed(3))for(let t=0;t<e.length;t++){const r=e[t];let{maxWidth:a,minWidth:s}=r;s=s/n*100,null!=a&&(a=a/n*100);const c=Math.min(null!=a?a:100,Math.max(s,i[t]+o));if(c!==i[t]&&(o-=c-i[t],i[t]=c,"0.000"===Math.abs(o).toFixed(3)))break}return i}const Xt=X.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,Zt=function({children:t}){const n=T(null),[r,i]=U(new Map),o=$((()=>Qt(r).filter(Vt)),[r]),[a,s]=U([]),[c,d]=U(null),l=T({elements:r,panels:o,widths:a}),u=D((e=>({flexGrow:Jt(o,e,a),pointerEvents:null===c?void 0:"none"})),[c,o,a]),p=D(((e,t)=>{i((n=>{if(n.has(e))return n;const r=new Map(n);return r.set(e,t),r}))}),[]),h=D((e=>{i((t=>{if(!t.has(e))return t;const n=new Map(t);return n.delete(e),n}))}),[]),f=T({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),m=D(((e,t)=>{const n=Qt(r),i=n.findIndex((t=>t.id===e)),o=r.get(e);if(!o||!Gt(o))return;const a=o.el.current;a&&(f.current={resizerIndex:i,panelBefore:n.reduce(((e,t,n)=>Vt(t)&&n<i?t:e),null),panelAfter:n.reduce(((e,t,n)=>null===e&&Vt(t)&&n>i?t:e),null),containerWidth:window.innerWidth,startX:t.pageX,dragOffset:Bt(t,a),resizerRect:a.getBoundingClientRect(),widths:l.current.widths},d(e))}),[r]),v=D((()=>{d(null)}),[]),g=D(((e,t)=>{t.preventDefault(),t.stopPropagation();const{containerWidth:i,dragOffset:o,panelBefore:a,panelAfter:c,resizerRect:d}=f.current;if(null==a||null==c)return;const u=r.get(e);if(!u||!Gt(u))return;const p=u.el.current;if(!p)return;const h=Bt(t,p,o,d);if(0===h)return;const{widths:m}=l.current,v=function(e,t,n,r,i,o){const{panels:a,widths:s}=i,{widths:c}=o,d=c||s,l=[...d];{const i=e<0?r:n,o=d[a.findIndex((e=>e.id===i.id))],s=qt(i,o+Math.abs(e),t);if(o===s)return d;e=e<0?o-s:s-o}let u=0,p=e<0?n:r,h=a.findIndex((e=>e.id===p.id));for(;;){const n=a[h],r=d[h],i=qt(n,r-(Math.abs(e)-Math.abs(u)),t);if(r!==i&&(u+=r-i,l[h]=i,u.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--h<0)break}else if(++h>=a.length)break}return 0===u?d:(p=e<0?r:n,h=a.findIndex((e=>e.id===p.id)),l[h]=d[h]+u,l)}(h/n.current.getBoundingClientRect().width*100,i,a,c,l.current,f.current),g=m.some(((e,t)=>e!==v[t]));g&&s(v)}),[r]);M((()=>{l.current.elements=r,l.current.panels=o,l.current.widths=a}),[r,o,a]);const w=Ft();M((()=>{const{widths:e}=l.current;if(e.length===o.length)return;const t=w.get(o);if(t){const e=Ht(o,t,window.innerWidth);return void s(e)}const n=function(e){let t=e.length,n=100;const r=e.map((e=>e.defaultSize?(n-=e.defaultSize,t-=1,e.defaultSize):null)),i=n/t;return r.map((e=>null===e?i:e))}(o);s(n)}),[w,o]),L((()=>{a.length&&w.setDebounced(o,a)}),[w,o,a]),M((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:t}=l.current,n=Ht(e,t,window.innerWidth),r=t.some(((e,t)=>e!==n[t]));r&&s(n)}));return e.observe(n.current),()=>{e.disconnect()}}),[]);const y=$((()=>({activeResizer:c,drag:g,getPanelStyle:u,registerElement:p,startDragging:m,stopDragging:v,unregisterElement:h})),[c,g,u,p,m,v,h]);return e(jt.Provider,{value:y,children:e(Xt,{ref:n,children:t})})};function Yt(e){const{id:t,type:n}=e;return K(t,n),null}const en=function(t){const{children:n,setParams:r}=t,i=D((e=>{r({preview:e})}),[r]),o=$((()=>i),[i]);return e(ee.Provider,{value:o,children:n})};function tn(t){const{unstable_navigator:r}=t,i=!!r?.component,[o,a]=function(e,t){const[n,r]=U((()=>JSON.parse(localStorage.getItem(e)??JSON.stringify(t))));return L((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,r]}("presentation/navigator",i),s=!!i&&o,c=$((()=>{if(i)return()=>a((e=>!e))}),[i,a]),d=D((function(){return e(n,{children:s&&e(nn,{...r})})}),[s,r]);return[{navigatorEnabled:s,toggleNavigator:c},d]}const nn=O((function(r){const{minWidth:i,maxWidth:o,component:a}=r,s=null!=i&&null!=o&&i===o;return t(n,{children:[e(Ot,{id:"navigator",minWidth:i,maxWidth:o,order:1,children:e(a,{})}),e(Rt,{order:2,disabled:s})]})})),rn=function(t){const{children:n,params:r}=t,i=$((()=>r),[r]);return e(te.Provider,{value:i,children:n})},on=function(t){const{children:n,deskParams:r,devMode:i,name:o,params:a,setParams:s}=t,c=$((()=>({deskParams:r,devMode:i,name:o,params:a,setParams:s})),[r,i,o,a,s]);return e(Z.Provider,{value:c,children:n})},an=Le(X.iframe`
  border: 0;
  max-height: 100%;
  width: 100%;
  display: block;
`),sn=function(t){const{basePath:r="/"}=q()?.activeWorkspace||{},{fontSize:i=1,onChange:o,openPopup:a,origin:s,padding:c=3,value:d,unstable_showUnsafeShareUrl:l}=t,h=T(null),[f,m]=U(void 0),[g,w]=U(void 0),y=D((e=>{m(e.currentTarget.value)}),[]),b=D((e=>{e.preventDefault(),a(e.currentTarget.href)}),[a]),S=D((e=>{if("Enter"===e.key){if(void 0===f)return;const e=f.startsWith("/")||""===f?`${s}${f}`:f;if(!e.startsWith(s+"/")&&e!==s)return void w(`URL must start with ${s}`);if(!s&&(e.startsWith(`${r}/`)||e===r))return void w(`URL can't have the same base path as the Studio ${r}`);const t=e===s?s+"/":e;w(void 0),m(void 0),o(t.slice(s.length)),h.current?.blur()}"Escape"===e.key&&(w(void 0),m(void 0))}),[r,o,s,f]),k=D((()=>{w(void 0),m(void 0)}),[]);L((()=>{w(void 0),m(void 0)}),[s,d]);const x=$((()=>({icon:me})),[]);return e(n,{children:e(v,{clearButton:g?x:void 0,customValidity:g,fontSize:i,onBlur:k,onClear:()=>{w(void 0),m(s+d)},onChange:y,onKeyDownCapture:S,padding:c,style:{zIndex:1},radius:2,ref:h,space:c,suffix:l?void 0:e(u,{padding:1,style:{lineHeight:0,zIndex:-1},children:e(p,{as:"a",fontSize:i,href:s+(f||d),icon:ve,mode:"bleed",onClick:b,padding:c-1,rel:"opener",target:"_blank"})}),value:void 0===f?`${s}${d}`:f})})},cn=Le(a),dn=X(g)`
  & > span {
    width: 21px;
    height: 13px;
    overflow: hidden;

    & > span:nth-child(1) {
      width: 21px;
      height: 13px;
    }

    & > span:nth-child(2) {
      width: 9px;
      height: 9px;
      top: 2px;
      left: 2px;
    }
  }

  & input:checked + span {
    & > span:nth-child(2) {
      transform: translate3d(8px, 0, 0) !important;
    }
  }
`,ln={previewDrafts:"Drafts",published:"Published",raw:"Raw"},un="caution",pn="positive",hn={previewDrafts:Ie,published:Ee,raw:ze},fn=C((function(r,i){const{initialUrl:s,targetOrigin:l,navigatorEnabled:m,onPathChange:v,openPopup:g,overlayEnabled:I,params:E,perspective:z,setPerspective:C,toggleNavigator:j,toggleOverlay:_,loadersConnection:O,overlaysConnection:M,previewKitConnection:T,unstable_showUnsafeShareUrl:N}=r,{devMode:W}=ot(),[A,K]=U("desktop"),F=w(),q=D((()=>K("desktop")),[K]),B=D((()=>K("mobile")),[K]),[V,G]=U(!0),[Q,H]=U(!1),[X,Z]=U(!1),[Y,ee]=U(!1),te=V||X||"connecting"===M,re=$((()=>l===location.origin?"":l),[l]),ie=D((()=>{"function"!=typeof i&&i?.current&&(i.current.src=`${l}${E.preview||"/"}`,Z(!0))}),[E.preview,l,i]),oe=D((()=>{"function"!=typeof i&&i?.current&&(i.current.src=s.toString(),Z(!0))}),[i,s]),ae=D((()=>{ce(!0)}),[]),[se,ce]=U(!1),[de,le]=U(!1);L((()=>{if(!(V||X||"connecting"!==M&&"reconnecting"!==M)){const e=setTimeout((()=>{le(!0)}),1e3);return()=>clearTimeout(e)}}),[M,V,X,le]),L((()=>{if(!V&&!X&&de){if("connected"===M&&(ee(!1),le(!1),H(!1),ce(!1)),"connecting"===M){const e=setTimeout((()=>{H(!0),console.error("Unable to connect to overlays. Make sure you're calling the 'enableOverlays' function in '@sanity/overlays' correctly")}),ne);return()=>clearTimeout(e)}if("reconnecting"===M){const e=setTimeout((()=>{H(!0),ee(!0)}),ne);return()=>clearTimeout(e)}"disconnected"===M&&ee(!0)}}),[V,M,X,de]);const ue=$((()=>{const e=new URL(E.preview||"/",l),{pathname:t,search:n}=De(e);return`${t}${n}`}),[E.preview,l]),pe=D((()=>{G(!1),Z(!1)}),[]);return e(je,{transition:F?{duration:0}:void 0,children:t(y,{delay:1e3,children:[e(o,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:t(a,{align:"center",gap:2,style:{minHeight:0},children:[j&&e(b,{animate:!0,content:e(d,{size:1,children:"Toggle navigator"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(p,{"aria-label":"Toggle navigator",fontSize:1,icon:ge,mode:"bleed",onClick:j,padding:3,selected:m})}),e(b,{animate:!0,content:t(a,{align:"center",style:{whiteSpace:"nowrap"},children:[e(u,{padding:1,children:e(d,{size:1,children:I?"Disable edit overlay":"Enable edit overlay"})}),e(u,{paddingY:1,children:e(J,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:e(o,{as:"label",flex:"none",padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:I?"positive":void 0,children:t(a,{align:"center",gap:2,children:[e("div",{style:{margin:-2},children:e(dn,{checked:I,onChange:_,disabled:te})}),e(u,{children:e(d,{muted:!0,size:1,weight:"medium",children:"Edit"})})]})})}),W&&e(b,{animate:!0,content:e(d,{size:1,children:X?"Refreshing…":"Refresh preview"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(p,{"aria-label":"Refresh preview",fontSize:1,icon:we,mode:"bleed",loading:X,onClick:ie,padding:3})}),e(u,{flex:1,children:e(sn,{onChange:v,openPopup:g,origin:re,value:ue,unstable_showUnsafeShareUrl:N})}),N&&e(a,{align:"center",flex:"none",gap:1,children:e(S,{button:e(p,{fontSize:1,iconRight:ye,mode:"bleed",padding:3,space:2}),id:"location-menu",menu:e(k,{children:e(yn,{initialUrl:s,openPopup:g,previewLocationOrigin:re,previewLocationRoute:ue})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),e(a,{align:"center",flex:"none",gap:1,children:e(S,{button:e(p,{fontSize:1,iconRight:be,mode:"bleed",padding:3,space:2,text:ln[z],loading:te||"connecting"===O&&"connected"!==T,disabled:"connected"!==O}),id:"perspective-menu",menu:t(k,{style:{maxWidth:240},children:[e(x,{fontSize:1,onClick:()=>C("previewDrafts"),padding:3,pressed:"previewDrafts"===z,tone:un,children:t(a,{align:"flex-start",gap:3,children:[e(u,{flex:"none",children:e(d,{size:1,children:R(hn.previewDrafts)})}),t(c,{flex:1,space:2,children:[e(d,{size:1,weight:"medium",children:ln.previewDrafts}),e(d,{muted:!0,size:1,children:"View this page with latest draft content"})]}),e(u,{flex:"none",children:e(d,{muted:!0,size:1,style:{opacity:"previewDrafts"===z?1:0},children:e(Se,{})})})]})}),e(x,{fontSize:1,onClick:()=>C("published"),padding:3,pressed:"published"===z,tone:pn,children:t(a,{align:"flex-start",gap:3,children:[e(u,{flex:"none",children:e(d,{size:1,children:R(hn.published)})}),t(c,{flex:1,space:2,children:[e(d,{size:1,weight:"medium",children:ln.published}),e(d,{muted:!0,size:1,children:"View this page with published content"})]}),e(u,{flex:"none",children:e(d,{muted:!0,size:1,style:{opacity:"published"===z?1:0},children:e(Se,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),t(a,{align:"center",flex:"none",gap:1,children:[e(b,{animate:!0,content:e(d,{size:1,children:"Full viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(p,{"aria-label":"Full viewport",fontSize:1,icon:ke,mode:"bleed",onClick:q,padding:3,selected:"desktop"===A})}),e(b,{animate:!0,content:e(d,{size:1,children:"Narrow viewport"}),padding:2,placement:"bottom",portal:!0,children:e(p,{"aria-label":"Narrow viewport",fontSize:1,icon:xe,mode:"bleed",onClick:B,padding:3,selected:"mobile"===A})})]})]})}),e(o,{flex:1,tone:"transparent",children:t(a,{align:"center",height:"fill",justify:"center",padding:"desktop"===A?0:2,sizing:"border",style:{position:"relative",cursor:te?"wait":void 0},children:[e(_e,{children:Y||V||X||!de||se?!V&&!te||se?Y&&!se?e(cn,{initial:"initial",animate:"animate",exit:"exit",variants:gn,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:e(it,{flex:1,message:"Could not connect to the preview",onRetry:oe,onContinueAnyway:ae,children:W&&t(n,{children:["connected"!==M&&e(o,{padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(f,{muted:!0,size:0,children:"Overlay connection status"}),e(h,{size:1,children:M})]})}),"connected"!==O&&e(o,{padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(f,{muted:!0,size:0,children:"Loader connection status"}),e(h,{size:1,children:O})]})})]})})}):null:e(cn,{initial:"initial",animate:"animate",exit:"exit",variants:vn,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:t(a,{style:{...mn[A]},justify:"center",align:"center",direction:"column",gap:4,children:[e(P,{muted:!0}),e(d,{muted:!0,size:1,children:"Loading…"})]})}):e(cn,{initial:"initial",animate:"animate",exit:"exit",variants:vn,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:Q?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:Q?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:t(a,{style:{...mn[A]},justify:"center",align:"center",direction:"column",gap:4,children:[Q&&e(p,{disabled:!0,fontSize:1,mode:"ghost",text:"Continue anyway",style:{opacity:0}}),e(o,{radius:2,tone:Q?"caution":"inherit",padding:4,shadow:1,children:t(a,{justify:"center",align:"center",direction:"column",gap:4,children:[e(P,{muted:!0}),e(d,{muted:!0,size:1,children:Q?e(n,{children:"Unable to connect, check the browser console for more information."}):"Connecting…"})]})}),Q&&e(p,{fontSize:1,tone:"critical",onClick:ae,text:"Continue anyway"})]})})}),e(an,{ref:i,style:{pointerEvents:te&&!se?"none":"auto",boxShadow:"0 0 0 1px var(--card-border-color)",borderTop:"1px solid transparent"},src:s.toString(),initial:["background"],variants:wn,animate:[!V&&!te||se?"active":"background",X?"reloading":"idle",A,de&&!se?"timedOut":""],onLoad:pe})]})})]})})})),mn={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},vn={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},gn={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},wn={desktop:{...mn.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...mn.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};function yn(r){const{initialUrl:i,openPopup:o,previewLocationOrigin:a,previewLocationRoute:s}=r,c=D((e=>{e.preventDefault(),o(e.currentTarget.href)}),[o]);return t(n,{children:[e(bn,{initialUrl:i,previewLocationOrigin:a,previewLocationRoute:s}),e(x,{icon:ve,text:"Open preview",as:"a",href:`${a}${s}`,onClick:c,rel:"opener",target:"_blank"})]})}function bn(t){const{initialUrl:n,previewLocationOrigin:r,previewLocationRoute:i}=t,{push:o}=I(),a=F({apiVersion:re}),s=B(),[c,d]=U(!1);return e(x,{disabled:c,onClick:()=>{if(!navigator?.clipboard)return o({closable:!0,status:"error",title:"Clipboard not supported"}),!1;let e;d(!0);let t=`${r}${i}`;const c=()=>{o({id:e,closable:!0,status:"success",title:"The URL is copied to the clipboard"}),d(!1)},l=e=>{o({closable:!0,status:"error",title:"Copy failed",description:e.message||e.toString()}),d(!1)};if($e(n)&&"undefined"!=typeof ClipboardItem){const r="text/plain",d=new ClipboardItem({[r]:(async()=>{e=o({closable:!0,title:"Copying URL to clipboard…"});const c=await Ce(a,"@sanity/presentation","undefined"==typeof window?"":location.href,s?.id),d=Ue(n,c.secret,i);return t=d.toString(),new Blob([t],{type:r})})()});navigator.clipboard.write([d]).then(c).catch(l)}else navigator.clipboard.writeText(t).then(c).catch(l)},text:"Copy link",icon:Pe})}function Sn(e){if(void 0===e)return;const t=decodeURIComponent(e)?.split(".");return"drafts"===t[0]&&t.shift(),t.join(".")}function kn(e){if(void 0!==e)return i.toString(function(e){const t=[];for(const n of e.split(".")){const e=Ze.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=Ye.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=et.exec(n);i?t.push(i[1],{_key:i[2]}):t.push(n)}return t}(decodeURIComponent(e)))}function xn(e){return{id:Sn(e.id),path:kn(e.path),type:e.type}}function Pn(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function In({initialPreviewUrl:e,routerNavigate:t,routerState:n,routerSearchParams:r}){const[o,a]=U((()=>{const{id:t,path:i,type:o}=xn(n);return{id:t,type:o,path:i,preview:r.preview||`${e.pathname}${e.search}`,perspective:r.perspective,inspect:r.inspect,rev:r.rev,since:r.since,template:r.template,view:r.view,pathKey:r.pathKey,instruction:r.instruction,comment:r.comment}})),s=D((e=>{a((t=>{const n={...t,...e};return Oe(Pn(t),Pn(n))?t:n}))}),[]),c=$((()=>Pn({inspect:o.inspect,path:o.path,rev:o.rev,since:o.since,template:o.template,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment})),[o.inspect,o.path,o.rev,o.since,o.template,o.view,o.pathKey,o.instruction,o.comment]);L((()=>{const{id:t,path:i,type:o}=xn(n),a=setTimeout((()=>s({id:t,type:"*"===o?void 0:o,path:i,preview:r.preview||`${e.pathname}${e.search}`,perspective:r.perspective,inspect:r.inspect,rev:r.rev,since:r.since,template:r.template,view:r.view,pathKey:r.pathKey,instruction:r.instruction,comment:r.comment})),0);return()=>clearTimeout(a)}),[e,r,n,s]);const d=$((()=>Nt(((e,n)=>{const r=Pn(e);t(r,n)}),50)),[t]),l=T(o.preview);return L((()=>{const e=l.current;l.current=o.preview;const t=o.type,n=o.id,r=o.path?function(e){let t="";for(const n of e)"string"!=typeof n?"number"!=typeof n?Xe(n)?(t&&(t+=":"),t+=`${n.join(",")}}`):n._key&&(t&&(t+=":"),t+=`${n._key}`):(t&&(t+=":"),t+=`${n}`):(t&&(t+="."),t+=n);return t}(i.fromString(o.path)):void 0,a=Pn({preview:o.preview,perspective:"published"===o.perspective?"published":void 0,inspect:o.inspect,rev:o.rev,since:o.since,template:o.template,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment}),s=o.preview===e,c=setTimeout((()=>d({type:t,id:n,path:r,_searchParams:Object.entries(a)},{replace:s})),0);return()=>clearTimeout(c)}),[d,o]),{navigate:d,setParams:s,deskParams:c,params:o}}function En(e,t,n){const r=F({apiVersion:re}),i=q(),o=i?.activeWorkspace?.basePath||"/",a=function(e,t,n){const r=B();return $((()=>["@sanity/presentation",t,n,e,r?.id,zn]),[t,r?.id,e,n])}(t,o,i?.activeWorkspace?.name||"default"),s=function(e,t){const n=F({apiVersion:re}),r=B(),[i,o]=U(""),a=e?Te((async()=>await Ce(n,"@sanity/presentation","undefined"==typeof window?"":location.href,r?.id)),[...t,i]):null;return L((()=>{if(!a)return;const e=setTimeout((()=>{N((()=>o(a.expiresAt.toString())))}),a.expiresAt.getTime()-Date.now());return()=>clearTimeout(e)}),[a]),a?.secret||null}("object"==typeof e||"function"==typeof e,a);return Te((async()=>{if("string"==typeof e){const t=new URL(e,location.origin);let r=t;try{if(n){const e=new URL(n,t);e.origin===t.origin&&(r=e)}else if(document.referrer){const e=new URL(document.referrer);e.origin===t.origin&&(r=e)}}catch{}return location.origin!==r.origin||!r.pathname.startsWith(`${o}/`)&&r.pathname!==o?r:t}const t="object"==typeof e?Me(e):e,i=await t({client:r,previewUrlSecret:s,previewSearchParam:n,referrer:"undefined"==typeof document?null:document.referrer,studioBasePath:o});return new URL(i,location.origin)}),[...a,s])}const zn=Symbol();const Cn=X(a)`
  overflow-x: auto;
`;function Dn(r){const{previewUrl:o,components:s,unstable_showUnsafeShareUrl:c=!1}=r.tool.options??{},d=r.tool.name||oe,{unstable_navigator:l}=s||{},{navigate:u,state:p}=H(),h=W(Object.fromEntries(p._searchParams||[])),f=En(o||"/",d,h.preview||null),[m]=U((()=>{const e=r.tool.options?.devMode;return"function"==typeof e?e():"boolean"==typeof e?e:"undefined"!=typeof window&&"localhost"===window.location.hostname})),v=$((()=>f.origin),[f.origin]),g=T(null),[w,y]=U(),[b,S]=U({}),{setParams:k,params:x,deskParams:P}=In({initialPreviewUrl:f,routerNavigate:u,routerState:p,routerSearchParams:h}),[I,z]=U((()=>"published"===x.perspective?x.perspective:"previewDrafts")),[C,j]=function(e){const[t,n]=U((()=>({published:new Map,previewDrafts:new Map,raw:new Map}))),r=D(((e,t)=>{n((n=>{let r=!1,i=n[e];const o=e=>`${e._projectId}-${e.dataset}-${e._type}-${e._id}`,a=new Set;for(const e of t){const t=o(e);a.add(t),i.has(t)||(i.set(t,e),r=!0)}for(const e of i.keys())a.has(e)||(i.delete(e),r=!0);return r?(i=new Map(i),{...n,[e]:new Map(i)}):n}))}),[]),i=$((()=>t[e]),[e,t]);return[$((()=>[...i.values()]),[i]),r]}(I),[_,O]=U(!0),M=V(),R=G(),K=T(),F=T(x.id),[q,J]=U((()=>C.slice(0,3).map((e=>({...e,_id:A(e._id)})))));L((()=>{I!==x.perspective&&k({perspective:I})}),[x.perspective,I,k]),L((()=>{J(C.slice(0,3).map((e=>({...e,_id:A(e._id)}))))}),[C]),L((()=>{x.id!==F.current&&(F.current=x.id,x.id&&J((e=>e.find((e=>e._id===x.id))?e:e.slice(1).concat([{_id:x.id,_type:x.type}]))))}),[x]);const[B,Q]=U("connecting"),[X,Z]=U("connecting"),[Y,ee]=U("connecting"),[te]=U((()=>new Set)),ne=D((e=>{const t=window.open(e,"_blank");t&&te.add(t)}),[te]);L((()=>{if(te.size&&w)for(const e of te)e&&"closed"in e&&!e.closed&&w.addSource(e)}),[w,te,te.size]),L((()=>{const e=g.current?.contentWindow;if(!e)return;const t=function(e){const{destroy:t,send:n}=He(e),r=new Set,i=new WeakMap,o=new Set;return{destroy:()=>{t();for(const e of o)e()},send:(e,t,o)=>{n(e,t,o);for(const n of r)n&&"closed"in n&&!n.closed&&i.has(n)&&i.get(n)(e,t,o)},addSource(t){if(r.has(t))return;if(!("closed"in t))throw console.warn("Source is unsupported",{source:t}),new Error("Source is unsupported");if(t.closed)throw new Error("Source is closed");const{send:n,destroy:a}=He({...e,target:t,connectTo:e.connectTo.map((e=>{const{onStatusUpdate:t,onEvent:n,...r}=e;return{...r,onEvent:n?(e,t)=>{if("preview-kit/documents"!==e&&"overlay/navigate"!==e&&"loader/documents"!==e)return n(e,t)}:void 0}}))});o.add(a),i.set(t,n),r.add(t)}}}({id:"presentation",target:e,targetOrigin:v,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:Q,onEvent(e,t){if("overlay/focus"===e&&"id"in t)k({id:t.id,path:t.path,type:t.type});else if("overlay/navigate"===e){if(K.current!==t.url){const e=void 0===K.current;K.current=t.url,k(e?{preview:t.url}:{id:void 0,type:void 0,preview:t.url})}}else"overlay/toggle"===e&&O(t.enabled)}},{id:"loaders",heartbeat:!0,onStatusUpdate:Z,onEvent(e,t){if("loader/documents"===e)j(t.perspective,t.documents);else if("loader/query-listen"===e&&t.projectId===M&&t.dataset===R){if("number"==typeof t.heartbeat&&t.heartbeat<ie)throw new Error(`Loader query listen heartbeat interval must be at least ${ie}ms`);S((e=>{return{...e,[(n=t.query,r=t.params,`${n}-${"string"==typeof r?r:JSON.stringify(r)}`)]:{perspective:t.perspective,query:t.query,params:t.params,receivedAt:Date.now(),heartbeat:t.heartbeat??!1}};var n,r}))}}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:ee,onEvent(e,t){"preview-kit/documents"===e&&t.projectId===M&&t.dataset===R&&j(t.perspective,t.documents)}}]});return y(t),()=>{t.destroy(),y(void 0)}}),[R,M,j,k,v]),L((()=>{const e=setInterval((()=>N((()=>S((e=>{if(Object.keys(e).length<1)return e;const t=Date.now();if(!Object.values(e).some((e=>!1!==e.heartbeat&&t>e.receivedAt+e.heartbeat)))return e;const n={};for(const[r,i]of Object.entries(e))!1!==i.heartbeat&&t>i.receivedAt+i.heartbeat||(n[r]=i);return n}))))),ie);return()=>clearInterval(e)}),[]);const re=D(((e,t)=>{k({path:i.toString(t)})}),[k]),ae=D((e=>{const t=new URL(e,f.origin),n=t.pathname+t.search;t.origin===f.origin&&n!==x.preview&&k({id:void 0,path:void 0,preview:n})}),[f,x,k]),se=D((e=>{k({...e})}),[k]);L((()=>{x.id&&x.path?w?.send("overlays","presentation/focus",{id:x.id,path:x.path}):w?.send("overlays","presentation/blur",void 0)}),[w,x.id,x.path]),L((()=>{K.current&&x.preview&&K.current!==x.preview&&(K.current=x.preview,"connected"!==B&&g.current?g.current.src=`${v}${x.preview}`:w?.send("overlays","presentation/navigate",{url:x.preview,type:"push"}))}),[w,B,v,x.preview]);const ce=D((()=>w?.send("overlays","presentation/toggleOverlay",void 0)),[w]),[de,le]=U(null),ue=D((e=>le(e)),[]);L((()=>{const e=e=>{rt(e)&&ce()},t=e=>{rt(e)&&ce(),nt(["mod","\\"],e)&&ce()};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[ce]);const[pe,he]=U(null),[{navigatorEnabled:fe,toggleNavigator:me},ve]=tn({unstable_navigator:l});return t(n,{children:[t(on,{deskParams:P,devMode:m,name:d,params:x,setParams:k,children:[q.map((t=>e(Yt,{id:t._id,type:t._type},t._id))),e(en,{setParams:k,children:e(rn,{params:x,children:e(Cn,{height:"fill",children:t(Zt,{children:[e(ve,{}),e(Ot,{id:"preview",minWidth:325,defaultSize:fe?50:75,order:3,children:e(a,{direction:"column",flex:1,height:"fill",ref:he,children:e(E,{element:pe,children:e(fn,{initialUrl:f,navigatorEnabled:fe,onPathChange:ae,openPopup:ne,overlayEnabled:_,params:x,perspective:I,ref:g,setPerspective:z,targetOrigin:v,toggleNavigator:me,toggleOverlay:ce,loadersConnection:X,overlaysConnection:B,previewKitConnection:Y,unstable_showUnsafeShareUrl:c})})})}),e(Rt,{order:4}),e(Ot,{id:"content",minWidth:325,order:5,children:e(wt,{refs:C,deskParams:P,documentId:x.id,documentType:x.type,onDeskParams:se,onFocusPath:re,onDocumentChange:ue,previewUrl:x.preview})})]})})})})]}),w&&t(n,{children:[e(Ut,{activePerspective:"published"===I,channel:w,liveQueries:b,perspective:"published",liveDocument:de?._id?.startsWith("drafts.")?null:de},"published"),e(Ut,{activePerspective:"previewDrafts"===I,channel:w,liveQueries:b,perspective:"previewDrafts",liveDocument:de},"previewDrafts")]})]})}export{Dn as default};//# sourceMappingURL=PresentationTool-u_vTy0KQ.js.map
