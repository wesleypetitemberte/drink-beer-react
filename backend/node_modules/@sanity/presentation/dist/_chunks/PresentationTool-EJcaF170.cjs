"use strict";var e=require("react/jsx-runtime"),t=require("@sanity/client/csm"),n=require("@sanity/ui"),r=require("react"),i=require("sanity"),o=require("sanity/router"),s=require("styled-components"),a=require("./index-76adgAzB.cjs"),c=require("sanity/desk"),l=require("@sanity/groq-store"),d=require("mendoza"),u=require("@sanity/icons"),p=require("@sanity/preview-url-secret/create-secret"),f=require("@sanity/preview-url-secret/without-secret-search-params"),h=require("framer-motion"),m=require("lodash.isequal"),v=require("@sanity/preview-url-secret/define-preview-url"),g=require("suspend-react");function x(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var y=x(s),w=x(m);let b;const j=new Uint8Array(16);function S(){if(!b&&(b="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!b))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return b(j)}const k=[];for(let e=0;e<256;++e)k.push((e+256).toString(16).slice(1));var C={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function P(e,t,n){if(C.randomUUID&&!t&&!e)return C.randomUUID();const r=(e=e||{}).random||(e.rng||S)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return k[e[t+0]]+k[e[t+1]]+k[e[t+2]]+k[e[t+3]]+"-"+k[e[t+4]]+k[e[t+5]]+"-"+k[e[t+6]]+k[e[t+7]]+"-"+k[e[t+8]]+k[e[t+9]]+"-"+k[e[t+10]]+k[e[t+11]]+k[e[t+12]]+k[e[t+13]]+k[e[t+14]]+k[e[t+15]]}(r)}const E=1e3,I=1e3,M=500,D=["handshake/syn","handshake/syn-ack","handshake/ack"],T=e=>D.some((t=>t===e)),z=({data:e={}})=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&!("domain"in e)&&["id","type","from","to"].every((t=>t in e))&&e.type.startsWith("handshake/");function _(e){const t=e.target,n=e.connectTo.map((e=>({buffer:[],config:e,id:"",handler:i,status:"connecting",interval:void 0,heartbeat:void 0})));function r(e){window.clearInterval(e.interval)}function i(e){const{data:t}=e;if(T(t.type)){const e=n.find((e=>e.config.id===t.from));e&&"handshake/syn-ack"===t.type&&(c(e,"connected"),l(e,"handshake/ack",{id:e.id}))}}const o=t=>{const{data:r}=t;if(!T(r.type)&&n.find((e=>e.id===r.connectionId))){const t=n.find((e=>e.config.id===r.from));if(t){const n=[r.type,r.data];t.config.onEvent?.(...n),e.onEvent?.(...n),d(t,"channel/response",{responseTo:r.id},!1)}}};function s(t){if(z(t))console.error("Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\nhttps://github.com/sanity-io/visual-editing");else if(function(t){const{data:r,origin:i}=t;return"sanity/channels"===r.domain&&r.to==e.id&&n.map((e=>e.config.id)).includes(r.from)&&"channel/response"!==r.type&&i===e.targetOrigin}(t)){const{data:e}=t;n.find((t=>t.config.id===e.from))?.handler(t)}}function a(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function c(t,n){t.status=n,t.config.onStatusUpdate?.(n,t.config.id),e.onStatusUpdate?.(n,t.config.id),"connecting"===n||"reconnecting"===n?(t.handler=i,a(t),function(e){e.id=P(),e.interval=window.setInterval((()=>{l(e,"handshake/syn",{id:e.id})}),M)}(t)):"connected"===n?(t.handler=o,r(t),function(e){if(a(e),e.config.heartbeat){const t="number"==typeof e.config.heartbeat?e.config.heartbeat:I;e.heartbeat=window.setInterval((()=>{d(e,"channel/heartbeat")}),t)}}(t),function(e){const t=[...e.buffer];e.buffer.splice(0,e.buffer.length),t.forEach((({type:t,data:n})=>{d(e,t,n)}))}(t)):"disconnected"===n&&(t.id=null,t.handler=i,r(t),a(t))}function l(n,r,i){if(!n.id)throw new Error("No channel ID set");const o={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:P(),to:n.config.id,type:r};try{t?.postMessage(o,{targetOrigin:"*"})}catch(t){throw new Error(`Failed to postMessage '${o.id}' on '${e.id}'`)}}function d(n,r,i,o=!0){const s=P();if("connecting"===n.status||"reconnecting"===n.status||"disconnected"===n.status)return void n.buffer.push({type:r,data:i});if(!n.id)throw new Error("No channel ID set");const a={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:s,to:n.config.id,type:r};if(o){const t=setTimeout((()=>{a.connectionId===n.id&&(window.removeEventListener("message",o,!1),"channel/heartbeat"!==r&&n.buffer.push({type:r,data:i}),c(n,"reconnecting"),console.warn(`Received no response to message '${a.type}' on client '${e.id}' (ID: '${a.id}').`))}),E),o=e=>{const{data:n}=e;"channel/response"===n.type&&n.data?.responseTo&&n.data.responseTo===a.id&&(window.removeEventListener("message",o,!1),clearTimeout(t))};window.addEventListener("message",o,!1)}try{t?.postMessage(a,{targetOrigin:e.targetOrigin})}catch(t){throw new Error(`Failed to postMessage '${a.id}' on client '${e.id}'`)}}return window.addEventListener("message",s,!1),n.forEach((e=>{c(e,"connecting")})),{destroy:function(){n.forEach((e=>{["disconnected"].includes(e.status)||(d(e,"channel/disconnect",{id:e.id},!1),c(e,"disconnected"))})),window.removeEventListener("message",s,!1),n.forEach((e=>{a(e),r(e)}))},send:function(e,t,r){(e?Array.isArray(e)?[...e]:[e]:n).forEach((e=>{const i=n.find((t=>t.config.id===e));if(!i)throw new Error("Invalid channel ID");d(i,t,r)}))}}}function L(e){return null!==e&&Array.isArray(e)}const R=/^([A-Za-z]+):([0-9]+)$/,U=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,$=/^([A-Za-z]+):([a-z0-9]+)$/;const O={alt:"altKey",ctrl:"ctrlKey",mod:"undefined"!=typeof window&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function F(e,t){return e.every((e=>O[e]?t[O[e]]:t.key===e.toUpperCase()))}function B(e){return"Alt"===e.key}function A(t){const{children:r,message:i,onRetry:o,onContinueAnyway:s,...a}=t,c=e.jsx(n.Button,{fontSize:1,mode:"ghost",onClick:o,text:"Retry"}),l=e.jsx(n.Button,{fontSize:1,mode:"ghost",tone:"critical",onClick:s,text:"Continue anyway"});return e.jsx(n.Card,{height:"fill",...a,children:e.jsx(n.Flex,{align:"center",height:"fill",justify:"center",children:e.jsx(n.Container,{padding:4,sizing:"border",width:0,children:e.jsxs(n.Stack,{space:4,children:[e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Text,{size:1,weight:"semibold",children:"An error occured"}),e.jsx(n.Text,{muted:!0,size:1,children:i})]}),r,o&&s?e.jsxs(n.Inline,{space:2,children:[c,l]}):o?e.jsx(n.Box,{children:c}):s?e.jsx(n.Box,{children:l}):null]})})})})}function W(){const e=r.useContext(a.P);if(!e)throw new Error("Presentation context is missing");return e}function q(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(e={}){const t=Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&");return t.length?`?${t}`:""}(Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>null==n?e:{...e,[t]:n}),{}))}const N=r.forwardRef((function(t,n){const{deskParams:r,params:i}=W();return e.jsx(o.StateLink,{...t,ref:n,state:{type:void 0,_searchParams:Object.entries({...r,preview:i.preview})},title:void 0})})),K=r.forwardRef((function(t,n){const{documentId:r,documentType:i,...s}=t;return e.jsx(o.StateLink,{...s,ref:n,state:{id:r,type:i},title:void 0})}));function J(t){const{children:n,params:s,onDeskParams:a,previewUrl:l,refs:d}=t,{state:u,resolvePathFromState:p}=o.useRouter(),f=i.useUnique(Object.fromEntries(u._searchParams||[])),h=r.useCallback((e=>`${p(u)}${q({...f,...e})}`),[p,f,u]),m=r.useMemo((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:s,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:t=>{const{childId:n,...r}=t,s=d?.find((e=>i.getPublishedId(e._id)===n));return s?e.jsx(o.StateLink,{...r,state:{id:s._id,type:s._type,_searchParams:Object.entries({preview:l})}}):e.jsx("div",{...r})},BackLink:N,ReferenceChildLink:K,ParameterizedLink:()=>e.jsx(e.Fragment,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{a({...e,inspect:e.inspect??void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,t,n)=>{console.warn("navigateIntent",e,t,n)},createPathWithParams:h})),[h,a,s,l,d]);return e.jsx(c.PaneRouterContext.Provider,{value:m,children:n})}const V=y.default(c.PaneLayout)`
  height: 100%;
`,G=y.default(n.Flex)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,Q=y.default(n.Code)`
  white-space: pre-wrap;
`;function H(t){const{onDeskParams:i,previewUrl:o,refs:s}=t,{devMode:a}=W(),l=r.useMemo((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:s.map((e=>e._id))}},schemaTypeName:"",title:"Documents on this page",type:"documentList"})),[s]),[d,u]=r.useState(null),p=r.useCallback((()=>u(null)),[]),f=r.useMemo((()=>({})),[]);return r.useEffect((()=>u(null)),[s]),d?e.jsx(A,{flex:1,message:"Could not render the document list",onRetry:p,children:a&&e.jsx(n.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Error message"}),e.jsx(Q,{size:1,children:d.error.message})]})})}):e.jsx(n.ErrorBoundary,{onCatch:u,children:e.jsx(V,{children:e.jsx(c.DeskToolProvider,{children:e.jsx(J,{params:f,onDeskParams:i,previewUrl:o,refs:s,children:e.jsx(G,{direction:"column",flex:1,children:e.jsx(c.DocumentListPane,{index:0,itemId:"$root",pane:l,paneKey:"$root"})})})})})})}function X(t){const{onDeskParams:n,previewUrl:r,refs:i}=t;return e.jsx(H,{onDeskParams:n,previewUrl:r,refs:i})}const Z=y.default(n.Code)`
  white-space: pre-wrap;
`;function Y(t){const{documentId:i,documentType:o,params:s,onDeskParams:a,onFocusPath:l}=t,{devMode:d}=W(),u=r.useMemo((()=>({id:i,options:{id:i,type:o},title:"",type:"document"})),[i,o]),[p,f]=r.useState(null),h=r.useCallback((()=>f(null)),[]);r.useEffect((()=>{f(null)}),[i,o,s]);const{setLayoutCollapsed:m}=c.useDeskTool(),v=r.useCallback((()=>m(!0)),[m]),g=r.useCallback((()=>m(!1)),[m]);return p?e.jsx(A,{flex:1,message:"Could not render the document editor",onRetry:h,children:d&&e.jsx(n.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Error message"}),e.jsx(Z,{size:1,children:p.error.message})]})})}):e.jsx(n.ErrorBoundary,{onCatch:f,children:e.jsx(c.PaneLayout,{style:{height:"100%"},onExpand:g,onCollapse:v,children:e.jsx(J,{onDeskParams:a,params:s,children:e.jsx(c.DocumentPane,{paneKey:"document",index:1,itemId:"document",pane:u,onFocusPath:l})})})})}function ee(t){const{deskParams:n,documentId:o,documentType:s,onDeskParams:a,onFocusPath:l,onDocumentChange:d}=t,u=i.useEditState(o,s),p=u.draft||u.published;r.useEffect((()=>d(p)),[p,d]);const f=r.useCallback((e=>{p?._id&&l(p._id,e)}),[p,l]);return e.jsx(c.DeskToolProvider,{children:e.jsx(Y,{documentId:o,documentType:s,params:n,onDeskParams:a,onFocusPath:f})})}function te(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:s,onDocumentChange:a,previewUrl:c,refs:l}=t;return r&&i?e.jsx(ee,{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:s,onDocumentChange:a}):e.jsx(X,{onDeskParams:o,previewUrl:c,refs:l})}function ne(e){return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)}const re=r.createContext(null);r.createContext(null);const ie=r.createContext(!1);let oe=!1;function se(e,n,r,i,o,s){if("raw"===o)throw new Error("turboChargeResultIfSourceMap does not support raw perspective");return t.applySourceDocuments(i,s,(t=>{if(t._projectId)return void(oe||(console.warn("Cross dataset references are not supported yet, ignoring source document",t),oe=!0));if(e?._id===t._id&&e?._type===t._type)return e;const i=l.unstable__getDocumentCacheKey({projectId:n,dataset:r,perspective:o},t);return l.unstable__documentsCache.get(i)}),((e,{previousValue:t})=>"number"==typeof e&&"string"==typeof t?`${e}`:e))}function ae(e,t,n){return`${e}-${t}-${JSON.stringify(n)}`}const ce=r.memo((function(t){const{liveDocument:n,children:i,client:o,refreshInterval:s=2e3,perspective:a}=t;if("raw"===a)throw new Error("LiveStoreProvider does not support the raw perspective");const[c,l]=r.useState([]),[d]=r.useState((()=>new Map)),u=function(e){const[t]=r.useState((()=>new Map)),n=r.useCallback(((n,r,i,o,s)=>{t.has(n)||(t.set(n,{perspective:r,query:i,params:o,listeners:new Set}),e((e=>e.includes(n)?e:[...e,n])));const a=t.get(n);if(!a||!a.listeners)throw new TypeError("Inconsistent cache for key: "+n);const{listeners:c}=a;return c.add(s),()=>{c.delete(s),0===c.size&&(t.delete(n),e((e=>e.includes(n)?e.filter((e=>e!==n)):e)))}}),[t,e]);return r.useMemo((()=>({cache:t,subscribe:n})),[t,n])}(l),[p]=r.useState((()=>function(e,t,n){const r=ae(a,t,n);return{subscribe:e=>{const i=u.subscribe(r,a,t,n,e);return()=>i()},getSnapshot:()=>d.get(r)}})),[f,h]=r.useState([]),m=r.useCallback((e=>{const t=new Set;if(e.documents?.length)for(const{_id:n}of e.documents)t.add(n);h((e=>{const n=Array.from(new Set([...e,...t]));return JSON.stringify(n.sort())===JSON.stringify(e.sort())?e:n}))}),[]);return e.jsxs(re.Provider,{value:p,children:[e.jsx(ie.Provider,{value:!0,children:i}),e.jsx(ue,{liveDocument:n,cache:u.cache,client:o,setTurboIds:h,snapshots:d,turboIds:f,perspective:a}),c.map((t=>{if(!u.cache.has(t))return null;const{query:r,params:i,listeners:c}=u.cache.get(t);return e.jsx(de,{liveDocument:n,client:o,listeners:c,params:i,query:r,refreshInterval:s,snapshots:d,turboIdsFromSourceMap:m,perspective:a},t)}))]})}));ce.displayName="LiveStoreProvider";var le=ce;const de=r.memo((function(e){const{liveDocument:t,client:n,refreshInterval:i,query:o,params:s,listeners:a,snapshots:c,turboIdsFromSourceMap:l,perspective:d}=e,{projectId:u,dataset:p}=r.useMemo((()=>{const{projectId:e,dataset:t}=n.config();return{projectId:e,dataset:t}}),[n]),[f,h]=r.useState(null);if(f)throw f;const[m,v]=function(e){const{refreshInterval:t}=e,n=function(){const[e,t]=r.useState(!1);r.useEffect((()=>{t(navigator.onLine);const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e),window.addEventListener("offline",n),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}),[]);const n=r.useSyncExternalStore(ne,(()=>document.visibilityState),(()=>"hidden"));return!e||"hidden"===n}(),[i,o]=r.useState("hit"),s=r.useCallback((()=>(o("inflight"),()=>o("hit"))),[]);return r.useEffect((()=>{if(!t||"hit"!==i)return;const e=setTimeout((()=>o("stale")),t);return()=>clearTimeout(e)}),[t,i]),r.useEffect((()=>{if("hit"!==i)return;const e=()=>o("stale");return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)}),[t,i]),r.useEffect((()=>{n&&"hit"===i&&o("stale"),n||"stale"!==i||o("refresh")}),[n,i]),[i,s]}({refreshInterval:i}),g="refresh"===m||"inflight"===m;return r.useEffect((()=>{if(!g)return;let e=!1,r=!1;const i=new AbortController;const f=v();return async function(){const{signal:f}=i;r=!0;const{result:h,resultSourceMap:m}=await n.fetch(o,s,{tag:"presentation-loader",signal:f,perspective:d,filterResponse:!1});if(r=!1,!f.aborted){c.set(ae(d,o,s),{result:m?se(t,u,p,h,d,m):h,resultSourceMap:m}),m&&l(m);for(const e of a.values())e();e=!0}}().catch((e=>{r=!1,"AbortError"!==e.name&&h(e)})).finally(f),()=>{e||r||i.abort()}}),[t,n,p,a,s,u,o,g,c,v,l,d]),null}));de.displayName="QuerySubscription";const ue=r.memo((function(t){const{liveDocument:n,client:i,snapshots:o,cache:s,turboIds:c,setTurboIds:u,perspective:p}=t,{projectId:f,dataset:h}=r.useMemo((()=>{const{projectId:e,dataset:t}=i.config();return{projectId:e,dataset:t}}),[i]);r.useEffect((()=>{const e=new Set;for(const{perspective:t,query:n,params:r}of s.values()){const i=ae(t,n,r),s=o.get(i);if(s&&s.resultSourceMap?.documents?.length)for(const{_id:t}of s.resultSourceMap.documents)e.add(t)}const t=[...e].sort();JSON.stringify(c)!==JSON.stringify(t)&&u(t)}),[s,u,o,c]);const[m,v]=r.useState([]);r.useEffect((()=>{const e=new Set(m.flat()),t=new Set;for(const n of c)e.has(n)||l.unstable__documentsCache.has(l.unstable__getDocumentCacheKey({projectId:f,dataset:h,perspective:p},{_id:n}))||t.add(n);const n=[...t].slice(0,a.L);0!==n.length&&v((e=>[...e.slice(-a.L),n]))}),[m,h,p,f,c]);const[g,x]=r.useState();r.useEffect((()=>{const e=i.listen("published"===p?'*[!(_id in path("drafts.**"))]':'*[_id in path("drafts.**")]',{},{events:["mutation"],effectFormat:"mendoza",includePreviousRevision:!1,includeResult:!1,tag:"presentation-loader"}).subscribe((e=>{if("mutation"!==e.type||!e.effects?.apply?.length)return;const t=l.unstable__getDocumentCacheKey({projectId:f,dataset:h,perspective:p},{_id:e.documentId}),n=l.unstable__documentsCache.peek(t);if(n){const r={...n};delete r._rev;const i=d.applyPatch(r,e.effects.apply);l.unstable__documentsCache.set(t,i)}x(e.documentId)}));return()=>e.unsubscribe()}),[i,h,p,f]),r.useEffect((()=>{if(!g||!c.includes(g))return;const e=[];for(const[t,r]of o.entries())r.resultSourceMap?.documents?.length&&(r.result=se(n,f,h,r.result,p,r.resultSourceMap),e.push(t));for(const t of e){const e=s.get(t)?.listeners;if(e)for(const t of e)t()}x(void 0)}),[n,s,h,g,p,f,o,c]);const[y,w]=r.useState();return r.useEffect((()=>{if(!y)return;const e=[];for(const[t,r]of o.entries())r.resultSourceMap?.documents?.length&&(r.result=se(n,f,h,r.result,p,r.resultSourceMap),e.push(t));for(const t of e){const e=s.get(t)?.listeners;if(e)for(const t of e)t()}}),[s,h,n,y,p,f,o]),r.useEffect((()=>{n&&w(n._rev)}),[n]),e.jsx(e.Fragment,{children:m.map((t=>e.jsx(pe,{client:i,projectId:f,dataset:h,ids:t,perspective:p},JSON.stringify(t))))})}));ue.displayName="Turbo";const pe=r.memo((function(e){const{client:t,projectId:n,dataset:i,ids:o,perspective:s}=e;return r.useEffect((()=>{const e=o.filter((e=>!l.unstable__documentsCache.has(l.unstable__getDocumentCacheKey({projectId:n,dataset:i,perspective:s},{_id:e}))));0!==e.length&&t.getDocuments(e).then((e=>{for(const t of e)t&&t?._id&&l.unstable__documentsCache.set(l.unstable__getDocumentCacheKey({projectId:n,dataset:i,perspective:s},t),t)}),console.error)}),[t,i,o,s,n]),null}));function fe(e,t,n){const i=r.useContext(re);if(!i)throw new Error("useLiveQuery must be used inside a <LiveQueryProvider />");const o=function(e){const t=r.useMemo((()=>JSON.stringify(e||{})),[e]);return r.useMemo((()=>JSON.parse(t)),[t])}(n),s=r.useMemo((()=>i(e,t,o)),[i,e,o,t]),[a]=r.useState((()=>{if(void 0===e)throw new Error("initialSnapshot can't be undefined, if you don't want an initial value use null instead");try{return JSON.parse(JSON.stringify(e))}catch(t){return console.warn("Failed to deep clone initialSnapshot, this is likely an error and an indication that the snapshot isn't JSON serializable",{initialSnapshot:e,error:t}),e}})),c=r.useCallback((()=>a),[a]);return r.useSyncExternalStore(s.subscribe,s.getSnapshot,c)}function he(t){const{activePerspective:n,liveDocument:o,channel:s,perspective:a,liveQueries:c}=t,l=i.useClient({apiVersion:"2023-10-16"}),d=r.useMemo((()=>l.config()),[l]),u=r.useMemo((()=>l.withConfig({perspective:a,resultSourceMap:"withKeyArraySelector"})),[a,l]);return r.useEffect((()=>{if(s&&n){const{projectId:e,dataset:t}=d;s.send("loaders","loader/perspective",{projectId:e,dataset:t,perspective:a})}}),[n,s,d,a]),e.jsx(le,{liveDocument:o,client:u,perspective:a,refreshInterval:n?2e3:0,children:Object.entries(c).map((([t,{query:n,params:r}])=>e.jsx(me,{projectId:d.projectId,dataset:d.dataset,perspective:a,query:n,params:r,channel:s},`${t}${a}`)))})}function me(e){const{projectId:t,dataset:n,perspective:i,query:o,params:s,channel:a}=e,c=fe(null,o,s),l=c?.result,d=c?.resultSourceMap;return r.useEffect((()=>{d&&a.send("loaders","loader/query-change",{projectId:t,dataset:n,perspective:i,query:o,params:s,result:l,resultSourceMap:d})}),[a,n,s,i,t,o,l,d]),null}pe.displayName="GetDocuments";const ve=r.createContext(null);ve.displayName="PanelsContext";const ge=y.default.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,xe=function({children:t,defaultSize:n=null,id:i,minWidth:o,maxWidth:s,order:a=0}){const c=r.useContext(ve);if(null===c)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:l,registerElement:d,unregisterElement:u}=c,p=l(i);return r.useLayoutEffect((()=>(d(i,{id:i,type:"panel",defaultSize:n,maxWidth:s??null,minWidth:o??0,order:a}),()=>{u(i)})),[i,n,a,s,o,d,u]),e.jsx(ge,{style:p,children:t})};const ye=y.default.div`
  position: relative;
`,we=y.default.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-border-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  "}
`,be=function({id:t,order:n,disabled:i=!1}){const o=r.useRef(null),s=r.useContext(ve);if(null===s)throw Error("Panel components must be rendered within a PanelGroup container");const a=function(e){return r.useRef(e||P()).current}(t),{activeResizer:c,drag:l,startDragging:d,stopDragging:u,registerElement:p,unregisterElement:f}=s,h=c===a;if(null===s)throw Error("Panel components must be rendered within a PanelGroup container");const m=r.useCallback((e=>{d(a,e.nativeEvent)}),[a,d]),v=r.useCallback((e=>{l(a,e)}),[a,l]),g=r.useCallback((()=>{o.current.blur(),u()}),[u]);return r.useEffect((()=>{if(h&&!i)return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g)}}),[i,h,v,g]),r.useLayoutEffect((()=>(p(a,{id:a,order:n,type:"resizer",el:o}),()=>{f(a)})),[a,n,p,f]),e.jsx(ye,{onMouseDown:m,ref:o,children:e.jsxs(we,{$disabled:i,children:[e.jsx("span",{}),e.jsx("span",{})]})})};function je(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(e,r)}),t)}}const Se="presentation/panels",ke=()=>JSON.parse(localStorage.getItem(Se)||"{}"),Ce=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function Pe(){return r.useMemo((()=>{const e=(e,t)=>{(e=>{localStorage.setItem(Se,JSON.stringify(e))})({...ke(),[Ce(e)]:t})};return{get:e=>ke()[Ce(e)],set:e,setDebounced:je(e,100)}}),[])}function Ee(e,t,n){const{maxWidth:r,minWidth:i}=e,o=null==r?100:r/n*100,s=i/n*100;return Math.min(o,Math.max(s,t))}function Ie(e,t,n){if(1===e.length)return"100";const r=n[e.findIndex((e=>e.id===t))];return null==r?"0":r.toPrecision(10)}function Me(e,t,n=0,r=null){return e.clientX-(r||t.getBoundingClientRect()).left-n}function De(e){return"panel"===e.type}function Te(e){return"resizer"===e.type}function ze(e){return Array.from(e.values()).sort((({order:e},{order:t})=>null==e&&null==t?0:null==e?-1:null==t?1:e-t))}function _e(e,t,n){const r=t.reduce(((e,t)=>e+t),0),i=[...t].map((e=>e/r*100));let o=0;for(let t=0;t<e.length;t++){const r=e[t],s=i[t],a=Ee(r,s,n);s!=a&&(o+=s-a,i[t]=a)}if("0.000"!==o.toFixed(3))for(let t=0;t<e.length;t++){const r=e[t];let{maxWidth:s,minWidth:a}=r;a=a/n*100,null!=s&&(s=s/n*100);const c=Math.min(null!=s?s:100,Math.max(a,i[t]+o));if(c!==i[t]&&(o-=c-i[t],i[t]=c,"0.000"===Math.abs(o).toFixed(3)))break}return i}const Le=y.default.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,Re=function({children:t}){const n=r.useRef(null),[i,o]=r.useState(new Map),s=r.useMemo((()=>ze(i).filter(De)),[i]),[a,c]=r.useState([]),[l,d]=r.useState(null),u=r.useRef({elements:i,panels:s,widths:a}),p=r.useCallback((e=>({flexGrow:Ie(s,e,a),pointerEvents:null===l?void 0:"none"})),[l,s,a]),f=r.useCallback(((e,t)=>{o((n=>{if(n.has(e))return n;const r=new Map(n);return r.set(e,t),r}))}),[]),h=r.useCallback((e=>{o((t=>{if(!t.has(e))return t;const n=new Map(t);return n.delete(e),n}))}),[]),m=r.useRef({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),v=r.useCallback(((e,t)=>{const n=ze(i),r=n.findIndex((t=>t.id===e)),o=i.get(e);if(!o||!Te(o))return;const s=o.el.current;s&&(m.current={resizerIndex:r,panelBefore:n.reduce(((e,t,n)=>De(t)&&n<r?t:e),null),panelAfter:n.reduce(((e,t,n)=>null===e&&De(t)&&n>r?t:e),null),containerWidth:window.innerWidth,startX:t.pageX,dragOffset:Me(t,s),resizerRect:s.getBoundingClientRect(),widths:u.current.widths},d(e))}),[i]),g=r.useCallback((()=>{d(null)}),[]),x=r.useCallback(((e,t)=>{t.preventDefault(),t.stopPropagation();const{containerWidth:r,dragOffset:o,panelBefore:s,panelAfter:a,resizerRect:l}=m.current;if(null==s||null==a)return;const d=i.get(e);if(!d||!Te(d))return;const p=d.el.current;if(!p)return;const f=Me(t,p,o,l);if(0===f)return;const{widths:h}=u.current,v=function(e,t,n,r,i,o){const{panels:s,widths:a}=i,{widths:c}=o,l=c||a,d=[...l];{const i=e<0?r:n,o=l[s.findIndex((e=>e.id===i.id))],a=Ee(i,o+Math.abs(e),t);if(o===a)return l;e=e<0?o-a:a-o}let u=0,p=e<0?n:r,f=s.findIndex((e=>e.id===p.id));for(;;){const n=s[f],r=l[f],i=Ee(n,r-(Math.abs(e)-Math.abs(u)),t);if(r!==i&&(u+=r-i,d[f]=i,u.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--f<0)break}else if(++f>=s.length)break}return 0===u?l:(p=e<0?r:n,f=s.findIndex((e=>e.id===p.id)),d[f]=l[f]+u,d)}(f/n.current.getBoundingClientRect().width*100,r,s,a,u.current,m.current),g=h.some(((e,t)=>e!==v[t]));g&&c(v)}),[i]);r.useLayoutEffect((()=>{u.current.elements=i,u.current.panels=s,u.current.widths=a}),[i,s,a]);const y=Pe();r.useLayoutEffect((()=>{const{widths:e}=u.current;if(e.length===s.length)return;const t=y.get(s);if(t){const e=_e(s,t,window.innerWidth);return void c(e)}const n=function(e){let t=e.length,n=100;const r=e.map((e=>e.defaultSize?(n-=e.defaultSize,t-=1,e.defaultSize):null)),i=n/t;return r.map((e=>null===e?i:e))}(s);c(n)}),[y,s]),r.useEffect((()=>{a.length&&y.setDebounced(s,a)}),[y,s,a]),r.useLayoutEffect((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:t}=u.current,n=_e(e,t,window.innerWidth),r=t.some(((e,t)=>e!==n[t]));r&&c(n)}));return e.observe(n.current),()=>{e.disconnect()}}),[]);const w=r.useMemo((()=>({activeResizer:l,drag:x,getPanelStyle:p,registerElement:f,startDragging:v,stopDragging:g,unregisterElement:h})),[l,x,p,f,v,g,h]);return e.jsx(ve.Provider,{value:w,children:e.jsx(Le,{ref:n,children:t})})};function Ue(e){const{id:t,type:n}=e;return i.useEditState(t,n),null}const $e=function(t){const{children:n,setParams:i}=t,o=r.useCallback((e=>{i({preview:e})}),[i]),s=r.useMemo((()=>o),[o]);return e.jsx(a.a.Provider,{value:s,children:n})};function Oe(t){const{unstable_navigator:n}=t,i=!!n?.component,[o,s]=function(e,t){const[n,i]=r.useState((()=>JSON.parse(localStorage.getItem(e)??JSON.stringify(t))));return r.useEffect((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,i]}("presentation/navigator",i),a=!!i&&o,c=r.useMemo((()=>{if(i)return()=>s((e=>!e))}),[i,s]),l=r.useCallback((function(){return e.jsx(e.Fragment,{children:a&&e.jsx(Fe,{...n})})}),[a,n]);return[{navigatorEnabled:a,toggleNavigator:c},l]}const Fe=r.memo((function(t){const{minWidth:n,maxWidth:r,component:i}=t,o=null!=n&&null!=r&&n===r;return e.jsxs(e.Fragment,{children:[e.jsx(xe,{id:"navigator",minWidth:n,maxWidth:r,order:1,children:e.jsx(i,{})}),e.jsx(be,{order:2,disabled:o})]})})),Be=function(t){const{children:n,params:i}=t,o=r.useMemo((()=>i),[i]);return e.jsx(a.b.Provider,{value:o,children:n})},Ae=function(t){const{children:n,deskParams:i,devMode:o,name:s,params:c,setParams:l}=t,d=r.useMemo((()=>({deskParams:i,devMode:o,name:s,params:c,setParams:l})),[i,o,s,c,l]);return e.jsx(a.P.Provider,{value:d,children:n})},We=h.motion(y.default.iframe`
  border: 0;
  max-height: 100%;
  width: 100%;
  display: block;
`),qe=function(t){const{basePath:o="/"}=i.useActiveWorkspace()?.activeWorkspace||{},{fontSize:s=1,onChange:a,openPopup:c,origin:l,padding:d=3,value:p,unstable_showUnsafeShareUrl:f}=t,h=r.useRef(null),[m,v]=r.useState(void 0),[g,x]=r.useState(void 0),y=r.useCallback((e=>{v(e.currentTarget.value)}),[]),w=r.useCallback((e=>{e.preventDefault(),c(e.currentTarget.href)}),[c]),b=r.useCallback((e=>{if("Enter"===e.key){if(void 0===m)return;const e=m.startsWith("/")||""===m?`${l}${m}`:m;if(!e.startsWith(l+"/")&&e!==l)return void x(`URL must start with ${l}`);if(!l&&(e.startsWith(`${o}/`)||e===o))return void x(`URL can't have the same base path as the Studio ${o}`);const t=e===l?l+"/":e;x(void 0),v(void 0),a(t.slice(l.length)),h.current?.blur()}"Escape"===e.key&&(x(void 0),v(void 0))}),[o,a,l,m]),j=r.useCallback((()=>{x(void 0),v(void 0)}),[]);r.useEffect((()=>{x(void 0),v(void 0)}),[l,p]);const S=r.useMemo((()=>({icon:u.ResetIcon})),[]);return e.jsx(e.Fragment,{children:e.jsx(n.TextInput,{clearButton:g?S:void 0,customValidity:g,fontSize:s,onBlur:j,onClear:()=>{x(void 0),v(l+p)},onChange:y,onKeyDownCapture:b,padding:d,style:{zIndex:1},radius:2,ref:h,space:d,suffix:f?void 0:e.jsx(n.Box,{padding:1,style:{lineHeight:0,zIndex:-1},children:e.jsx(n.Button,{as:"a",fontSize:s,href:l+(m||p),icon:u.LaunchIcon,mode:"bleed",onClick:w,padding:d-1,rel:"opener",target:"_blank"})}),value:void 0===m?`${l}${p}`:m})})},Ne=h.motion(n.Flex),Ke=y.default(n.Switch)`
  & > span {
    width: 21px;
    height: 13px;
    overflow: hidden;

    & > span:nth-child(1) {
      width: 21px;
      height: 13px;
    }

    & > span:nth-child(2) {
      width: 9px;
      height: 9px;
      top: 2px;
      left: 2px;
    }
  }

  & input:checked + span {
    & > span:nth-child(2) {
      transform: translate3d(8px, 0, 0) !important;
    }
  }
`,Je={previewDrafts:"Drafts",published:"Published",raw:"Raw"},Ve="caution",Ge="positive",Qe={previewDrafts:u.EditIcon,published:u.PublishIcon,raw:u.DatabaseIcon},He=r.forwardRef((function(t,o){const{initialUrl:s,targetOrigin:c,navigatorEnabled:l,onPathChange:d,openPopup:p,overlayEnabled:m,params:v,perspective:g,setPerspective:x,toggleNavigator:y,toggleOverlay:w,loadersConnection:b,overlaysConnection:j,previewKitConnection:S,unstable_showUnsafeShareUrl:k}=t,{devMode:C}=W(),[P,E]=r.useState("desktop"),I=n.usePrefersReducedMotion(),M=r.useCallback((()=>E("desktop")),[E]),D=r.useCallback((()=>E("mobile")),[E]),[T,z]=r.useState(!0),[_,L]=r.useState(!1),[R,U]=r.useState(!1),[$,O]=r.useState(!1),F=T||R||"connecting"===j,B=r.useMemo((()=>c===location.origin?"":c),[c]),q=r.useCallback((()=>{"function"!=typeof o&&o?.current&&(o.current.src=`${c}${v.preview||"/"}`,U(!0))}),[v.preview,c,o]),N=r.useCallback((()=>{"function"!=typeof o&&o?.current&&(o.current.src=s.toString(),U(!0))}),[o,s]),K=r.useCallback((()=>{V(!0)}),[]),[J,V]=r.useState(!1),[G,Q]=r.useState(!1);r.useEffect((()=>{if(!(T||R||"connecting"!==j&&"reconnecting"!==j)){const e=setTimeout((()=>{Q(!0)}),1e3);return()=>clearTimeout(e)}}),[j,T,R,Q]),r.useEffect((()=>{if(!T&&!R&&G){if("connected"===j&&(O(!1),Q(!1),L(!1),V(!1)),"connecting"===j){const e=setTimeout((()=>{L(!0),console.error("Unable to connect to overlays. Make sure you're calling the 'enableOverlays' function in '@sanity/overlays' correctly")}),a.M);return()=>clearTimeout(e)}if("reconnecting"===j){const e=setTimeout((()=>{L(!0),O(!0)}),a.M);return()=>clearTimeout(e)}"disconnected"===j&&O(!0)}}),[T,j,R,G]);const H=r.useMemo((()=>{const e=new URL(v.preview||"/",c),{pathname:t,search:n}=f.withoutSecretSearchParams(e);return`${t}${n}`}),[v.preview,c]),X=r.useCallback((()=>{z(!1),U(!1)}),[]);return e.jsx(h.MotionConfig,{transition:I?{duration:0}:void 0,children:e.jsxs(n.TooltipDelayGroupProvider,{delay:1e3,children:[e.jsx(n.Card,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:e.jsxs(n.Flex,{align:"center",gap:2,style:{minHeight:0},children:[y&&e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:"Toggle navigator"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Toggle navigator",fontSize:1,icon:u.PanelLeftIcon,mode:"bleed",onClick:y,padding:3,selected:l})}),e.jsx(n.Tooltip,{animate:!0,content:e.jsxs(n.Flex,{align:"center",style:{whiteSpace:"nowrap"},children:[e.jsx(n.Box,{padding:1,children:e.jsx(n.Text,{size:1,children:m?"Disable edit overlay":"Enable edit overlay"})}),e.jsx(n.Box,{paddingY:1,children:e.jsx(i.Hotkeys,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:e.jsx(n.Card,{as:"label",flex:"none",padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:m?"positive":void 0,children:e.jsxs(n.Flex,{align:"center",gap:2,children:[e.jsx("div",{style:{margin:-2},children:e.jsx(Ke,{checked:m,onChange:w,disabled:F})}),e.jsx(n.Box,{children:e.jsx(n.Text,{muted:!0,size:1,weight:"medium",children:"Edit"})})]})})}),C&&e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:R?"Refreshing…":"Refresh preview"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Refresh preview",fontSize:1,icon:u.RefreshIcon,mode:"bleed",loading:R,onClick:q,padding:3})}),e.jsx(n.Box,{flex:1,children:e.jsx(qe,{onChange:d,openPopup:p,origin:B,value:H,unstable_showUnsafeShareUrl:k})}),k&&e.jsx(n.Flex,{align:"center",flex:"none",gap:1,children:e.jsx(n.MenuButton,{button:e.jsx(n.Button,{fontSize:1,iconRight:u.ShareIcon,mode:"bleed",padding:3,space:2}),id:"location-menu",menu:e.jsx(n.Menu,{children:e.jsx(tt,{initialUrl:s,openPopup:p,previewLocationOrigin:B,previewLocationRoute:H})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),e.jsx(n.Flex,{align:"center",flex:"none",gap:1,children:e.jsx(n.MenuButton,{button:e.jsx(n.Button,{fontSize:1,iconRight:u.ChevronDownIcon,mode:"bleed",padding:3,space:2,text:Je[g],loading:F||"connecting"===b&&"connected"!==S,disabled:"connected"!==b}),id:"perspective-menu",menu:e.jsxs(n.Menu,{style:{maxWidth:240},children:[e.jsx(n.MenuItem,{fontSize:1,onClick:()=>x("previewDrafts"),padding:3,pressed:"previewDrafts"===g,tone:Ve,children:e.jsxs(n.Flex,{align:"flex-start",gap:3,children:[e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{size:1,children:r.createElement(Qe.previewDrafts)})}),e.jsxs(n.Stack,{flex:1,space:2,children:[e.jsx(n.Text,{size:1,weight:"medium",children:Je.previewDrafts}),e.jsx(n.Text,{muted:!0,size:1,children:"View this page with latest draft content"})]}),e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{muted:!0,size:1,style:{opacity:"previewDrafts"===g?1:0},children:e.jsx(u.CheckmarkIcon,{})})})]})}),e.jsx(n.MenuItem,{fontSize:1,onClick:()=>x("published"),padding:3,pressed:"published"===g,tone:Ge,children:e.jsxs(n.Flex,{align:"flex-start",gap:3,children:[e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{size:1,children:r.createElement(Qe.published)})}),e.jsxs(n.Stack,{flex:1,space:2,children:[e.jsx(n.Text,{size:1,weight:"medium",children:Je.published}),e.jsx(n.Text,{muted:!0,size:1,children:"View this page with published content"})]}),e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{muted:!0,size:1,style:{opacity:"published"===g?1:0},children:e.jsx(u.CheckmarkIcon,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),e.jsxs(n.Flex,{align:"center",flex:"none",gap:1,children:[e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:"Full viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Full viewport",fontSize:1,icon:u.DesktopIcon,mode:"bleed",onClick:M,padding:3,selected:"desktop"===P})}),e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:"Narrow viewport"}),padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Narrow viewport",fontSize:1,icon:u.MobileDeviceIcon,mode:"bleed",onClick:D,padding:3,selected:"mobile"===P})})]})]})}),e.jsx(n.Card,{flex:1,tone:"transparent",children:e.jsxs(n.Flex,{align:"center",height:"fill",justify:"center",padding:"desktop"===P?0:2,sizing:"border",style:{position:"relative",cursor:F?"wait":void 0},children:[e.jsx(h.AnimatePresence,{children:$||T||R||!G||J?!T&&!F||J?$&&!J?e.jsx(Ne,{initial:"initial",animate:"animate",exit:"exit",variants:Ye,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:e.jsx(A,{flex:1,message:"Could not connect to the preview",onRetry:N,onContinueAnyway:K,children:C&&e.jsxs(e.Fragment,{children:["connected"!==j&&e.jsx(n.Card,{padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Overlay connection status"}),e.jsx(n.Code,{size:1,children:j})]})}),"connected"!==b&&e.jsx(n.Card,{padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Loader connection status"}),e.jsx(n.Code,{size:1,children:b})]})})]})})}):null:e.jsx(Ne,{initial:"initial",animate:"animate",exit:"exit",variants:Ze,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:e.jsxs(n.Flex,{style:{...Xe[P]},justify:"center",align:"center",direction:"column",gap:4,children:[e.jsx(n.Spinner,{muted:!0}),e.jsx(n.Text,{muted:!0,size:1,children:"Loading…"})]})}):e.jsx(Ne,{initial:"initial",animate:"animate",exit:"exit",variants:Ze,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:_?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:_?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:e.jsxs(n.Flex,{style:{...Xe[P]},justify:"center",align:"center",direction:"column",gap:4,children:[_&&e.jsx(n.Button,{disabled:!0,fontSize:1,mode:"ghost",text:"Continue anyway",style:{opacity:0}}),e.jsx(n.Card,{radius:2,tone:_?"caution":"inherit",padding:4,shadow:1,children:e.jsxs(n.Flex,{justify:"center",align:"center",direction:"column",gap:4,children:[e.jsx(n.Spinner,{muted:!0}),e.jsx(n.Text,{muted:!0,size:1,children:_?e.jsx(e.Fragment,{children:"Unable to connect, check the browser console for more information."}):"Connecting…"})]})}),_&&e.jsx(n.Button,{fontSize:1,tone:"critical",onClick:K,text:"Continue anyway"})]})})}),e.jsx(We,{ref:o,style:{pointerEvents:F&&!J?"none":"auto",boxShadow:"0 0 0 1px var(--card-border-color)",borderTop:"1px solid transparent"},src:s.toString(),initial:["background"],variants:et,animate:[!T&&!F||J?"active":"background",R?"reloading":"idle",P,G&&!J?"timedOut":""],onLoad:X})]})})]})})})),Xe={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},Ze={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Ye={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},et={desktop:{...Xe.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...Xe.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};function tt(t){const{initialUrl:i,openPopup:o,previewLocationOrigin:s,previewLocationRoute:a}=t,c=r.useCallback((e=>{e.preventDefault(),o(e.currentTarget.href)}),[o]);return e.jsxs(e.Fragment,{children:[e.jsx(nt,{initialUrl:i,previewLocationOrigin:s,previewLocationRoute:a}),e.jsx(n.MenuItem,{icon:u.LaunchIcon,text:"Open preview",as:"a",href:`${s}${a}`,onClick:c,rel:"opener",target:"_blank"})]})}function nt(t){const{initialUrl:o,previewLocationOrigin:s,previewLocationRoute:c}=t,{push:l}=n.useToast(),d=i.useClient({apiVersion:a.A}),h=i.useCurrentUser(),[m,v]=r.useState(!1);return e.jsx(n.MenuItem,{disabled:m,onClick:()=>{if(!navigator?.clipboard)return l({closable:!0,status:"error",title:"Clipboard not supported"}),!1;let e;v(!0);let t=`${s}${c}`;const n=()=>{l({id:e,closable:!0,status:"success",title:"The URL is copied to the clipboard"}),v(!1)},r=e=>{l({closable:!0,status:"error",title:"Copy failed",description:e.message||e.toString()}),v(!1)};if(f.hasSecretSearchParams(o)&&"undefined"!=typeof ClipboardItem){const i="text/plain",s=new ClipboardItem({[i]:(async()=>{e=l({closable:!0,title:"Copying URL to clipboard…"});const n=await p.createPreviewSecret(d,"@sanity/presentation","undefined"==typeof window?"":location.href,h?.id),r=f.setSecretSearchParams(o,n.secret,c);return t=r.toString(),new Blob([t],{type:i})})()});navigator.clipboard.write([s]).then(n).catch(r)}else navigator.clipboard.writeText(t).then(n).catch(r)},text:"Copy link",icon:u.CopyIcon})}function rt(e){if(void 0===e)return;const t=decodeURIComponent(e)?.split(".");return"drafts"===t[0]&&t.shift(),t.join(".")}function it(e){if(void 0!==e)return t.studioPath.toString(function(e){const t=[];for(const n of e.split(".")){const e=R.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=U.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=$.exec(n);i?t.push(i[1],{_key:i[2]}):t.push(n)}return t}(decodeURIComponent(e)))}function ot(e){return{id:rt(e.id),path:it(e.path),type:e.type}}function st(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function at({initialPreviewUrl:e,routerNavigate:n,routerState:i,routerSearchParams:o}){const[s,a]=r.useState((()=>{const{id:t,path:n,type:r}=ot(i);return{id:t,type:r,path:n,preview:o.preview||`${e.pathname}${e.search}`,perspective:o.perspective,inspect:o.inspect,rev:o.rev,since:o.since,template:o.template,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment}})),c=r.useCallback((e=>{a((t=>{const n={...t,...e};return w.default(st(t),st(n))?t:n}))}),[]),l=r.useMemo((()=>st({inspect:s.inspect,path:s.path,rev:s.rev,since:s.since,template:s.template,view:s.view,pathKey:s.pathKey,instruction:s.instruction,comment:s.comment})),[s.inspect,s.path,s.rev,s.since,s.template,s.view,s.pathKey,s.instruction,s.comment]);r.useEffect((()=>{const{id:t,path:n,type:r}=ot(i),s=setTimeout((()=>c({id:t,type:"*"===r?void 0:r,path:n,preview:o.preview||`${e.pathname}${e.search}`,perspective:o.perspective,inspect:o.inspect,rev:o.rev,since:o.since,template:o.template,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment})),0);return()=>clearTimeout(s)}),[e,o,i,c]);const d=r.useMemo((()=>je(((e,t)=>{const r=st(e);n(r,t)}),50)),[n]),u=r.useRef(s.preview);return r.useEffect((()=>{const e=u.current;u.current=s.preview;const n=s.type,r=s.id,i=s.path?function(e){let t="";for(const n of e)"string"!=typeof n?"number"!=typeof n?L(n)?(t&&(t+=":"),t+=`${n.join(",")}}`):n._key&&(t&&(t+=":"),t+=`${n._key}`):(t&&(t+=":"),t+=`${n}`):(t&&(t+="."),t+=n);return t}(t.studioPath.fromString(s.path)):void 0,o=st({preview:s.preview,perspective:"published"===s.perspective?"published":void 0,inspect:s.inspect,rev:s.rev,since:s.since,template:s.template,view:s.view,pathKey:s.pathKey,instruction:s.instruction,comment:s.comment}),a=s.preview===e,c=setTimeout((()=>d({type:n,id:r,path:i,_searchParams:Object.entries(o)},{replace:a})),0);return()=>clearTimeout(c)}),[d,s]),{navigate:d,setParams:c,deskParams:l,params:s}}function ct(e,t,n){const o=i.useClient({apiVersion:a.A}),s=i.useActiveWorkspace(),c=s?.activeWorkspace?.basePath||"/",l=function(e,t,n){const o=i.useCurrentUser();return r.useMemo((()=>["@sanity/presentation",t,n,e,o?.id,lt]),[t,o?.id,e,n])}(t,c,s?.activeWorkspace?.name||"default"),d=function(e,t){const n=i.useClient({apiVersion:a.A}),o=i.useCurrentUser(),[s,c]=r.useState(""),l=e?g.suspend((async()=>await p.createPreviewSecret(n,"@sanity/presentation","undefined"==typeof window?"":location.href,o?.id)),[...t,s]):null;return r.useEffect((()=>{if(!l)return;const e=setTimeout((()=>{r.startTransition((()=>c(l.expiresAt.toString())))}),l.expiresAt.getTime()-Date.now());return()=>clearTimeout(e)}),[l]),l?.secret||null}("object"==typeof e||"function"==typeof e,l);return g.suspend((async()=>{if("string"==typeof e){const t=new URL(e,location.origin);let r=t;try{if(n){const e=new URL(n,t);e.origin===t.origin&&(r=e)}else if(document.referrer){const e=new URL(document.referrer);e.origin===t.origin&&(r=e)}}catch{}return location.origin!==r.origin||!r.pathname.startsWith(`${c}/`)&&r.pathname!==c?r:t}const t="object"==typeof e?v.definePreviewUrl(e):e,r=await t({client:o,previewUrlSecret:d,previewSearchParam:n,referrer:"undefined"==typeof document?null:document.referrer,studioBasePath:c});return new URL(r,location.origin)}),[...l,d])}const lt=Symbol();const dt=y.default(n.Flex)`
  overflow-x: auto;
`;exports.default=function(s){const{previewUrl:c,components:l,unstable_showUnsafeShareUrl:d=!1}=s.tool.options??{},u=s.tool.name||a.D,{unstable_navigator:p}=l||{},{navigate:f,state:h}=o.useRouter(),m=i.useUnique(Object.fromEntries(h._searchParams||[])),v=ct(c||"/",u,m.preview||null),[g]=r.useState((()=>{const e=s.tool.options?.devMode;return"function"==typeof e?e():"boolean"==typeof e?e:"undefined"!=typeof window&&"localhost"===window.location.hostname})),x=r.useMemo((()=>v.origin),[v.origin]),y=r.useRef(null),[w,b]=r.useState(),[j,S]=r.useState({}),{setParams:k,params:C,deskParams:P}=at({initialPreviewUrl:v,routerNavigate:f,routerState:h,routerSearchParams:m}),[E,I]=r.useState((()=>"published"===C.perspective?C.perspective:"previewDrafts")),[M,D]=function(e){const[t,n]=r.useState((()=>({published:new Map,previewDrafts:new Map,raw:new Map}))),i=r.useCallback(((e,t)=>{n((n=>{let r=!1,i=n[e];const o=e=>`${e._projectId}-${e.dataset}-${e._type}-${e._id}`,s=new Set;for(const e of t){const t=o(e);s.add(t),i.has(t)||(i.set(t,e),r=!0)}for(const e of i.keys())s.has(e)||(i.delete(e),r=!0);return r?(i=new Map(i),{...n,[e]:new Map(i)}):n}))}),[]),o=r.useMemo((()=>t[e]),[e,t]);return[r.useMemo((()=>[...o.values()]),[o]),i]}(E),[T,z]=r.useState(!0),L=i.useProjectId(),R=i.useDataset(),U=r.useRef(),$=r.useRef(C.id),[O,A]=r.useState((()=>M.slice(0,3).map((e=>({...e,_id:i.getPublishedId(e._id)})))));r.useEffect((()=>{E!==C.perspective&&k({perspective:E})}),[C.perspective,E,k]),r.useEffect((()=>{A(M.slice(0,3).map((e=>({...e,_id:i.getPublishedId(e._id)}))))}),[M]),r.useEffect((()=>{C.id!==$.current&&($.current=C.id,C.id&&A((e=>e.find((e=>e._id===C.id))?e:e.slice(1).concat([{_id:C.id,_type:C.type}]))))}),[C]);const[W,q]=r.useState("connecting"),[N,K]=r.useState("connecting"),[J,V]=r.useState("connecting"),[G]=r.useState((()=>new Set)),Q=r.useCallback((e=>{const t=window.open(e,"_blank");t&&G.add(t)}),[G]);r.useEffect((()=>{if(G.size&&w)for(const e of G)e&&"closed"in e&&!e.closed&&w.addSource(e)}),[w,G,G.size]),r.useEffect((()=>{const e=y.current?.contentWindow;if(!e)return;const t=function(e){const{destroy:t,send:n}=_(e),r=new Set,i=new WeakMap,o=new Set;return{destroy:()=>{t();for(const e of o)e()},send:(e,t,o)=>{n(e,t,o);for(const n of r)n&&"closed"in n&&!n.closed&&i.has(n)&&i.get(n)(e,t,o)},addSource(t){if(r.has(t))return;if(!("closed"in t))throw console.warn("Source is unsupported",{source:t}),new Error("Source is unsupported");if(t.closed)throw new Error("Source is closed");const{send:n,destroy:s}=_({...e,target:t,connectTo:e.connectTo.map((e=>{const{onStatusUpdate:t,onEvent:n,...r}=e;return{...r,onEvent:n?(e,t)=>{if("preview-kit/documents"!==e&&"overlay/navigate"!==e&&"loader/documents"!==e)return n(e,t)}:void 0}}))});o.add(s),i.set(t,n),r.add(t)}}}({id:"presentation",target:e,targetOrigin:x,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:q,onEvent(e,t){if("overlay/focus"===e&&"id"in t)k({id:t.id,path:t.path,type:t.type});else if("overlay/navigate"===e){if(U.current!==t.url){const e=void 0===U.current;U.current=t.url,k(e?{preview:t.url}:{id:void 0,type:void 0,preview:t.url})}}else"overlay/toggle"===e&&z(t.enabled)}},{id:"loaders",heartbeat:!0,onStatusUpdate:K,onEvent(e,t){if("loader/documents"===e)D(t.perspective,t.documents);else if("loader/query-listen"===e&&t.projectId===L&&t.dataset===R){if("number"==typeof t.heartbeat&&t.heartbeat<a.c)throw new Error(`Loader query listen heartbeat interval must be at least ${a.c}ms`);S((e=>{return{...e,[(n=t.query,r=t.params,`${n}-${"string"==typeof r?r:JSON.stringify(r)}`)]:{perspective:t.perspective,query:t.query,params:t.params,receivedAt:Date.now(),heartbeat:t.heartbeat??!1}};var n,r}))}}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:V,onEvent(e,t){"preview-kit/documents"===e&&t.projectId===L&&t.dataset===R&&D(t.perspective,t.documents)}}]});return b(t),()=>{t.destroy(),b(void 0)}}),[R,L,D,k,x]),r.useEffect((()=>{const e=setInterval((()=>r.startTransition((()=>S((e=>{if(Object.keys(e).length<1)return e;const t=Date.now();if(!Object.values(e).some((e=>!1!==e.heartbeat&&t>e.receivedAt+e.heartbeat)))return e;const n={};for(const[r,i]of Object.entries(e))!1!==i.heartbeat&&t>i.receivedAt+i.heartbeat||(n[r]=i);return n}))))),a.c);return()=>clearInterval(e)}),[]);const H=r.useCallback(((e,n)=>{k({path:t.studioPath.toString(n)})}),[k]),X=r.useCallback((e=>{const t=new URL(e,v.origin),n=t.pathname+t.search;t.origin===v.origin&&n!==C.preview&&k({id:void 0,path:void 0,preview:n})}),[v,C,k]),Z=r.useCallback((e=>{k({...e})}),[k]);r.useEffect((()=>{C.id&&C.path?w?.send("overlays","presentation/focus",{id:C.id,path:C.path}):w?.send("overlays","presentation/blur",void 0)}),[w,C.id,C.path]),r.useEffect((()=>{U.current&&C.preview&&U.current!==C.preview&&(U.current=C.preview,"connected"!==W&&y.current?y.current.src=`${x}${C.preview}`:w?.send("overlays","presentation/navigate",{url:C.preview,type:"push"}))}),[w,W,x,C.preview]);const Y=r.useCallback((()=>w?.send("overlays","presentation/toggleOverlay",void 0)),[w]),[ee,ne]=r.useState(null),re=r.useCallback((e=>ne(e)),[]);r.useEffect((()=>{const e=e=>{B(e)&&Y()},t=e=>{B(e)&&Y(),F(["mod","\\"],e)&&Y()};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[Y]);const[ie,oe]=r.useState(null),[{navigatorEnabled:se,toggleNavigator:ae},ce]=Oe({unstable_navigator:p});return e.jsxs(e.Fragment,{children:[e.jsxs(Ae,{deskParams:P,devMode:g,name:u,params:C,setParams:k,children:[O.map((t=>e.jsx(Ue,{id:t._id,type:t._type},t._id))),e.jsx($e,{setParams:k,children:e.jsx(Be,{params:C,children:e.jsx(dt,{height:"fill",children:e.jsxs(Re,{children:[e.jsx(ce,{}),e.jsx(xe,{id:"preview",minWidth:325,defaultSize:se?50:75,order:3,children:e.jsx(n.Flex,{direction:"column",flex:1,height:"fill",ref:oe,children:e.jsx(n.BoundaryElementProvider,{element:ie,children:e.jsx(He,{initialUrl:v,navigatorEnabled:se,onPathChange:X,openPopup:Q,overlayEnabled:T,params:C,perspective:E,ref:y,setPerspective:I,targetOrigin:x,toggleNavigator:ae,toggleOverlay:Y,loadersConnection:N,overlaysConnection:W,previewKitConnection:J,unstable_showUnsafeShareUrl:d})})})}),e.jsx(be,{order:4}),e.jsx(xe,{id:"content",minWidth:325,order:5,children:e.jsx(te,{refs:M,deskParams:P,documentId:C.id,documentType:C.type,onDeskParams:Z,onFocusPath:H,onDocumentChange:re,previewUrl:C.preview})})]})})})})]}),w&&e.jsxs(e.Fragment,{children:[e.jsx(he,{activePerspective:"published"===E,channel:w,liveQueries:j,perspective:"published",liveDocument:ee?._id?.startsWith("drafts.")?null:ee},"published"),e.jsx(he,{activePerspective:"previewDrafts"===E,channel:w,liveQueries:j,perspective:"previewDrafts",liveDocument:ee},"previewDrafts")]})]})};//# sourceMappingURL=PresentationTool-EJcaF170.cjs.map
