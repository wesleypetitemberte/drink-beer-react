{"version":3,"file":"PresentationTool-EJcaF170.cjs","sources":["../../../../node_modules/.pnpm/uuid@9.0.1/node_modules/uuid/dist/esm-browser/rng.js","../../../../node_modules/.pnpm/uuid@9.0.1/node_modules/uuid/dist/esm-browser/stringify.js","../../../../node_modules/.pnpm/uuid@9.0.1/node_modules/uuid/dist/esm-browser/native.js","../../../../node_modules/.pnpm/uuid@9.0.1/node_modules/uuid/dist/esm-browser/v4.js","../../../channels/src/constants.ts","../../../channels/src/helpers.ts","../../../channels/src/controller.ts","../../../visual-editing-helpers/dist/_chunks/urlStringToPath-FefM00gz.js","../../../visual-editing-helpers/dist/index.js","../../src/components/ErrorCard.tsx","../../src/usePresentationTool.ts","../../src/editor/PresentationPaneRouterProvider.tsx","../../src/editor/DocumentListPane.tsx","../../src/editor/DocumentListPanel.tsx","../../src/editor/DocumentPane.tsx","../../src/editor/DocumentPanel.tsx","../../src/editor/ContentEditor.tsx","../../../visual-editing-helpers/dist/hooks.js","../../src/loader/context.tsx","../../src/loader/turboChargeResultIfSourceMap.tsx","../../src/loader/utils.ts","../../src/loader/LiveStoreProvider.tsx","../../src/loader/useLiveQuery.ts","../../src/loader/LoaderQueries.tsx","../../src/panels/PanelsContext.tsx","../../src/panels/Panel.tsx","../../src/panels/PanelResizer.tsx","../../src/panels/usePanelId.ts","../../src/lib/debounce.ts","../../src/panels/usePanelsStorage.ts","../../src/panels/util.ts","../../src/panels/Panels.tsx","../../src/perf/HoldEditState.tsx","../../src/PresentationNavigateProvider.tsx","../../src/PresentationNavigator.tsx","../../src/useLocalState.ts","../../src/PresentationParamsProvider.tsx","../../src/PresentationProvider.tsx","../../src/preview/IFrame.tsx","../../src/preview/PreviewLocationInput.tsx","../../src/preview/PreviewFrame.tsx","../../src/lib/parse.ts","../../src/useParams.ts","../../src/usePreviewUrl.ts","../../src/PresentationTool.tsx","../../src/useDocumentsOnPage.ts"],"sourcesContent":["// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nlet getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).slice(1));\n}\n\nexport function unsafeStringify(arr, offset = 0) {\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  return byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]];\n}\n\nfunction stringify(arr, offset = 0) {\n  const uuid = unsafeStringify(arr, offset); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default {\n  randomUUID\n};","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  if (native.randomUUID && !buf && !options) {\n    return native.randomUUID();\n  }\n\n  options = options || {};\n  const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return unsafeStringify(rnds);\n}\n\nexport default v4;","import type { ChannelMsgType } from './types'\n\nexport const RESPONSE_TIMEOUT = 1000\nexport const HEARTBEAT_INTERVAL = 1000\nexport const HANDSHAKE_INTERVAL = 500\n\nexport const INTERNAL_MSG_TYPES = [\n  'channel/disconnect',\n  'channel/response',\n  'channel/heartbeat',\n] satisfies ChannelMsgType[]\n\nexport const HANDSHAKE_MSG_TYPES = [\n  'handshake/syn',\n  'handshake/syn-ack',\n  'handshake/ack',\n] satisfies ChannelMsgType[]\n","import { HANDSHAKE_MSG_TYPES, INTERNAL_MSG_TYPES } from './constants'\nimport { ChannelMsgType, HandshakeMsgType, InternalMsgType } from './types'\n\nexport const isInternalMessage = (\n  type: ChannelMsgType | InternalMsgType,\n): type is InternalMsgType => {\n  return INTERNAL_MSG_TYPES.some((t) => t === type)\n}\n\nexport const isHandshakeMessage = (\n  type: ChannelMsgType | InternalMsgType,\n): type is HandshakeMsgType => {\n  return HANDSHAKE_MSG_TYPES.some((t) => t === type)\n}\n\nexport const isLegacyHandshakeMessage = ({\n  data = {},\n}: MessageEvent): boolean => {\n  return (\n    // Check data is a record type\n    typeof data === 'object' &&\n    data !== null &&\n    !Array.isArray(data) &&\n    // The \"domain\" key was introduced in commit 4854e7f\n    !('domain' in data) &&\n    // Check the rest of the object shape is present\n    ['id', 'type', 'from', 'to'].every((key) => key in data) &&\n    // Prior to 4854e7f only handshake events were emitted prior to an established connection\n    data.type.startsWith('handshake/')\n  )\n}\n","import { v4 as uuid } from 'uuid'\n\nimport {\n  HANDSHAKE_INTERVAL,\n  HEARTBEAT_INTERVAL,\n  RESPONSE_TIMEOUT,\n} from './constants'\nimport { isHandshakeMessage, isLegacyHandshakeMessage } from './helpers'\nimport type {\n  ChannelMsg,\n  ChannelsController,\n  ChannelsControllerChannel,\n  ChannelsControllerOptions,\n  ChannelStatus,\n  InternalMsgType,\n  ProtocolMsg,\n  ToArgs,\n} from './types'\n\nexport function createChannelsController<T extends ChannelMsg>(\n  config: ChannelsControllerOptions<T>,\n): ChannelsController {\n  const { destroy, send } = createChannelsControllerInternal(config)\n  const sources = new Set<MessageEventSource>()\n  const sendToSource = new WeakMap<\n    MessageEventSource,\n    ChannelsController['send']\n  >()\n  const destroySource = new Set<ChannelsController['destroy']>()\n\n  const sendToMany = ((id, type, data) => {\n    send(id, type, data)\n    for (const source of sources) {\n      if (\n        source &&\n        'closed' in source &&\n        !source.closed &&\n        sendToSource.has(source)\n      ) {\n        const send = sendToSource.get(source)\n        send!(id, type, data)\n      }\n    }\n  }) satisfies ChannelsController['send']\n\n  const destroyMany = (() => {\n    destroy()\n    for (const destroy of destroySource) {\n      destroy()\n    }\n  }) satisfies ChannelsController['destroy']\n\n  return {\n    destroy: destroyMany,\n    send: sendToMany,\n    addSource(source) {\n      if (sources.has(source)) {\n        return\n      }\n      if (!('closed' in source)) {\n        // eslint-disable-next-line no-console\n        console.warn('Source is unsupported', { source })\n        throw new Error('Source is unsupported')\n      }\n      if (source.closed) {\n        throw new Error('Source is closed')\n      }\n      const { send, destroy } = createChannelsControllerInternal({\n        ...config,\n        target: source,\n        // @TODO temporary workaround for onStatusUpdate and onEvent not differentiating\n        //       iframes from popups\n        connectTo: config.connectTo.map((prevConnectTo) => {\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n          const { onStatusUpdate, onEvent, ...connectTo } = prevConnectTo\n\n          return {\n            ...connectTo,\n            onEvent: onEvent\n              ? (((type, data) => {\n                  if (\n                    type === 'preview-kit/documents' ||\n                    type === 'overlay/navigate' ||\n                    type === 'loader/documents'\n                  ) {\n                    return\n                  }\n\n                  // @ts-expect-error -- figure out ToArgs complaining\n                  return onEvent(type, data)\n                }) satisfies typeof onEvent)\n              : undefined,\n          }\n        }),\n      })\n      destroySource.add(destroy)\n      sendToSource.set(source, send)\n      sources.add(source)\n    },\n  }\n}\n\nfunction createChannelsControllerInternal<T extends ChannelMsg>(\n  config: ChannelsControllerOptions<T>,\n): Omit<ChannelsController, 'addSource'> {\n  const target = config.target\n\n  const channels: ChannelsControllerChannel<T>[] = config.connectTo.map(\n    (config) => ({\n      buffer: [],\n      config,\n      id: '',\n      handler: handshakeHandler,\n      status: 'connecting',\n      interval: undefined,\n      heartbeat: undefined,\n    }),\n  )\n\n  function startHandshake(channel: ChannelsControllerChannel<T>) {\n    channel.id = uuid()\n    channel.interval = window.setInterval(() => {\n      sendHandshake(channel, 'handshake/syn', { id: channel.id })\n    }, HANDSHAKE_INTERVAL)\n  }\n\n  function stopHandshake(channel: ChannelsControllerChannel<T>) {\n    window.clearInterval(channel.interval)\n  }\n\n  function isValidMessageEvent(\n    e: MessageEvent,\n  ): e is MessageEvent<ProtocolMsg<T>> {\n    const { data, origin } = e\n    return (\n      data.domain === 'sanity/channels' &&\n      data.to == config.id &&\n      channels.map((channel) => channel.config.id).includes(data.from) &&\n      data.type !== 'channel/response' &&\n      origin === config.targetOrigin\n    )\n  }\n\n  function handshakeHandler(e: MessageEvent<ProtocolMsg<T>>) {\n    const { data } = e\n    if (isHandshakeMessage(data.type)) {\n      const channel = channels.find(\n        (channel) => channel.config.id === data.from,\n      )\n      if (channel && data.type === 'handshake/syn-ack') {\n        setChannelStatus(channel, 'connected')\n        sendHandshake(channel, 'handshake/ack', { id: channel.id })\n      }\n    }\n  }\n\n  const messageHandler = (e: MessageEvent<ProtocolMsg<T>>) => {\n    const { data } = e\n    if (\n      !isHandshakeMessage(data.type) &&\n      channels.find((channel) => channel.id === data.connectionId)\n    ) {\n      const channel = channels.find(\n        (channel) => channel.config.id === data.from,\n      )\n      if (channel) {\n        // eslint-disable-next-line no-warning-comments\n        // @todo Ugly type casting\n        const args = [data.type, data.data] as ToArgs<T>\n        channel.config.onEvent?.(...args)\n        config.onEvent?.(...args)\n        send(channel, 'channel/response', { responseTo: data.id }, false)\n      }\n    }\n  }\n\n  function handleEvents(e: MessageEvent<ProtocolMsg<T>>) {\n    if (isLegacyHandshakeMessage(e)) {\n      // eslint-disable-next-line no-console\n      console.error(\n        'Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\\nhttps://github.com/sanity-io/visual-editing',\n      )\n      return\n    }\n\n    if (isValidMessageEvent(e)) {\n      const { data } = e\n      channels.find((channel) => channel.config.id === data.from)?.handler(e)\n    }\n  }\n\n  function flush(channel: ChannelsControllerChannel<T>) {\n    const toFlush = [...channel.buffer]\n    channel.buffer.splice(0, channel.buffer.length)\n    toFlush.forEach(({ type, data }) => {\n      send(channel, type, data)\n    })\n  }\n\n  function startHeartbeat(channel: ChannelsControllerChannel<T>) {\n    stopHeartbeat(channel)\n    if (channel.config.heartbeat) {\n      const heartbeatInverval =\n        typeof channel.config.heartbeat === 'number'\n          ? channel.config.heartbeat\n          : HEARTBEAT_INTERVAL\n      channel.heartbeat = window.setInterval(() => {\n        send(channel, 'channel/heartbeat')\n      }, heartbeatInverval)\n    }\n  }\n\n  function stopHeartbeat(channel: ChannelsControllerChannel<T>) {\n    if (channel.heartbeat) {\n      window.clearInterval(channel.heartbeat)\n    }\n  }\n\n  function setChannelStatus(\n    channel: ChannelsControllerChannel<T>,\n    next: ChannelStatus,\n  ) {\n    channel.status = next\n    channel.config.onStatusUpdate?.(next, channel.config.id)\n    config.onStatusUpdate?.(next, channel.config.id)\n    if (next === 'connecting' || next === 'reconnecting') {\n      channel.handler = handshakeHandler\n      stopHeartbeat(channel)\n      startHandshake(channel)\n    } else if (next === 'connected') {\n      channel.handler = messageHandler\n      stopHandshake(channel)\n      startHeartbeat(channel)\n      flush(channel)\n    } else if (next === 'disconnected') {\n      channel.id = null\n      channel.handler = handshakeHandler\n      stopHandshake(channel)\n      stopHeartbeat(channel)\n    }\n  }\n\n  function sendHandshake<K extends T['type']>(\n    channel: ChannelsControllerChannel<T>,\n    type: K,\n    data?: Extract<T, { type: K }>['data'],\n  ) {\n    if (!channel.id) {\n      throw new Error('No channel ID set')\n    }\n\n    const msg: ProtocolMsg<T> = {\n      connectionId: channel.id,\n      data,\n      domain: 'sanity/channels',\n      from: config.id,\n      id: uuid(),\n      to: channel.config.id,\n      type,\n    }\n\n    try {\n      target?.postMessage(msg, { targetOrigin: '*' })\n    } catch (e) {\n      throw new Error(`Failed to postMessage '${msg.id}' on '${config.id}'`)\n    }\n  }\n\n  function send<K extends T['type']>(\n    channel: ChannelsControllerChannel<T>,\n    type: K | InternalMsgType,\n    data?: Extract<T, { type: K }>['data'],\n    expectResponse = true,\n  ) {\n    const id = uuid()\n\n    // If there is no active channel, push to the buffer\n    if (\n      channel.status === 'connecting' ||\n      channel.status === 'reconnecting' ||\n      channel.status === 'disconnected'\n    ) {\n      channel.buffer.push({ type, data })\n      return\n    }\n\n    if (!channel.id) {\n      throw new Error('No channel ID set')\n    }\n\n    const msg: ProtocolMsg<T> = {\n      connectionId: channel.id,\n      data,\n      domain: 'sanity/channels',\n      from: config.id,\n      id,\n      to: channel.config.id,\n      type,\n    }\n\n    if (expectResponse) {\n      const maxWait = setTimeout(() => {\n        // The channel may have changed, so only reject if the IDs match\n        if (msg.connectionId === channel.id) {\n          // Cleanup the transaction listener\n          window.removeEventListener('message', transact, false)\n          // Push the message to the buffer\n          if (type !== 'channel/heartbeat') {\n            channel.buffer.push({ type, data })\n          }\n          // Try to reconnect\n          setChannelStatus(channel, 'reconnecting')\n          // eslint-disable-next-line no-console\n          console.warn(\n            `Received no response to message '${msg.type}' on client '${config.id}' (ID: '${msg.id}').`,\n          )\n        }\n      }, RESPONSE_TIMEOUT)\n\n      const transact = (e: MessageEvent<ChannelMsg>) => {\n        const { data: eventData } = e\n        if (\n          eventData.type === 'channel/response' &&\n          eventData.data?.responseTo &&\n          eventData.data.responseTo === msg.id\n        ) {\n          window.removeEventListener('message', transact, false)\n          clearTimeout(maxWait)\n        }\n      }\n      window.addEventListener('message', transact, false)\n    }\n\n    try {\n      target?.postMessage(msg, { targetOrigin: config.targetOrigin })\n    } catch (e) {\n      throw new Error(\n        `Failed to postMessage '${msg.id}' on client '${config.id}'`,\n      )\n    }\n  }\n\n  function disconnect() {\n    channels.forEach((channel) => {\n      if (['disconnected'].includes(channel.status)) return\n      send(channel, 'channel/disconnect', { id: channel.id }, false)\n      setChannelStatus(channel, 'disconnected')\n    })\n  }\n\n  function destroy() {\n    disconnect()\n    window.removeEventListener('message', handleEvents, false)\n    channels.forEach((channel) => {\n      stopHeartbeat(channel)\n      stopHandshake(channel)\n    })\n  }\n\n  function initialise() {\n    window.addEventListener('message', handleEvents, false)\n    channels.forEach((channel) => {\n      setChannelStatus(channel, 'connecting')\n    })\n  }\n\n  initialise()\n\n  function sendPublic<K extends T['type']>(\n    id: string | string[] | undefined,\n    type: K,\n    data?: Extract<T, { type: K }>['data'],\n  ) {\n    const channelsToSend = id ? (Array.isArray(id) ? [...id] : [id]) : channels\n\n    channelsToSend.forEach((id) => {\n      const channel = channels.find((channel) => channel.config.id === id)\n      if (!channel) throw new Error('Invalid channel ID')\n      send(channel, type, data)\n    })\n  }\n\n  return {\n    destroy,\n    send: sendPublic,\n  }\n}\n","function n(n){return\"object\"==typeof n&&null!==n&&!Array.isArray(n)}function e(n){return null!==n&&Array.isArray(n)}function t(n){let t=\"\";for(const r of n)\"string\"!=typeof r?\"number\"!=typeof r?e(r)?(t&&(t+=\":\"),t+=`${r.join(\",\")}}`):r._key&&(t&&(t+=\":\"),t+=`${r._key}`):(t&&(t+=\":\"),t+=`${r}`):(t&&(t+=\".\"),t+=r);return t}const r=/^([A-Za-z]+):([0-9]+)$/,o=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,u=/^([A-Za-z]+):([a-z0-9]+)$/;function s(n){const e=[];for(const t of n.split(\".\")){const n=r.exec(t);if(n){e.push(n[1],Number(n[2]));continue}const s=o.exec(t);if(s){e.push(s[1],[Number(s[2]),Number(s[3])]);continue}const c=u.exec(t);c?e.push(c[1],{_key:c[2]}):e.push(t)}return e}export{e as a,n as i,t as p,s as u};//# sourceMappingURL=urlStringToPath-FefM00gz.js.map\n","export{p as pathToUrlString,u as urlStringToPath}from\"./_chunks/urlStringToPath-FefM00gz.js\";function t(t,r){return`${t}-${\"string\"==typeof r?r:JSON.stringify(r)}`}const r=\"undefined\"!=typeof window&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),e={alt:\"altKey\",ctrl:\"ctrlKey\",mod:r?\"metaKey\":\"ctrlKey\",shift:\"shiftKey\"};function n(t,r){return t.every((t=>e[t]?r[e[t]]:r.key===t.toUpperCase()))}function o(t){return t.key===(r?\"Meta\":\"Ctrl\")}function i(t){return\"Alt\"===t.key}export{t as getQueryCacheKey,i as isAltKey,n as isHotkey,o as isModKey};//# sourceMappingURL=index.js.map\n","import {\n  Box,\n  Button,\n  Card,\n  CardProps,\n  Container,\n  Flex,\n  Inline,\n  Stack,\n  Text,\n} from '@sanity/ui'\nimport { ReactElement, ReactNode } from 'react'\n\nexport function ErrorCard(\n  props: {\n    children?: ReactNode\n    message: string\n    onRetry?: () => void\n    onContinueAnyway?: () => void\n  } & CardProps,\n): ReactElement {\n  const { children, message, onRetry, onContinueAnyway, ...restProps } = props\n\n  const retryButton = (\n    <Button fontSize={1} mode=\"ghost\" onClick={onRetry} text=\"Retry\" />\n  )\n  const continueAnywayButton = (\n    <Button\n      fontSize={1}\n      mode=\"ghost\"\n      tone=\"critical\"\n      onClick={onContinueAnyway}\n      text=\"Continue anyway\"\n    />\n  )\n\n  return (\n    <Card height=\"fill\" {...restProps}>\n      <Flex align=\"center\" height=\"fill\" justify=\"center\">\n        <Container padding={4} sizing=\"border\" width={0}>\n          <Stack space={4}>\n            <Stack space={3}>\n              <Text size={1} weight=\"semibold\">\n                An error occured\n              </Text>\n              <Text muted size={1}>\n                {message}\n              </Text>\n            </Stack>\n\n            {children}\n\n            {onRetry && onContinueAnyway ? (\n              <Inline space={2}>\n                {retryButton}\n                {continueAnywayButton}\n              </Inline>\n            ) : onRetry ? (\n              <Box>{retryButton}</Box>\n            ) : onContinueAnyway ? (\n              <Box>{continueAnywayButton}</Box>\n            ) : null}\n          </Stack>\n        </Container>\n      </Flex>\n    </Card>\n  )\n}\n","import { useContext } from 'react'\n\nimport {\n  PresentationContext,\n  PresentationContextValue,\n} from './PresentationContext'\n\nexport function usePresentationTool(): PresentationContextValue {\n  const presentation = useContext(PresentationContext)\n\n  if (!presentation) {\n    throw new Error('Presentation context is missing')\n  }\n\n  return presentation\n}\n","/* eslint-disable no-console */\n\nimport {\n  forwardRef,\n  PropsWithChildren,\n  ReactElement,\n  useCallback,\n  useMemo,\n} from 'react'\nimport { getPublishedId, useUnique } from 'sanity'\nimport {\n  BackLinkProps,\n  PaneRouterContext,\n  PaneRouterContextValue,\n  ReferenceChildLinkProps,\n} from 'sanity/desk'\nimport { StateLink, useRouter } from 'sanity/router'\n\nimport { DeskDocumentPaneParams, PresentationParams } from '../types'\nimport { usePresentationTool } from '../usePresentationTool'\n\nfunction encodeQueryString(params: Record<string, unknown> = {}): string {\n  const parts = Object.entries(params)\n    .map(([key, value]) => `${key}=${value}`)\n    .join('&')\n\n  return parts.length ? `?${parts}` : ''\n}\n\nfunction resolveQueryStringFromParams(\n  nextParams: Record<string, string | undefined>,\n) {\n  const allowed = [\n    'comment',\n    'inspect',\n    'instruction',\n    'pathKey',\n    'rev',\n    'since',\n    'template',\n    'view',\n  ] satisfies Array<keyof PresentationParams> as string[]\n\n  const safeNextParams = Object.entries(nextParams)\n    .filter(([key]) => allowed.includes(key))\n    .reduce((obj, [key, value]) => {\n      if (value == undefined) return obj\n      return { ...obj, [key]: value }\n    }, {})\n\n  return encodeQueryString(safeNextParams)\n}\n\nconst BackLink = forwardRef(function BackLink(\n  props: BackLinkProps,\n  ref: React.ForwardedRef<HTMLAnchorElement>,\n) {\n  const { deskParams, params } = usePresentationTool()\n\n  return (\n    <StateLink\n      {...props}\n      ref={ref}\n      state={{\n        type: undefined,\n        _searchParams: Object.entries({\n          ...deskParams,\n          preview: params.preview,\n        }),\n      }}\n      title={undefined}\n    />\n  )\n})\n\nconst ReferenceChildLink = forwardRef(function ReferenceChildLink(\n  props: ReferenceChildLinkProps,\n  ref: React.ForwardedRef<HTMLAnchorElement>,\n) {\n  const { documentId, documentType, ...restProps } = props\n\n  return (\n    <StateLink\n      {...restProps}\n      ref={ref}\n      state={{ id: documentId, type: documentType }}\n      title={undefined}\n    />\n  )\n})\n\nexport function PresentationPaneRouterProvider(\n  props: PropsWithChildren<{\n    onDeskParams: (params: DeskDocumentPaneParams) => void\n    params: DeskDocumentPaneParams\n    previewUrl?: string\n    refs?: { _id: string; _type: string }[]\n  }>,\n): ReactElement {\n  const { children, params, onDeskParams, previewUrl, refs } = props\n\n  const { state: routerState, resolvePathFromState } = useRouter()\n\n  const routerSearchParams = useUnique(\n    Object.fromEntries(routerState._searchParams || []),\n  )\n\n  const createPathWithParams: PaneRouterContextValue['createPathWithParams'] =\n    useCallback(\n      (nextParams) => {\n        const path = resolvePathFromState(routerState)\n        const qs = resolveQueryStringFromParams({\n          ...routerSearchParams,\n          ...nextParams,\n        })\n        return `${path}${qs}`\n      },\n      [resolvePathFromState, routerSearchParams, routerState],\n    )\n\n  const context: PaneRouterContextValue = useMemo(() => {\n    return {\n      index: 0,\n      groupIndex: 0,\n      siblingIndex: 0,\n      payload: {},\n      params: params as any,\n      hasGroupSiblings: false,\n      groupLength: 1,\n      routerPanesState: [],\n      ChildLink: (childLinkProps) => {\n        const { childId, ...restProps } = childLinkProps\n        const ref = refs?.find((r) => getPublishedId(r._id) === childId)\n\n        if (ref) {\n          return (\n            <StateLink\n              {...restProps}\n              state={{\n                id: ref._id,\n                type: ref._type,\n                _searchParams: Object.entries({ preview: previewUrl }),\n              }}\n            />\n          )\n        }\n\n        return <div {...restProps} />\n      },\n      BackLink,\n      ReferenceChildLink,\n      ParameterizedLink: () => <>ParameterizedLink</>,\n      closeCurrentAndAfter: () => {\n        console.warn('closeCurrentAndAfter')\n      },\n      handleEditReference: (options) => {\n        console.warn('handleEditReference', options)\n      },\n      replaceCurrent: (pane) => {\n        console.warn('replaceCurrent', pane)\n      },\n      closeCurrent: () => {\n        console.warn('closeCurrent')\n      },\n      duplicateCurrent: (pane) => {\n        console.warn('duplicateCurrent', pane)\n      },\n      setView: (viewId) => {\n        console.warn('setView', viewId)\n      },\n      setParams: (nextParams) => {\n        onDeskParams({\n          ...nextParams,\n          // eslint-disable-next-line no-warning-comments\n          // @todo set inspect param to undefined manually as param is missing from object when closing inspector\n          inspect: nextParams.inspect ?? undefined,\n        } as DeskDocumentPaneParams)\n      },\n      setPayload: (payload) => {\n        console.warn('setPayload', payload)\n      },\n      navigateIntent: (intentName, intentParams, options) => {\n        console.warn('navigateIntent', intentName, intentParams, options)\n      },\n      createPathWithParams,\n    }\n  }, [createPathWithParams, onDeskParams, params, previewUrl, refs])\n\n  return (\n    <PaneRouterContext.Provider value={context}>\n      {children}\n    </PaneRouterContext.Provider>\n  )\n}\n","import { Card, Code, ErrorBoundary, Flex, Label, Stack } from '@sanity/ui'\nimport {\n  ErrorInfo,\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport {\n  DeskToolProvider,\n  DocumentListPane as DeskDocumentListPane,\n  PaneLayout,\n  PaneNode,\n} from 'sanity/desk'\nimport styled from 'styled-components'\n\nimport { ErrorCard } from '../components/ErrorCard'\nimport { DeskDocumentPaneParams } from '../types'\nimport { usePresentationTool } from '../usePresentationTool'\nimport { PresentationPaneRouterProvider } from './PresentationPaneRouterProvider'\n\nconst RootLayout = styled(PaneLayout)`\n  height: 100%;\n`\n\nconst Root = styled(Flex)`\n  & > div {\n    min-width: none !important;\n    max-width: none !important;\n  }\n`\n\nconst WrappedCode = styled(Code)`\n  white-space: pre-wrap;\n`\n\nexport function DocumentListPane(props: {\n  onDeskParams: (params: DeskDocumentPaneParams) => void\n  previewUrl?: string\n  refs: { _id: string; _type: string }[]\n}): ReactElement {\n  const { onDeskParams, previewUrl, refs } = props\n  const { devMode } = usePresentationTool()\n\n  const pane: Extract<PaneNode, { type: 'documentList' }> = useMemo(\n    () => ({\n      id: '$root',\n      options: {\n        filter: '_id in $ids',\n        params: { ids: refs.map((r) => r._id) },\n      },\n      schemaTypeName: '',\n      title: 'Documents on this page',\n      type: 'documentList',\n    }),\n    [refs],\n  )\n\n  const [errorParams, setErrorParams] = useState<{\n    info: ErrorInfo\n    error: Error\n  } | null>(null)\n\n  const handleRetry = useCallback(() => setErrorParams(null), [])\n\n  const deskParams = useMemo(() => ({}), [])\n\n  // Reset error state when `refs` value schanges\n  useEffect(() => setErrorParams(null), [refs])\n\n  if (errorParams) {\n    return (\n      <ErrorCard\n        flex={1}\n        message=\"Could not render the document list\"\n        onRetry={handleRetry}\n      >\n        {devMode && (\n          // show runtime error message in dev mode\n          <Card overflow=\"auto\" padding={3} radius={2} tone=\"critical\">\n            <Stack space={3}>\n              <Label muted size={0}>\n                Error message\n              </Label>\n              <WrappedCode size={1}>{errorParams.error.message}</WrappedCode>\n            </Stack>\n          </Card>\n        )}\n      </ErrorCard>\n    )\n  }\n\n  return (\n    <ErrorBoundary onCatch={setErrorParams}>\n      <RootLayout>\n        <DeskToolProvider>\n          <PresentationPaneRouterProvider\n            params={deskParams}\n            onDeskParams={onDeskParams}\n            previewUrl={previewUrl}\n            refs={refs}\n          >\n            <Root direction=\"column\" flex={1}>\n              <DeskDocumentListPane\n                index={0}\n                itemId=\"$root\"\n                pane={pane}\n                paneKey=\"$root\"\n              />\n            </Root>\n          </PresentationPaneRouterProvider>\n        </DeskToolProvider>\n      </RootLayout>\n    </ErrorBoundary>\n  )\n}\n","import { ReactElement } from 'react'\n\nimport { DeskDocumentPaneParams } from '../types'\nimport { DocumentListPane } from './DocumentListPane'\n\nexport function DocumentListPanel(props: {\n  onDeskParams: (params: DeskDocumentPaneParams) => void\n  previewUrl?: string\n  refs: { _id: string; _type: string }[]\n}): ReactElement {\n  const { onDeskParams, previewUrl, refs } = props\n\n  return (\n    <DocumentListPane\n      onDeskParams={onDeskParams}\n      previewUrl={previewUrl}\n      refs={refs}\n    />\n  )\n}\n","import { Card, Code, ErrorBoundary, Label, Stack } from '@sanity/ui'\nimport {\n  ErrorInfo,\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport { Path } from 'sanity'\nimport {\n  DocumentPane as DeskDocumentPane,\n  DocumentPaneNode,\n  PaneLayout,\n  useDeskTool,\n} from 'sanity/desk'\nimport styled from 'styled-components'\n\nimport { ErrorCard } from '../components/ErrorCard'\nimport { DeskDocumentPaneParams } from '../types'\nimport { usePresentationTool } from '../usePresentationTool'\nimport { PresentationPaneRouterProvider } from './PresentationPaneRouterProvider'\n\nconst WrappedCode = styled(Code)`\n  white-space: pre-wrap;\n`\n\nexport function DocumentPane(props: {\n  documentId: string\n  documentType: string\n  params: DeskDocumentPaneParams\n  onDeskParams: (params: DeskDocumentPaneParams) => void\n  onFocusPath: (path: Path) => void\n}): ReactElement {\n  const { documentId, documentType, params, onDeskParams, onFocusPath } = props\n  const { devMode } = usePresentationTool()\n\n  const paneDocumentNode: DocumentPaneNode = useMemo(\n    () => ({\n      id: documentId,\n      options: {\n        id: documentId,\n        type: documentType,\n      },\n      title: '',\n      type: 'document',\n    }),\n    [documentId, documentType],\n  )\n\n  const [errorParams, setErrorParams] = useState<{\n    info: ErrorInfo\n    error: Error\n  } | null>(null)\n\n  const handleRetry = useCallback(() => setErrorParams(null), [])\n\n  // Reset error state when parameters change\n  useEffect(() => {\n    setErrorParams(null)\n  }, [documentId, documentType, params])\n\n  const { setLayoutCollapsed } = useDeskTool()\n  const handleRootCollapse = useCallback(\n    () => setLayoutCollapsed(true),\n    [setLayoutCollapsed],\n  )\n  const handleRootExpand = useCallback(\n    () => setLayoutCollapsed(false),\n    [setLayoutCollapsed],\n  )\n\n  if (errorParams) {\n    return (\n      <ErrorCard\n        flex={1}\n        message=\"Could not render the document editor\"\n        onRetry={handleRetry}\n      >\n        {devMode && (\n          // show runtime error message in dev mode\n          <Card overflow=\"auto\" padding={3} radius={2} tone=\"critical\">\n            <Stack space={3}>\n              <Label muted size={0}>\n                Error message\n              </Label>\n              <WrappedCode size={1}>{errorParams.error.message}</WrappedCode>\n            </Stack>\n          </Card>\n        )}\n      </ErrorCard>\n    )\n  }\n\n  return (\n    <ErrorBoundary onCatch={setErrorParams}>\n      <PaneLayout\n        style={{ height: '100%' }}\n        onExpand={handleRootExpand}\n        onCollapse={handleRootCollapse}\n      >\n        <PresentationPaneRouterProvider\n          onDeskParams={onDeskParams}\n          params={params}\n        >\n          <DeskDocumentPane\n            paneKey=\"document\"\n            index={1}\n            itemId=\"document\"\n            pane={paneDocumentNode}\n            onFocusPath={onFocusPath}\n          />\n        </PresentationPaneRouterProvider>\n      </PaneLayout>\n    </ErrorBoundary>\n  )\n}\n","import { ReactElement, useCallback, useEffect } from 'react'\nimport { Path, SanityDocument, useEditState } from 'sanity'\nimport { DeskToolProvider } from 'sanity/desk'\n\nimport { DeskDocumentPaneParams } from '../types'\nimport { DocumentPane } from './DocumentPane'\n\nexport function DocumentPanel(props: {\n  deskParams: DeskDocumentPaneParams\n  documentId: string\n  documentType: string\n  onDeskParams: (params: DeskDocumentPaneParams) => void\n  onFocusPath: (documentId: string, path: Path) => void\n  onDocumentChange: (document: SanityDocument | null) => void\n}): ReactElement {\n  const {\n    deskParams,\n    documentId,\n    documentType,\n    onDeskParams,\n    onFocusPath,\n    onDocumentChange,\n  } = props\n\n  const editState = useEditState(documentId, documentType)\n  const documentValue = editState.draft || editState.published\n\n  // Sync changes to the document being edited back up to the live loaders\n  useEffect(\n    () => onDocumentChange(documentValue),\n    [documentValue, onDocumentChange],\n  )\n\n  const handleFocusPath = useCallback(\n    (path: Path) => {\n      if (documentValue?._id) {\n        onFocusPath(documentValue._id, path)\n      }\n    },\n    [documentValue, onFocusPath],\n  )\n\n  return (\n    <DeskToolProvider>\n      <DocumentPane\n        documentId={documentId}\n        documentType={documentType}\n        params={deskParams}\n        onDeskParams={onDeskParams}\n        onFocusPath={handleFocusPath}\n      />\n    </DeskToolProvider>\n  )\n}\n","import { ReactElement } from 'react'\nimport { Path, SanityDocument } from 'sanity'\n\nimport { DeskDocumentPaneParams } from '../types'\nimport { DocumentListPanel } from './DocumentListPanel'\nimport { DocumentPanel } from './DocumentPanel'\n\nexport function ContentEditor(props: {\n  deskParams: DeskDocumentPaneParams\n  documentId?: string\n  documentType?: string\n  onDeskParams: (params: DeskDocumentPaneParams) => void\n  onFocusPath: (documentId: string, path: Path) => void\n  onDocumentChange: (document: SanityDocument | null) => void\n  previewUrl?: string\n  refs: { _id: string; _type: string }[]\n}): ReactElement {\n  const {\n    deskParams,\n    documentId,\n    documentType,\n    onDeskParams,\n    onFocusPath,\n    onDocumentChange,\n    previewUrl,\n    refs,\n  } = props\n\n  if (documentId && documentType) {\n    return (\n      <DocumentPanel\n        deskParams={deskParams}\n        documentId={documentId}\n        documentType={documentType}\n        onDeskParams={onDeskParams}\n        onFocusPath={onFocusPath}\n        onDocumentChange={onDocumentChange}\n      />\n    )\n  }\n\n  return (\n    <DocumentListPanel\n      onDeskParams={onDeskParams}\n      previewUrl={previewUrl}\n      refs={refs}\n    />\n  )\n}\n","import{useMemo as e,useState as n,useCallback as t,useEffect as i,useSyncExternalStore as r}from\"react\";function o(n){const t=e((()=>JSON.stringify(n||{})),[n]);return e((()=>JSON.parse(t)),[t])}function s(e){const{refreshInterval:o}=e,s=function(){const[e,t]=n(!1);i((()=>{t(navigator.onLine);const e=()=>t(!0),n=()=>t(!1);return window.addEventListener(\"online\",e),window.addEventListener(\"offline\",n),()=>{window.removeEventListener(\"online\",e),window.removeEventListener(\"offline\",n)}}),[]);const o=r(u,(()=>document.visibilityState),(()=>\"hidden\"));if(!e)return!0;if(\"hidden\"===o)return!0;return!1}(),[d,c]=n(\"hit\"),f=t((()=>(c(\"inflight\"),()=>c(\"hit\"))),[]);return i((()=>{if(!o||\"hit\"!==d)return;const e=setTimeout((()=>c(\"stale\")),o);return()=>clearTimeout(e)}),[o,d]),i((()=>{if(\"hit\"!==d)return;const e=()=>c(\"stale\");return window.addEventListener(\"focus\",e),()=>window.removeEventListener(\"focus\",e)}),[o,d]),i((()=>{s&&\"hit\"===d&&c(\"stale\"),s||\"stale\"!==d||c(\"refresh\")}),[s,d]),[d,f]}function u(e){return document.addEventListener(\"visibilitychange\",e),()=>document.removeEventListener(\"visibilitychange\",e)}export{o as useQueryParams,s as useRevalidate};//# sourceMappingURL=hooks.js.map\n","import { createContext } from 'react'\n\nimport { DefineListenerContext } from './types'\nimport { QueryCacheKey } from './utils'\n\n/**\n * @internal\n */\nexport const defineListenerContext =\n  createContext<DefineListenerContext | null>(null)\n\n/**\n * If it's `null` then the listener should be treated as `success`, otherwise if a listener isn't in the array it should be considered as `loading`\n * @internal\n */\nexport const LoadedListenersContext = createContext<QueryCacheKey[] | null>(\n  null,\n)\n\n/**\n * Aids in debugging, notifying if the parent has a GroqStoreProvider, or a LiveStoreProvider, and is thus `live`.\n * This is helpful as the `useLiveQuery` hook itself works even if no provider is present, but it will not be `live`.\n * @internal\n */\nexport const IsEnabledContext = createContext<boolean>(false)\n","import type {\n  ClientPerspective,\n  ContentSourceMap,\n  SanityDocument,\n} from '@sanity/client'\nimport { applySourceDocuments } from '@sanity/client/csm'\nimport {\n  unstable__documentsCache,\n  unstable__getDocumentCacheKey,\n} from '@sanity/groq-store'\n\nlet warnedAboutCrossDatasetReference = false\n\nexport function turboChargeResultIfSourceMap(\n  liveDocument: SanityDocument | null,\n  projectId: string,\n  dataset: string,\n  result: unknown,\n  perspective: ClientPerspective,\n  resultSourceMap?: ContentSourceMap,\n): any {\n  if (perspective === 'raw') {\n    throw new Error(\n      'turboChargeResultIfSourceMap does not support raw perspective',\n    )\n  }\n  return applySourceDocuments(\n    result,\n    resultSourceMap,\n    (sourceDocument) => {\n      if (sourceDocument._projectId) {\n        // @TODO Handle cross dataset references\n        if (!warnedAboutCrossDatasetReference) {\n          // eslint-disable-next-line no-console\n          console.warn(\n            'Cross dataset references are not supported yet, ignoring source document',\n            sourceDocument,\n          )\n          warnedAboutCrossDatasetReference = true\n        }\n        return undefined\n      }\n      // If the draft matches, use that as it's the most up to date\n      if (\n        liveDocument?._id === sourceDocument._id &&\n        liveDocument?._type === sourceDocument._type\n      ) {\n        return liveDocument\n      }\n      // Fallback to general documents cache\n      const key = unstable__getDocumentCacheKey(\n        { projectId, dataset, perspective },\n        sourceDocument,\n      )\n      return unstable__documentsCache.get(key)\n    },\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (changedValue: any, { previousValue }) => {\n      if (\n        typeof changedValue === 'number' &&\n        typeof previousValue === 'string'\n      ) {\n        // If the string() function was used in the query, we need to convert the source value to a string as well\n        return `${changedValue}`\n      }\n      return changedValue\n    },\n  )\n}\n","import type { ClientPerspective, QueryParams } from '@sanity/client'\n\n/**\n * @internal\n */\nexport type QueryCacheKey = `${ClientPerspective}-${string}-${string}`\n/**\n * @internal\n */\nexport function getQueryCacheKey(\n  perspective: ClientPerspective,\n  query: string,\n  params: QueryParams,\n): QueryCacheKey {\n  return `${perspective}-${query}-${JSON.stringify(params)}`\n}\n","import type {\n  ClientConfig,\n  ClientPerspective,\n  ContentSourceMap,\n  QueryParams,\n  SanityClient,\n  SanityDocument,\n} from '@sanity/client'\nimport {\n  DocumentCachePerspective,\n  unstable__documentsCache,\n  unstable__getDocumentCacheKey,\n} from '@sanity/groq-store'\nimport { useRevalidate } from '@sanity/visual-editing-helpers/hooks'\nimport { applyPatch } from 'mendoza'\nimport { memo, useCallback, useEffect, useMemo, useState } from 'react'\n\nimport { LIVE_QUERY_CACHE_BATCH_SIZE } from '../constants'\nimport { defineListenerContext as Context, IsEnabledContext } from './context'\nimport { turboChargeResultIfSourceMap } from './turboChargeResultIfSourceMap'\nimport type {\n  DefineListenerContext,\n  ListenerGetSnapshot,\n  ListenerSubscribe,\n  Logger,\n} from './types'\nimport { getQueryCacheKey, type QueryCacheKey } from './utils'\n\nexport type { Logger }\n\n/**\n * @internal\n */\nexport interface LiveStoreProviderProps {\n  children: React.ReactNode\n  /**\n   * The Sanity client to use for fetching data and listening to mutations.\n   */\n  client: SanityClient\n  /**\n   * How frequently queries should be refetched in the background to refresh the parts of queries that can't be source mapped.\n   * Setting it to `0` will disable background refresh.\n   * @defaultValue 10000\n   */\n  refreshInterval?: number\n  perspective: ClientPerspective\n  liveDocument: SanityDocument | null\n}\n/**\n * @internal\n */\nconst LiveStoreProvider = memo(function LiveStoreProvider(\n  props: LiveStoreProviderProps,\n) {\n  const {\n    liveDocument,\n    children,\n    client,\n    refreshInterval = 2000,\n    perspective,\n  } = props\n  if (perspective === 'raw') {\n    throw new Error('LiveStoreProvider does not support the raw perspective')\n  }\n\n  const [subscriptions, setSubscriptions] = useState<QueryCacheKey[]>([])\n  const [snapshots] = useState<QuerySnapshotsCache>(() => new Map())\n  const hooks = useHooks(setSubscriptions)\n  const [context] = useState<DefineListenerContext>(() => {\n    return function defineListener<QueryResult>(\n      initialSnapshot: QueryResult,\n      query: string,\n      params: QueryParams,\n    ) {\n      const key = getQueryCacheKey(perspective, query, params)\n\n      const subscribe: ListenerSubscribe = (onStoreChange) => {\n        const unsubscribe = hooks.subscribe(\n          key,\n          perspective,\n          query,\n          params,\n          onStoreChange,\n        )\n\n        return () => unsubscribe()\n      }\n      const getSnapshot: ListenerGetSnapshot<{\n        result: QueryResult\n        resultSourceMap?: ContentSourceMap\n      }> = () =>\n        snapshots.get(key) as unknown as {\n          result: QueryResult\n          resultSourceMap?: ContentSourceMap\n        }\n\n      return { subscribe, getSnapshot }\n    } satisfies DefineListenerContext\n  })\n  const [turboIds, setTurboIds] = useState<string[]>([])\n  const turboIdsFromSourceMap = useCallback(\n    (contentSourceMap: ContentSourceMap) => {\n      // This handler only adds ids, on each query fetch. But that's ok since <Turbo /> purges ids that are unused\n      const nextTurboIds = new Set<string>()\n      if (contentSourceMap.documents?.length) {\n        for (const { _id } of contentSourceMap.documents) {\n          // @TODO only add local ids, not remote ones\n          nextTurboIds.add(_id)\n        }\n      }\n      setTurboIds((prevTurboIds) => {\n        const mergedTurboIds = Array.from(\n          new Set([...prevTurboIds, ...nextTurboIds]),\n        )\n        if (\n          JSON.stringify(mergedTurboIds.sort()) ===\n          JSON.stringify(prevTurboIds.sort())\n        ) {\n          return prevTurboIds\n        }\n        return mergedTurboIds\n      })\n    },\n    [],\n  )\n\n  return (\n    <Context.Provider value={context}>\n      <IsEnabledContext.Provider value>{children}</IsEnabledContext.Provider>\n      <Turbo\n        liveDocument={liveDocument}\n        cache={hooks.cache}\n        client={client}\n        setTurboIds={setTurboIds}\n        snapshots={snapshots}\n        turboIds={turboIds}\n        perspective={perspective}\n      />\n      {subscriptions.map((key) => {\n        if (!hooks.cache.has(key)) return null\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const { query, params, listeners } = hooks.cache.get(key)!\n        return (\n          <QuerySubscription\n            key={key}\n            liveDocument={liveDocument}\n            client={client}\n            listeners={listeners}\n            params={params}\n            query={query}\n            refreshInterval={refreshInterval}\n            snapshots={snapshots}\n            turboIdsFromSourceMap={turboIdsFromSourceMap}\n            perspective={perspective}\n          />\n        )\n      })}\n    </Context.Provider>\n  )\n})\nLiveStoreProvider.displayName = 'LiveStoreProvider'\nexport default LiveStoreProvider\n\ninterface QuerySubscriptionProps\n  extends Required<Pick<LiveStoreProviderProps, 'client' | 'refreshInterval'>> {\n  liveDocument: SanityDocument | null\n  query: string\n  params: QueryParams\n  listeners: Set<() => void>\n  turboIdsFromSourceMap: (contentSourceMap: ContentSourceMap) => void\n  snapshots: QuerySnapshotsCache\n  perspective: ClientPerspective\n}\nconst QuerySubscription = memo(function QuerySubscription(\n  props: QuerySubscriptionProps,\n) {\n  const {\n    liveDocument,\n    client,\n    refreshInterval,\n    query,\n    params,\n    listeners,\n    snapshots,\n    turboIdsFromSourceMap,\n    perspective,\n  } = props\n  const { projectId, dataset } = useMemo(() => {\n    const { projectId, dataset } = client.config()\n    return { projectId, dataset } as Required<\n      Pick<ClientConfig, 'projectId' | 'dataset'>\n    >\n  }, [client])\n\n  // Make sure any async errors bubble up to the nearest error boundary\n  const [error, setError] = useState<unknown>(null)\n  if (error) throw error\n\n  const [revalidate, startRefresh] = useRevalidate({ refreshInterval })\n  const shouldRefetch = revalidate === 'refresh' || revalidate === 'inflight'\n  useEffect(() => {\n    if (!shouldRefetch) {\n      return\n    }\n\n    let fulfilled = false\n    let fetching = false\n    const controller = new AbortController()\n    // eslint-disable-next-line no-inner-declarations\n    async function effect() {\n      const { signal } = controller\n      fetching = true\n      const { result, resultSourceMap } = await client.fetch(query, params, {\n        tag: 'presentation-loader',\n        signal,\n        perspective,\n        filterResponse: false,\n      })\n      fetching = false\n\n      if (!signal.aborted) {\n        snapshots.set(getQueryCacheKey(perspective, query, params), {\n          result: resultSourceMap\n            ? turboChargeResultIfSourceMap(\n                liveDocument,\n                projectId,\n                dataset,\n                result,\n                perspective,\n                resultSourceMap,\n              )\n            : result,\n          resultSourceMap,\n        })\n\n        if (resultSourceMap) {\n          turboIdsFromSourceMap(resultSourceMap)\n        }\n\n        // Notify listeners that snapshots are updated\n        for (const listener of listeners.values()) {\n          listener()\n        }\n        fulfilled = true\n      }\n    }\n    const onFinally = startRefresh()\n    effect()\n      .catch((error) => {\n        fetching = false\n        if (error.name !== 'AbortError') {\n          setError(error)\n        }\n      })\n      .finally(onFinally)\n    return () => {\n      if (!fulfilled && !fetching) {\n        controller.abort()\n      }\n    }\n  }, [\n    liveDocument,\n    client,\n    dataset,\n    listeners,\n    params,\n    projectId,\n    query,\n    shouldRefetch,\n    snapshots,\n    startRefresh,\n    turboIdsFromSourceMap,\n    perspective,\n  ])\n\n  return null\n})\nQuerySubscription.displayName = 'QuerySubscription'\n\ntype QuerySnapshotsCache = Map<\n  QueryCacheKey,\n  { result: unknown; resultSourceMap?: ContentSourceMap }\n>\n\ntype LiveStoreQueryCacheMap = Map<\n  QueryCacheKey,\n  {\n    query: string\n    params: QueryParams\n    perspective: ClientPerspective\n    listeners: Set<() => void>\n  }\n>\n\n/**\n * Keeps track of store subscribers per cache key, in a way that's designed for useSyncExternalStore.\n * The main difference from a typical subscription state with useEffect is that `adding` and `cleanup`\n * is wholly managed by the `subscribe` function in `useSyncExternalStore`, instead of lifecycles in useEffect.\n * And since the `onStoreChange` callback, provided to `subscribe`, notifies React when to re-render,\n * there is no need to use `setState` to trigger a re-render. That's why the Map is persisted in `useState` but the state setter isn't used.\n */\nfunction useHooks(\n  setSubscriptions: React.Dispatch<React.SetStateAction<QueryCacheKey[]>>,\n): {\n  cache: LiveStoreQueryCacheMap\n  subscribe: (\n    key: QueryCacheKey,\n    perspective: ClientPerspective,\n    query: string,\n    params: QueryParams,\n    listener: () => void,\n  ) => () => void\n} {\n  const [cache] = useState<LiveStoreQueryCacheMap>(() => new Map())\n  const subscribe = useCallback(\n    (\n      key: QueryCacheKey,\n      perspective: ClientPerspective,\n      query: string,\n      params: QueryParams,\n      listener: () => void,\n    ) => {\n      if (!cache.has(key)) {\n        cache.set(key, {\n          perspective,\n          query,\n          params,\n          listeners: new Set<() => void>(),\n        })\n        setSubscriptions((prevSubscriptions) => {\n          if (prevSubscriptions.includes(key)) {\n            return prevSubscriptions\n          }\n          return [...prevSubscriptions, key]\n        })\n      }\n      const hook = cache.get(key)\n      if (!hook || !hook.listeners) {\n        throw new TypeError('Inconsistent cache for key: ' + key)\n      }\n      const { listeners } = hook\n      listeners.add(listener)\n      return () => {\n        listeners.delete(listener)\n        if (listeners.size === 0) {\n          cache.delete(key)\n          setSubscriptions((prevSubscriptions) => {\n            if (prevSubscriptions.includes(key)) {\n              return prevSubscriptions.filter((sub) => sub !== key)\n            }\n            return prevSubscriptions\n          })\n        }\n      }\n    },\n    [cache, setSubscriptions],\n  )\n  return useMemo(() => ({ cache, subscribe }), [cache, subscribe])\n}\n\ninterface TurboProps extends Pick<LiveStoreProviderProps, 'client'> {\n  liveDocument: SanityDocument | null\n  turboIds: string[]\n  setTurboIds: React.Dispatch<React.SetStateAction<string[]>>\n  cache: LiveStoreQueryCacheMap\n  snapshots: QuerySnapshotsCache\n  perspective: DocumentCachePerspective\n}\n/**\n * A turbo-charged mutation observer that uses Content Source Maps to apply mendoza patches on your queries\n */\nconst Turbo = memo(function Turbo(props: TurboProps) {\n  const {\n    liveDocument,\n    client,\n    snapshots,\n    cache,\n    turboIds,\n    setTurboIds,\n    perspective,\n  } = props\n  const { projectId, dataset } = useMemo(() => {\n    const { projectId, dataset } = client.config()\n    return { projectId, dataset } as Required<\n      Pick<ClientConfig, 'projectId' | 'dataset'>\n    >\n  }, [client])\n\n  // Keep track of document ids that the active `useLiveQuery` hooks care about\n  useEffect(() => {\n    const nextTurboIds = new Set<string>()\n    for (const { perspective, query, params } of cache.values()) {\n      const key = getQueryCacheKey(perspective, query, params)\n      const snapshot = snapshots.get(key)\n      if (snapshot && snapshot.resultSourceMap?.documents?.length) {\n        for (const { _id } of snapshot.resultSourceMap.documents) {\n          nextTurboIds.add(_id)\n        }\n      }\n    }\n    const nextTurboIdsSnapshot = [...nextTurboIds].sort()\n    if (JSON.stringify(turboIds) !== JSON.stringify(nextTurboIdsSnapshot)) {\n      setTurboIds(nextTurboIdsSnapshot)\n    }\n  }, [cache, setTurboIds, snapshots, turboIds])\n\n  // Figure out which documents are missing from the cache\n  const [batch, setBatch] = useState<string[][]>([])\n  useEffect(() => {\n    const batchSet = new Set(batch.flat())\n    const nextBatch = new Set<string>()\n    for (const turboId of turboIds) {\n      if (\n        !batchSet.has(turboId) &&\n        !unstable__documentsCache.has(\n          unstable__getDocumentCacheKey(\n            { projectId, dataset, perspective },\n            { _id: turboId },\n          ),\n        )\n      ) {\n        nextBatch.add(turboId)\n      }\n    }\n    const nextBatchSlice = [...nextBatch].slice(0, LIVE_QUERY_CACHE_BATCH_SIZE)\n    if (nextBatchSlice.length === 0) return\n    setBatch((prevBatch) => [\n      ...prevBatch.slice(-LIVE_QUERY_CACHE_BATCH_SIZE),\n      nextBatchSlice,\n    ])\n  }, [batch, dataset, perspective, projectId, turboIds])\n\n  const [lastMutatedDocumentId, setLastMutatedDocumentId] = useState<string>()\n  // Use the same listen instance and patch documents as they come in\n  useEffect(() => {\n    const subscription = client\n      .listen(\n        perspective === 'published'\n          ? `*[!(_id in path(\"drafts.**\"))]`\n          : `*[_id in path(\"drafts.**\")]`,\n        {},\n        {\n          events: ['mutation'],\n          effectFormat: 'mendoza',\n          includePreviousRevision: false,\n          includeResult: false,\n          tag: 'presentation-loader',\n        },\n      )\n      .subscribe((update) => {\n        if (update.type !== 'mutation' || !update.effects?.apply?.length) return\n        // Schedule a reach state update with the ID of the document that were mutated\n        // This react handler will apply the document to related source map snapshots\n        const key = unstable__getDocumentCacheKey(\n          { projectId, dataset, perspective },\n          { _id: update.documentId },\n        )\n        const cachedDocument = unstable__documentsCache.peek(key)\n        if (cachedDocument as SanityDocument) {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          const patchDoc = { ...cachedDocument } as any\n          delete patchDoc._rev\n          const patchedDocument = applyPatch(patchDoc, update.effects.apply)\n          unstable__documentsCache.set(key, patchedDocument)\n        }\n\n        setLastMutatedDocumentId(update.documentId)\n      })\n    return () => subscription.unsubscribe()\n  }, [client, dataset, perspective, projectId])\n\n  // If the last mutated document is in the list over turboIds then lets apply the source map\n  useEffect(() => {\n    if (!lastMutatedDocumentId || !turboIds.includes(lastMutatedDocumentId))\n      return\n\n    const updatedKeys: QueryCacheKey[] = []\n    for (const [key, snapshot] of snapshots.entries()) {\n      if (snapshot.resultSourceMap?.documents?.length) {\n        snapshot.result = turboChargeResultIfSourceMap(\n          liveDocument,\n          projectId,\n          dataset,\n          snapshot.result,\n          perspective,\n          snapshot.resultSourceMap,\n        )\n        updatedKeys.push(key)\n      }\n    }\n    for (const updatedKey of updatedKeys) {\n      const listeners = cache.get(updatedKey)?.listeners\n      if (listeners) {\n        for (const listener of listeners) {\n          listener()\n        }\n      }\n    }\n    setLastMutatedDocumentId(undefined)\n  }, [\n    liveDocument,\n    cache,\n    dataset,\n    lastMutatedDocumentId,\n    perspective,\n    projectId,\n    snapshots,\n    turboIds,\n  ])\n\n  const [lastDraftDocumentRev, setLastDraftDocumentRev] = useState<string>()\n  useEffect(() => {\n    if (!lastDraftDocumentRev) return\n\n    const updatedKeys: QueryCacheKey[] = []\n    for (const [key, snapshot] of snapshots.entries()) {\n      if (snapshot.resultSourceMap?.documents?.length) {\n        snapshot.result = turboChargeResultIfSourceMap(\n          liveDocument,\n          projectId,\n          dataset,\n          snapshot.result,\n          perspective,\n          snapshot.resultSourceMap,\n        )\n        updatedKeys.push(key)\n      }\n    }\n    for (const updatedKey of updatedKeys) {\n      const listeners = cache.get(updatedKey)?.listeners\n      if (listeners) {\n        for (const listener of listeners) {\n          listener()\n        }\n      }\n    }\n  }, [\n    cache,\n    dataset,\n    liveDocument,\n    lastDraftDocumentRev,\n    perspective,\n    projectId,\n    snapshots,\n  ])\n  useEffect(() => {\n    if (liveDocument) {\n      setLastDraftDocumentRev(liveDocument._rev)\n    }\n  }, [liveDocument])\n\n  return (\n    <>\n      {batch.map((ids) => (\n        <GetDocuments\n          key={JSON.stringify(ids)}\n          client={client}\n          projectId={projectId}\n          dataset={dataset}\n          ids={ids}\n          perspective={perspective}\n        />\n      ))}\n    </>\n  )\n})\nTurbo.displayName = 'Turbo'\n\ninterface GetDocumentsProps extends Pick<LiveStoreProviderProps, 'client'> {\n  projectId: string\n  dataset: string\n  ids: string[]\n  perspective: DocumentCachePerspective\n}\nconst GetDocuments = memo(function GetDocuments(props: GetDocumentsProps) {\n  const { client, projectId, dataset, ids, perspective } = props\n\n  useEffect(() => {\n    const missingIds = ids.filter(\n      (id) =>\n        !unstable__documentsCache.has(\n          unstable__getDocumentCacheKey(\n            { projectId, dataset, perspective },\n            { _id: id },\n          ),\n        ),\n    )\n    if (missingIds.length === 0) return\n    client.getDocuments(missingIds).then((documents) => {\n      for (const doc of documents) {\n        if (doc && doc?._id) {\n          unstable__documentsCache.set(\n            unstable__getDocumentCacheKey(\n              { projectId, dataset, perspective },\n              doc,\n            ),\n            doc,\n          )\n        }\n      }\n      // eslint-disable-next-line no-console\n    }, console.error)\n  }, [client, dataset, ids, perspective, projectId])\n\n  return null\n})\nGetDocuments.displayName = 'GetDocuments'\n","// This is a smaller version of `useLiveQuery`, as `LiveQuery` doesn't\n// need the more advanced features `useLiveQuery`, like the `isEqual` option or the `loading` state\n\nimport type { QueryParams as ClientQueryParams } from '@sanity/client'\nimport { useQueryParams } from '@sanity/visual-editing-helpers/hooks'\nimport {\n  useCallback,\n  useContext,\n  useMemo,\n  useState,\n  useSyncExternalStore,\n} from 'react'\n\nimport { defineListenerContext } from './context'\n\n// Re-export types we use that are needed externally\nexport type { ClientQueryParams }\n\n/** @public */\nexport function useLiveQuery<\n  QueryResult,\n  QueryParams extends ClientQueryParams = ClientQueryParams,\n>(\n  initialData: QueryResult,\n  query: string,\n  queryParams2?: QueryParams,\n): QueryResult {\n  const defineStore = useContext(defineListenerContext)\n  if (!defineStore) {\n    throw new Error('useLiveQuery must be used inside a <LiveQueryProvider />')\n  }\n  const queryParams = useQueryParams(queryParams2)\n  const store = useMemo(\n    () => defineStore<QueryResult>(initialData, query, queryParams),\n    [defineStore, initialData, queryParams, query],\n  )\n  // initialSnapshot might change before hydration is done, so deep cloning it on the first hook call\n  // helps ensure that we don't get a mismatch between the server and client snapshots\n  const [serverSnapshot] = useState(() => {\n    if (initialData === undefined) {\n      throw new Error(\n        `initialSnapshot can't be undefined, if you don't want an initial value use null instead`,\n      )\n    }\n    try {\n      return JSON.parse(JSON.stringify(initialData))\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        \"Failed to deep clone initialSnapshot, this is likely an error and an indication that the snapshot isn't JSON serializable\",\n        { initialSnapshot: initialData, error },\n      )\n      return initialData\n    }\n  })\n  const getServerSnapshot = useCallback(() => serverSnapshot, [serverSnapshot])\n\n  return useSyncExternalStore(\n    store.subscribe,\n    store.getSnapshot,\n    getServerSnapshot,\n  )\n}\n","import type { ChannelsController } from '@sanity/channels'\nimport type {\n  ClientPerspective,\n  ContentSourceMap,\n  QueryParams,\n} from '@sanity/client'\nimport type {\n  LoaderPayloads,\n  VisualEditingMsg,\n} from '@sanity/visual-editing-helpers'\nimport { useEffect, useMemo } from 'react'\nimport { type SanityDocument, useClient } from 'sanity'\n\nimport LiveStoreProvider from './LiveStoreProvider'\nimport { useLiveQuery } from './useLiveQuery'\n\nexport default function LoaderQueries(props: {\n  activePerspective: boolean\n  liveDocument: SanityDocument | null\n  channel: ChannelsController<VisualEditingMsg> | undefined\n  perspective: ClientPerspective\n  liveQueries: Record<string, { query: string; params: QueryParams }>\n}): any {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const { activePerspective, liveDocument, channel, perspective, liveQueries } =\n    props\n  // @TODO lift up this client instance to the root, re-use it everywhere\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const studioClient = useClient({ apiVersion: '2023-10-16' })\n  const clientConfig = useMemo(() => studioClient.config(), [studioClient])\n  const client = useMemo(\n    () =>\n      studioClient.withConfig({\n        perspective,\n        resultSourceMap: 'withKeyArraySelector',\n      }),\n    [perspective, studioClient],\n  )\n  useEffect(() => {\n    if (channel && activePerspective) {\n      const { projectId, dataset } = clientConfig\n      channel.send('loaders', 'loader/perspective', {\n        projectId: projectId!,\n        dataset: dataset!,\n        perspective,\n      } satisfies LoaderPayloads['perspective'])\n    }\n  }, [activePerspective, channel, clientConfig, perspective])\n\n  return (\n    <LiveStoreProvider\n      liveDocument={liveDocument}\n      client={client}\n      perspective={perspective}\n      refreshInterval={activePerspective ? 2000 : 0}\n    >\n      {Object.entries(liveQueries).map(([key, { query, params }]) => (\n        <QuerySubscription\n          key={`${key}${perspective}`}\n          projectId={clientConfig.projectId!}\n          dataset={clientConfig.dataset!}\n          perspective={perspective}\n          query={query}\n          params={params}\n          channel={channel}\n        />\n      ))}\n    </LiveStoreProvider>\n  )\n}\n\nfunction QuerySubscription(props: {\n  projectId: string\n  dataset: string\n  perspective: ClientPerspective\n  query: string\n  params: QueryParams\n  channel: ChannelsController<VisualEditingMsg> | undefined\n}) {\n  const { projectId, dataset, perspective, query, params, channel } = props\n\n  const data = useLiveQuery<null | {\n    result: any\n    resultSourceMap?: ContentSourceMap\n  }>(null, query, params)\n  const result = data?.result\n  const resultSourceMap = data?.resultSourceMap\n\n  useEffect(() => {\n    if (resultSourceMap) {\n      channel!.send('loaders', 'loader/query-change', {\n        projectId,\n        dataset,\n        perspective,\n        query,\n        params,\n        result,\n        resultSourceMap,\n      } satisfies LoaderPayloads['query-change'])\n    }\n  }, [\n    channel,\n    dataset,\n    params,\n    perspective,\n    projectId,\n    query,\n    result,\n    resultSourceMap,\n  ])\n\n  return null\n}\n","import { createContext, type CSSProperties } from 'react'\n\nimport { PanelElement, ResizerElement } from './types'\n\nexport const PanelsContext = createContext<{\n  activeResizer: string | null\n  drag: (id: string, event: MouseEvent) => void\n  getPanelStyle: (id: string) => CSSProperties\n  registerElement: (id: string, panel: PanelElement | ResizerElement) => void\n  startDragging: (id: string, event: MouseEvent) => void\n  stopDragging: () => void\n  unregisterElement: (id: string) => void\n} | null>(null)\n\nPanelsContext.displayName = 'PanelsContext'\n","import {\n  FunctionComponent,\n  PropsWithChildren,\n  useContext,\n  useLayoutEffect,\n} from 'react'\nimport styled from 'styled-components'\n\nimport { PanelsContext } from './PanelsContext'\n\ninterface PanelProps extends PropsWithChildren {\n  defaultSize?: number | null\n  id: string\n  minWidth?: number\n  maxWidth?: number\n  order?: number\n}\n\nconst Root = styled.div`\n  overflow: hidden;\n  flex-basis: 0;\n  flex-shrink: 1;\n`\n\nexport const Panel: FunctionComponent<PanelProps> = function ({\n  children,\n  defaultSize = null,\n  id,\n  minWidth,\n  maxWidth,\n  order = 0,\n}) {\n  const context = useContext(PanelsContext)\n\n  if (context === null) {\n    throw Error(\n      `Panel components must be rendered within a PanelGroup container`,\n    )\n  }\n\n  const { getPanelStyle, registerElement, unregisterElement } = context\n\n  const style = getPanelStyle(id)\n\n  useLayoutEffect(() => {\n    registerElement(id, {\n      id,\n      type: 'panel',\n      defaultSize,\n      maxWidth: maxWidth ?? null,\n      minWidth: minWidth ?? 0,\n      order,\n    })\n\n    return () => {\n      unregisterElement(id)\n    }\n  }, [\n    id,\n    defaultSize,\n    order,\n    maxWidth,\n    minWidth,\n    registerElement,\n    unregisterElement,\n  ])\n\n  return <Root style={style}>{children}</Root>\n}\n","import {\n  type FunctionComponent,\n  MouseEvent as ReactMouseEvent,\n  useCallback,\n  useContext,\n  useEffect,\n  useLayoutEffect,\n  useRef,\n} from 'react'\nimport styled from 'styled-components'\n\nimport { PanelsContext } from './PanelsContext'\nimport { usePanelId } from './usePanelId'\n\nconst Resizer = styled.div`\n  position: relative;\n`\nconst ResizerInner = styled.div<{\n  $disabled: boolean\n}>`\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: -5px;\n  width: 9px;\n  z-index: 10;\n  cursor: ${({ $disabled }) => ($disabled ? 'auto' : 'ew-resize')};\n\n  /* Border */\n  & > span:nth-child(1) {\n    display: block;\n    border-left: 1px solid var(--card-border-color);\n    position: absolute;\n    top: 0;\n    left: 4px;\n    bottom: 0;\n    transition: opacity 200ms;\n  }\n\n  ${({ $disabled }) =>\n    !$disabled &&\n    `\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  `}\n`\n\nexport const PanelResizer: FunctionComponent<{\n  id?: string\n  order: number\n  disabled?: boolean\n}> = function ({ id: propId, order, disabled = false }) {\n  const el = useRef<HTMLDivElement>(null)\n\n  const context = useContext(PanelsContext)\n\n  if (context === null) {\n    throw Error(\n      `Panel components must be rendered within a PanelGroup container`,\n    )\n  }\n\n  const id = usePanelId(propId)\n\n  const {\n    activeResizer,\n    drag,\n    startDragging,\n    stopDragging,\n    registerElement,\n    unregisterElement,\n  } = context\n\n  const isDragging = activeResizer === id\n\n  if (context === null) {\n    throw Error(\n      `Panel components must be rendered within a PanelGroup container`,\n    )\n  }\n\n  const onMouseDown = useCallback(\n    (event: ReactMouseEvent) => {\n      startDragging(id, event.nativeEvent)\n    },\n    [id, startDragging],\n  )\n\n  const onDrag = useCallback(\n    (e: MouseEvent) => {\n      drag(id, e)\n    },\n    [id, drag],\n  )\n\n  const onDragStop = useCallback(() => {\n    el.current!.blur()\n    stopDragging()\n  }, [stopDragging])\n\n  useEffect(() => {\n    if (!isDragging || disabled) return\n\n    window.addEventListener('mousemove', onDrag)\n    window.addEventListener('mouseup', onDragStop)\n\n    return () => {\n      window.removeEventListener('mousemove', onDrag)\n      window.removeEventListener('mouseup', onDragStop)\n    }\n  }, [disabled, isDragging, onDrag, onDragStop])\n\n  useLayoutEffect(() => {\n    registerElement(id, { id, order, type: 'resizer', el })\n\n    return () => {\n      unregisterElement(id)\n    }\n  }, [id, order, registerElement, unregisterElement])\n\n  return (\n    <Resizer onMouseDown={onMouseDown} ref={el}>\n      <ResizerInner $disabled={disabled}>\n        <span />\n        <span />\n      </ResizerInner>\n    </Resizer>\n  )\n}\n","import { useRef } from 'react'\nimport { v4 as uuid } from 'uuid'\n\nexport function usePanelId(id?: string): string {\n  const idRef = useRef(id || uuid())\n  return idRef.current\n}\n","export function debounce<F extends (...args: any[]) => void>(\n  fn: F,\n  timeout: number,\n): F {\n  let timer: any\n  return ((...args: any[]) => {\n    clearTimeout(timer)\n    timer = setTimeout(() => {\n      fn.apply(fn, args)\n    }, timeout)\n  }) as F\n}\n","import { useMemo } from 'react'\n\nimport { debounce } from '../lib/debounce'\nimport { PanelElement } from './types'\n\nconst itemKey = 'presentation/panels'\n\ntype StoredPanelsState = Record<string, number[]>\n\nconst getStoredItem = () => {\n  // @todo Validate\n  return JSON.parse(localStorage.getItem(itemKey) || '{}') as StoredPanelsState\n}\nconst setStoredItem = (data: StoredPanelsState) => {\n  localStorage.setItem(itemKey, JSON.stringify(data))\n}\n\nconst getKeyForPanels = (panels: PanelElement[]) => {\n  return panels.map((panel) => [panel.id, panel.order].join(':')).join(',')\n}\n\nexport function usePanelsStorage(): {\n  get: (panels: PanelElement[]) => number[]\n  set: (panels: PanelElement[], widths: number[]) => void\n  setDebounced: (panels: PanelElement[], widths: number[]) => void\n} {\n  return useMemo(() => {\n    const get = (panels: PanelElement[]) => {\n      const stored = getStoredItem()\n      const key = getKeyForPanels(panels)\n      return stored[key]\n    }\n\n    const set = (panels: PanelElement[], widths: number[]) => {\n      const stored = getStoredItem()\n      const key = getKeyForPanels(panels)\n      const data = {\n        ...stored,\n        [key]: widths,\n      }\n      setStoredItem(data)\n    }\n\n    const setDebounced = debounce(set, 100)\n    return {\n      get,\n      set,\n      setDebounced,\n    }\n  }, [])\n}\n","import {\n  ElementMap,\n  InitialDragState,\n  PanelElement,\n  PanelsState,\n  ResizerElement,\n} from './types'\n\nfunction getNextWidth(\n  panel: PanelElement,\n  nextWidth: number,\n  containerWidth: number,\n) {\n  const { maxWidth: maxWidthPx, minWidth: minWidthPx } = panel\n  const maxWidth =\n    maxWidthPx == null ? 100 : (maxWidthPx / containerWidth) * 100\n  const minWidth = (minWidthPx / containerWidth) * 100\n  return Math.min(maxWidth, Math.max(minWidth, nextWidth))\n}\n\nexport function getNextWidths(\n  delta: number,\n  containerWidth: number,\n  panelBefore: PanelElement,\n  panelAfter: PanelElement,\n  panelsState: PanelsState,\n  initialDragState: InitialDragState,\n): number[] {\n  const { panels, widths: prevWidths } = panelsState\n  const { widths: initialWidths } = initialDragState\n\n  const widths = initialWidths || prevWidths\n  const nextWidths = [...widths]\n\n  {\n    const pivotPanel = delta < 0 ? panelAfter : panelBefore\n    const index = panels.findIndex((panel) => panel.id === pivotPanel.id)\n    const width = widths[index]\n    const nextWidth = getNextWidth(\n      pivotPanel,\n      width + Math.abs(delta),\n      containerWidth,\n    )\n    if (width === nextWidth) {\n      return widths\n    } else {\n      delta = delta < 0 ? width - nextWidth : nextWidth - width\n    }\n  }\n\n  let deltaApplied = 0\n  let pivotPanel = delta < 0 ? panelBefore : panelAfter\n  let index = panels.findIndex((panel) => panel.id === pivotPanel.id)\n\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    const panel = panels[index]\n    const width = widths[index]\n\n    const deltaRemaining = Math.abs(delta) - Math.abs(deltaApplied)\n\n    const nextWidth = getNextWidth(\n      panel,\n      width - deltaRemaining,\n      containerWidth,\n    )\n\n    if (width !== nextWidth) {\n      deltaApplied += width - nextWidth\n      nextWidths[index] = nextWidth\n\n      if (\n        deltaApplied\n          .toPrecision(10)\n          .localeCompare(Math.abs(delta).toPrecision(10), undefined, {\n            numeric: true,\n          }) >= 0\n      ) {\n        break\n      }\n    }\n\n    if (delta < 0) {\n      if (--index < 0) {\n        break\n      }\n    } else {\n      if (++index >= panels.length) {\n        break\n      }\n    }\n  }\n\n  if (deltaApplied === 0) {\n    return widths\n  }\n\n  pivotPanel = delta < 0 ? panelAfter : panelBefore\n  index = panels.findIndex((panel) => panel.id === pivotPanel.id)\n  nextWidths[index] = widths[index] + deltaApplied\n\n  return nextWidths\n}\n\nexport function getPanelWidth(\n  panels: PanelElement[],\n  id: string,\n  widths: number[],\n): string {\n  if (panels.length === 1) return '100'\n\n  const index = panels.findIndex((panel) => panel.id === id)\n  const width = widths[index]\n\n  if (width == null) return '0'\n\n  return width.toPrecision(10)\n}\n\nexport function getOffset(\n  event: MouseEvent,\n  handleElement: HTMLDivElement,\n  initialOffset: number = 0,\n  initialHandleElementRect: DOMRect | null = null,\n): number {\n  const pointerOffset = event.clientX\n\n  const rect = initialHandleElementRect || handleElement.getBoundingClientRect()\n  const elementOffset = rect.left\n\n  return pointerOffset - elementOffset - initialOffset\n}\n\nexport function isPanel(\n  element: PanelElement | ResizerElement,\n): element is PanelElement {\n  return element.type === 'panel'\n}\n\nexport function isResizer(\n  element: PanelElement | ResizerElement,\n): element is ResizerElement {\n  return element.type === 'resizer'\n}\n\nexport function getSortedElements(\n  elements: ElementMap,\n): Array<PanelElement | ResizerElement> {\n  return Array.from(elements.values()).sort(({ order: a }, { order: b }) => {\n    if (a == null && b == null) return 0\n    if (a == null) return -1\n    if (b == null) return 1\n    return a - b\n  })\n}\n\nexport function validateWidths(\n  panels: PanelElement[],\n  widthsToValidate: number[],\n  containerWidth: number,\n): number[] {\n  // Clamp widths proportionally to total 100\n  const total = widthsToValidate.reduce((total, width) => total + width, 0)\n  const widths = [...widthsToValidate].map((width) => (width / total) * 100)\n\n  let remainingWidth = 0\n\n  for (let index = 0; index < panels.length; index++) {\n    const panel = panels[index]\n    const width = widths[index]\n    const nextWidth = getNextWidth(panel, width, containerWidth)\n    if (width != nextWidth) {\n      remainingWidth += width - nextWidth\n      widths[index] = nextWidth\n    }\n  }\n\n  if (remainingWidth.toFixed(3) !== '0.000') {\n    for (let index = 0; index < panels.length; index++) {\n      const panel = panels[index]\n\n      let { maxWidth, minWidth } = panel\n\n      minWidth = (minWidth / containerWidth) * 100\n      if (maxWidth != null) {\n        maxWidth = (maxWidth / containerWidth) * 100\n      }\n\n      const width = Math.min(\n        maxWidth != null ? maxWidth : 100,\n        Math.max(minWidth, widths[index] + remainingWidth),\n      )\n\n      if (width !== widths[index]) {\n        remainingWidth -= width - widths[index]\n        widths[index] = width\n\n        if (Math.abs(remainingWidth).toFixed(3) === '0.000') {\n          break\n        }\n      }\n    }\n  }\n\n  return widths\n}\n\nexport function getDefaultWidths(panels: PanelElement[]): number[] {\n  let panelsWithoutWidth = panels.length\n  let remainingWidthTotal = 100\n\n  const widthsWithNulls = panels.map((panel) => {\n    if (panel.defaultSize) {\n      remainingWidthTotal = remainingWidthTotal - panel.defaultSize\n      panelsWithoutWidth = panelsWithoutWidth - 1\n      return panel.defaultSize\n    }\n    return null\n  })\n\n  const defaultWidth = remainingWidthTotal / panelsWithoutWidth\n  const widths = widthsWithNulls.map((width) => {\n    if (width === null) return defaultWidth\n    return width\n  })\n\n  return widths\n}\n","// Slightly modified version of react-resizable-panels\n// https://github.com/bvaughn/react-resizable-panels/tree/main/packages/react-resizable-panels\n\nimport {\n  type CSSProperties,\n  type FunctionComponent,\n  PropsWithChildren,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport styled from 'styled-components'\n\nimport { PanelsContext } from './PanelsContext'\nimport {\n  ElementMap,\n  InitialDragState,\n  PanelElement,\n  PanelsState,\n  ResizerElement,\n} from './types'\nimport { usePanelsStorage } from './usePanelsStorage'\nimport {\n  getDefaultWidths,\n  getNextWidths,\n  getOffset,\n  getPanelWidth,\n  getSortedElements,\n  isPanel,\n  isResizer,\n  validateWidths,\n} from './util'\n\nconst PanelsWrapper = styled.div`\n  display: flex;\n  flex-direction: row;\n  height: 100%;\n  overflow: hidden;\n  width: 100%;\n`\n\nexport const Panels: FunctionComponent<PropsWithChildren> = function ({\n  children,\n}) {\n  const panelsEl = useRef<HTMLDivElement | null>(null)\n\n  const [elements, setElements] = useState<ElementMap>(new Map())\n\n  const panels = useMemo(\n    () => getSortedElements(elements).filter(isPanel),\n    [elements],\n  )\n\n  const [widths, setWidths] = useState<number[]>([])\n  const [activeResizer, setActiveResizer] = useState<string | null>(null)\n\n  const panelsRef = useRef<PanelsState>({\n    elements,\n    panels,\n    widths,\n  })\n\n  const getPanelStyle = useCallback(\n    (id: string): CSSProperties => {\n      return {\n        flexGrow: getPanelWidth(panels, id, widths),\n        pointerEvents: activeResizer === null ? undefined : 'none',\n      }\n    },\n    [activeResizer, panels, widths],\n  )\n\n  const registerElement = useCallback(\n    (id: string, data: PanelElement | ResizerElement) => {\n      setElements((prev) => {\n        if (prev.has(id)) return prev\n        const next = new Map(prev)\n        next.set(id, data)\n        return next\n      })\n    },\n    [],\n  )\n  const unregisterElement = useCallback((id: string) => {\n    setElements((prev) => {\n      if (!prev.has(id)) return prev\n      const next = new Map(prev)\n      next.delete(id)\n      return next\n    })\n  }, [])\n\n  const dragRef = useRef<InitialDragState>({\n    containerWidth: window.innerWidth,\n    dragOffset: 0,\n    panelAfter: null,\n    panelBefore: null,\n    resizerIndex: -1,\n    resizerRect: null,\n    startX: 0,\n    widths: [],\n  })\n\n  const startDragging = useCallback(\n    (id: string, event: MouseEvent) => {\n      const elementsArr = getSortedElements(elements)\n      const index = elementsArr.findIndex((el) => el.id === id)\n\n      const resizer = elements.get(id)\n      if (!resizer || !isResizer(resizer)) return\n      const resizeElement = resizer.el.current\n      if (!resizeElement) return\n\n      dragRef.current = {\n        resizerIndex: index,\n        panelBefore: elementsArr.reduce(\n          (acc, el, i) => (isPanel(el) && i < index ? el : acc),\n          null as PanelElement | null,\n        ),\n        panelAfter: elementsArr.reduce(\n          (acc, el, i) => (acc === null && isPanel(el) && i > index ? el : acc),\n          null as PanelElement | null,\n        ),\n        containerWidth: window.innerWidth,\n        startX: event.pageX,\n        dragOffset: getOffset(event, resizeElement),\n        resizerRect: resizeElement.getBoundingClientRect(),\n        widths: panelsRef.current.widths,\n      }\n\n      setActiveResizer(id)\n    },\n    [elements],\n  )\n\n  const stopDragging = useCallback(() => {\n    setActiveResizer(null)\n  }, [])\n\n  const drag = useCallback(\n    (id: string, event: MouseEvent) => {\n      event.preventDefault()\n      event.stopPropagation()\n\n      const {\n        containerWidth,\n        dragOffset,\n        panelBefore,\n        panelAfter,\n        resizerRect,\n      } = dragRef.current\n\n      if (panelBefore == null || panelAfter == null) {\n        return\n      }\n\n      const resizer = elements.get(id)\n      if (!resizer || !isResizer(resizer)) return\n      const resizeElement = resizer.el.current\n      if (!resizeElement) return\n\n      const offset = getOffset(event, resizeElement, dragOffset, resizerRect)\n\n      if (offset === 0) {\n        return\n      }\n\n      const { widths: prevWidths } = panelsRef.current\n      const rect = panelsEl.current!.getBoundingClientRect()\n      const delta = (offset / rect.width) * 100\n\n      const nextWidths = getNextWidths(\n        delta,\n        containerWidth,\n        panelBefore,\n        panelAfter,\n        panelsRef.current,\n        dragRef.current,\n      )\n\n      const widthsChanged = prevWidths.some(\n        (prevWidth, i) => prevWidth !== nextWidths[i],\n      )\n\n      if (widthsChanged) {\n        setWidths(nextWidths)\n      }\n    },\n    [elements],\n  )\n\n  // For setting the panels state\n  useLayoutEffect(() => {\n    panelsRef.current.elements = elements\n    panelsRef.current.panels = panels\n    panelsRef.current.widths = widths\n  }, [elements, panels, widths])\n\n  const storage = usePanelsStorage()\n\n  // For setting default sizing when panels are updated\n  useLayoutEffect(() => {\n    const { widths } = panelsRef.current\n\n    if (widths.length === panels.length) {\n      return\n    }\n\n    const storedWidths = storage.get(panels)\n\n    if (storedWidths) {\n      const validatedStoredWidths = validateWidths(\n        panels,\n        storedWidths,\n        window.innerWidth,\n      )\n      setWidths(validatedStoredWidths)\n      return\n    }\n\n    const defaultWidths = getDefaultWidths(panels)\n    setWidths(defaultWidths)\n  }, [storage, panels])\n\n  // For storing current widths in localStorage\n  useEffect(() => {\n    if (!widths.length) return\n    storage.setDebounced(panels, widths)\n  }, [storage, panels, widths])\n\n  useLayoutEffect(() => {\n    const resizeObserver = new ResizeObserver(() => {\n      const { panels, widths: prevWidths } = panelsRef.current\n\n      const nextWidths = validateWidths(panels, prevWidths, window.innerWidth)\n\n      const widthsChanged = prevWidths.some(\n        (prevWidth, i) => prevWidth !== nextWidths[i],\n      )\n      if (widthsChanged) {\n        setWidths(nextWidths)\n      }\n    })\n\n    resizeObserver.observe(panelsEl.current!)\n\n    return () => {\n      resizeObserver.disconnect()\n    }\n  }, [])\n\n  const context = useMemo(\n    () => ({\n      activeResizer,\n      drag,\n      getPanelStyle,\n      registerElement,\n      startDragging,\n      stopDragging,\n      unregisterElement,\n    }),\n    [\n      activeResizer,\n      drag,\n      getPanelStyle,\n      registerElement,\n      startDragging,\n      stopDragging,\n      unregisterElement,\n    ],\n  )\n\n  return (\n    <PanelsContext.Provider value={context}>\n      <PanelsWrapper ref={panelsEl}>{children}</PanelsWrapper>\n    </PanelsContext.Provider>\n  )\n}\n","import { ReactNode } from 'react'\nimport { useEditState } from 'sanity'\n\nexport function HoldEditState(props: { id: string; type: string }): ReactNode {\n  const { id, type } = props\n\n  useEditState(id, type)\n\n  return null\n}\n","import {\n  FunctionComponent,\n  PropsWithChildren,\n  useCallback,\n  useMemo,\n} from 'react'\n\nimport {\n  PresentationNavigateContext,\n  PresentationNavigateContextValue,\n} from './PresentationNavigateContext'\nimport { SetPresentationParams } from './types'\n\nexport const PresentationNavigateProvider: FunctionComponent<\n  PropsWithChildren<{\n    setParams: SetPresentationParams\n  }>\n> = function (props) {\n  const { children, setParams } = props\n\n  const navigate = useCallback(\n    (preview: string) => {\n      setParams({ preview })\n    },\n    [setParams],\n  )\n\n  const context = useMemo<PresentationNavigateContextValue>(\n    () => navigate,\n    [navigate],\n  )\n\n  return (\n    <PresentationNavigateContext.Provider value={context}>\n      {children}\n    </PresentationNavigateContext.Provider>\n  )\n}\n","import { memo, useCallback, useMemo } from 'react'\n\nimport { Panel } from './panels/Panel'\nimport { PanelResizer } from './panels/PanelResizer'\nimport type { NavigatorOptions } from './types'\nimport { useLocalState } from './useLocalState'\n\n/** @internal */\nexport interface UsePresentationNavigatorProps {\n  unstable_navigator?: NavigatorOptions\n}\n\n/** @internal */\nexport interface UsePresentationNavigatorState {\n  navigatorEnabled: boolean\n  toggleNavigator: (() => void) | undefined\n}\n\n/** @internal */\nexport function usePresentationNavigator(\n  props: UsePresentationNavigatorProps,\n): [UsePresentationNavigatorState, () => JSX.Element] {\n  const { unstable_navigator } = props\n\n  const navigatorProvided = !!unstable_navigator?.component\n  const [_navigatorEnabled, setNavigatorEnabled] = useLocalState<boolean>(\n    'presentation/navigator',\n    navigatorProvided,\n  )\n  const navigatorEnabled = navigatorProvided ? _navigatorEnabled : false\n  const toggleNavigator = useMemo(() => {\n    if (!navigatorProvided) return undefined\n\n    return () => setNavigatorEnabled((enabled) => !enabled)\n  }, [navigatorProvided, setNavigatorEnabled])\n\n  const Component = useCallback(\n    function PresentationNavigator() {\n      return <>{navigatorEnabled && <Navigator {...unstable_navigator!} />}</>\n    },\n    [navigatorEnabled, unstable_navigator],\n  )\n\n  return [{ navigatorEnabled, toggleNavigator }, Component]\n}\n\nfunction NavigatorComponent(props: NavigatorOptions) {\n  const { minWidth, maxWidth, component: NavigatorComponent } = props\n  const navigatorDisabled =\n    minWidth != null && maxWidth != null && minWidth === maxWidth\n  return (\n    <>\n      <Panel id=\"navigator\" minWidth={minWidth} maxWidth={maxWidth} order={1}>\n        <NavigatorComponent />\n      </Panel>\n      <PanelResizer order={2} disabled={navigatorDisabled} />\n    </>\n  )\n}\nconst Navigator = memo(NavigatorComponent)\n","import { Dispatch, SetStateAction, useEffect, useState } from 'react'\n\nexport function useLocalState<T>(\n  key: string,\n  defaultValue: T,\n): [T, Dispatch<SetStateAction<T>>] {\n  const [value, setValue] = useState<T>(() =>\n    JSON.parse(localStorage.getItem(key) ?? JSON.stringify(defaultValue)),\n  )\n\n  useEffect(() => {\n    localStorage.setItem(key, JSON.stringify(value))\n  }, [key, value])\n\n  return [value, setValue]\n}\n","import { FunctionComponent, PropsWithChildren, useMemo } from 'react'\n\nimport { PresentationParamsContext } from './PresentationParamsContext'\nimport { PresentationParams } from './types'\n\nexport const PresentationParamsProvider: FunctionComponent<\n  PropsWithChildren<{\n    params: PresentationParams\n  }>\n> = function (props) {\n  const { children, params } = props\n\n  const context = useMemo<PresentationParams>(() => params, [params])\n\n  return (\n    <PresentationParamsContext.Provider value={context}>\n      {children}\n    </PresentationParamsContext.Provider>\n  )\n}\n","import { FunctionComponent, PropsWithChildren, useMemo } from 'react'\n\nimport {\n  PresentationContext,\n  PresentationContextValue,\n} from './PresentationContext'\nimport {\n  DeskDocumentPaneParams,\n  PresentationParams,\n  SetPresentationParams,\n} from './types'\n\nexport const PresentationProvider: FunctionComponent<\n  PropsWithChildren<{\n    deskParams: DeskDocumentPaneParams\n    devMode: boolean\n    name: string\n    params: PresentationParams\n    setParams: SetPresentationParams\n  }>\n> = function (props) {\n  const { children, deskParams, devMode, name, params, setParams } = props\n\n  const context = useMemo<PresentationContextValue>(\n    () => ({\n      deskParams,\n      devMode,\n      name,\n      params,\n      setParams,\n    }),\n    [deskParams, devMode, name, params, setParams],\n  )\n\n  return (\n    <PresentationContext.Provider value={context}>\n      {children}\n    </PresentationContext.Provider>\n  )\n}\n","import { motion } from 'framer-motion'\nimport styled from 'styled-components'\n\nexport const IFrame = motion(styled.iframe`\n  border: 0;\n  max-height: 100%;\n  width: 100%;\n  display: block;\n`)\n","import { LaunchIcon, ResetIcon } from '@sanity/icons'\nimport { Box, Button, TextInput, TextInputClearButtonProps } from '@sanity/ui'\nimport {\n  ChangeEvent,\n  FunctionComponent,\n  KeyboardEvent,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport { useActiveWorkspace } from 'sanity'\n\nimport { PresentationPluginOptions } from '../types'\n\nexport const PreviewLocationInput: FunctionComponent<{\n  fontSize?: number\n  onChange: (value: string) => void\n  openPopup: (url: string) => void\n  origin: string\n  padding?: number\n  value: string\n  unstable_showUnsafeShareUrl: PresentationPluginOptions['unstable_showUnsafeShareUrl']\n}> = function (props) {\n  const { basePath = '/' } = useActiveWorkspace()?.activeWorkspace || {}\n  const {\n    fontSize = 1,\n    onChange,\n    openPopup,\n    origin,\n    padding = 3,\n    value,\n    unstable_showUnsafeShareUrl,\n  } = props\n  const inputRef = useRef<HTMLInputElement | null>(null)\n  const [sessionValue, setSessionValue] = useState<string | undefined>(\n    undefined,\n  )\n  const [customValidity, setCustomValidity] = useState<string | undefined>(\n    undefined,\n  )\n\n  const handleChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n    setSessionValue(event.currentTarget.value)\n  }, [])\n\n  const handleOpenPopup = useCallback(\n    (event: React.MouseEvent<HTMLAnchorElement, MouseEvent>) => {\n      event.preventDefault()\n      openPopup(event.currentTarget.href)\n    },\n    [openPopup],\n  )\n\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent<HTMLInputElement>) => {\n      if (event.key === 'Enter') {\n        if (sessionValue === undefined) {\n          return\n        }\n\n        const absoluteValue =\n          sessionValue.startsWith('/') || sessionValue === ''\n            ? `${origin}${sessionValue}`\n            : sessionValue\n\n        if (\n          !absoluteValue.startsWith(origin + '/') &&\n          absoluteValue !== origin\n        ) {\n          setCustomValidity(`URL must start with ${origin}`)\n          return\n        }\n        // `origin` is an empty string '' if the Studio is embedded, and that's when we need to protect against recursion\n        if (\n          !origin &&\n          (absoluteValue.startsWith(`${basePath}/`) ||\n            absoluteValue === basePath)\n        ) {\n          setCustomValidity(\n            `URL can't have the same base path as the Studio ${basePath}`,\n          )\n          return\n        }\n\n        const nextValue =\n          absoluteValue === origin ? origin + '/' : absoluteValue\n\n        setCustomValidity(undefined)\n        setSessionValue(undefined)\n\n        onChange(nextValue.slice(origin.length))\n\n        inputRef.current?.blur()\n      }\n\n      if (event.key === 'Escape') {\n        setCustomValidity(undefined)\n        setSessionValue(undefined)\n      }\n    },\n    [basePath, onChange, origin, sessionValue],\n  )\n\n  const handleBlur = useCallback(() => {\n    setCustomValidity(undefined)\n    setSessionValue(undefined)\n  }, [])\n\n  useEffect(() => {\n    setCustomValidity(undefined)\n    setSessionValue(undefined)\n  }, [origin, value])\n\n  const resetButton: TextInputClearButtonProps = useMemo(\n    () => ({ icon: ResetIcon }),\n    [],\n  )\n\n  return (\n    <>\n      <TextInput\n        clearButton={customValidity ? resetButton : undefined}\n        customValidity={customValidity}\n        fontSize={fontSize}\n        onBlur={handleBlur}\n        onClear={() => {\n          setCustomValidity(undefined)\n          setSessionValue(origin + value)\n        }}\n        onChange={handleChange}\n        onKeyDownCapture={handleKeyDown}\n        padding={padding}\n        style={{ zIndex: 1 }}\n        radius={2}\n        ref={inputRef}\n        space={padding}\n        suffix={\n          unstable_showUnsafeShareUrl ? undefined : (\n            <Box padding={1} style={{ lineHeight: 0, zIndex: -1 }}>\n              <Button\n                as=\"a\"\n                fontSize={fontSize}\n                href={origin + (sessionValue || value)}\n                icon={LaunchIcon}\n                mode=\"bleed\"\n                onClick={handleOpenPopup as any}\n                padding={padding - 1}\n                rel=\"opener\"\n                target=\"_blank\"\n              />\n            </Box>\n          )\n        }\n        value={sessionValue === undefined ? `${origin}${value}` : sessionValue}\n      />\n    </>\n  )\n}\n","import type { ChannelStatus } from '@sanity/channels'\nimport { ClientPerspective } from '@sanity/client'\nimport {\n  CheckmarkIcon,\n  ChevronDownIcon,\n  CopyIcon,\n  DatabaseIcon,\n  DesktopIcon,\n  EditIcon,\n  LaunchIcon,\n  MobileDeviceIcon,\n  PanelLeftIcon,\n  PublishIcon,\n  RefreshIcon,\n  ShareIcon,\n} from '@sanity/icons'\nimport { createPreviewSecret } from '@sanity/preview-url-secret/create-secret'\nimport {\n  hasSecretSearchParams,\n  setSecretSearchParams,\n  withoutSecretSearchParams,\n} from '@sanity/preview-url-secret/without-secret-search-params'\nimport {\n  Box,\n  Button,\n  ButtonTone,\n  Card,\n  Code,\n  Flex,\n  Label,\n  Menu,\n  MenuButton,\n  MenuItem,\n  Spinner,\n  Stack,\n  Switch,\n  Text,\n  Tooltip,\n  TooltipDelayGroupProvider,\n  usePrefersReducedMotion,\n  useToast,\n} from '@sanity/ui'\nimport { AnimatePresence, motion, MotionConfig } from 'framer-motion'\nimport {\n  ComponentType,\n  createElement,\n  Dispatch,\n  forwardRef,\n  SetStateAction,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport { Hotkeys, useClient, useCurrentUser } from 'sanity'\nimport styled from 'styled-components'\n\nimport { ErrorCard } from '../components/ErrorCard'\nimport { API_VERSION, MAX_TIME_TO_OVERLAYS_CONNECTION } from '../constants'\nimport { PresentationParams, PresentationPluginOptions } from '../types'\nimport { usePresentationTool } from '../usePresentationTool'\nimport { IFrame } from './IFrame'\nimport { PreviewLocationInput } from './PreviewLocationInput'\n\nconst MotionFlex = motion(Flex)\n\nconst StyledSwitch = styled(Switch)`\n  & > span {\n    width: 21px;\n    height: 13px;\n    overflow: hidden;\n\n    & > span:nth-child(1) {\n      width: 21px;\n      height: 13px;\n    }\n\n    & > span:nth-child(2) {\n      width: 9px;\n      height: 9px;\n      top: 2px;\n      left: 2px;\n    }\n  }\n\n  & input:checked + span {\n    & > span:nth-child(2) {\n      transform: translate3d(8px, 0, 0) !important;\n    }\n  }\n`\n\nconst PERSPECTIVE_TITLES: Record<ClientPerspective, string> = {\n  previewDrafts: 'Drafts',\n  published: 'Published',\n  raw: 'Raw',\n}\n\nconst PERSPECTIVE_TONES: Record<ClientPerspective, ButtonTone> = {\n  previewDrafts: 'caution',\n  published: 'positive',\n  raw: 'default',\n}\n\nconst PERSPECTIVE_ICONS: Record<ClientPerspective, ComponentType> = {\n  previewDrafts: EditIcon,\n  published: PublishIcon,\n  raw: DatabaseIcon,\n}\n\ninterface PreviewFrameProps {\n  initialUrl: URL\n  targetOrigin: string\n  navigatorEnabled: boolean\n  onPathChange: (nextPath: string) => void\n  openPopup: (url: string) => void\n  overlayEnabled: boolean\n  params: PresentationParams\n  perspective: ClientPerspective\n  setPerspective: Dispatch<SetStateAction<ClientPerspective>>\n  toggleNavigator?: () => void\n  toggleOverlay: () => void\n  loadersConnection: ChannelStatus\n  overlaysConnection: ChannelStatus\n  previewKitConnection: ChannelStatus\n  unstable_showUnsafeShareUrl: PresentationPluginOptions['unstable_showUnsafeShareUrl']\n}\n\nexport const PreviewFrame = forwardRef<HTMLIFrameElement, PreviewFrameProps>(\n  function PreviewFrame(props, ref) {\n    const {\n      initialUrl,\n      targetOrigin,\n      navigatorEnabled,\n      onPathChange,\n      openPopup,\n      overlayEnabled,\n      params,\n      perspective,\n      setPerspective,\n      toggleNavigator,\n      toggleOverlay,\n      loadersConnection,\n      overlaysConnection,\n      previewKitConnection,\n      unstable_showUnsafeShareUrl,\n    } = props\n\n    const { devMode } = usePresentationTool()\n\n    const [mode, setMode] = useState<'desktop' | 'mobile'>('desktop')\n    const prefersReducedMotion = usePrefersReducedMotion()\n\n    const setDesktopMode = useCallback(() => setMode('desktop'), [setMode])\n    const setMobileMode = useCallback(() => setMode('mobile'), [setMode])\n    const [loading, setLoading] = useState(true)\n    const [timedOut, setTimedOut] = useState(false)\n    const [refreshing, setRefreshing] = useState(false)\n    const [somethingIsWrong, setSomethingIsWrong] = useState(false)\n    const iframeIsBusy =\n      loading || refreshing || overlaysConnection === 'connecting'\n\n    const previewLocationOrigin = useMemo(() => {\n      return targetOrigin === location.origin ? '' : targetOrigin\n    }, [targetOrigin])\n\n    const handleRefresh = useCallback(() => {\n      if (typeof ref === 'function' || !ref?.current) {\n        return\n      }\n\n      // Funky way to reload an iframe without CORS issues\n      // eslint-disable-next-line no-self-assign\n      // ref.current.src = ref.current.src\n      ref.current.src = `${targetOrigin}${params.preview || '/'}`\n\n      setRefreshing(true)\n    }, [params.preview, targetOrigin, ref])\n    const handleRetry = useCallback(() => {\n      if (typeof ref === 'function' || !ref?.current) {\n        return\n      }\n\n      ref.current.src = initialUrl.toString()\n\n      setRefreshing(true)\n    }, [ref, initialUrl])\n    const handleContinueAnyway = useCallback(() => {\n      setContinueAnyway(true)\n    }, [])\n\n    const [continueAnyway, setContinueAnyway] = useState(false)\n    const [showOverlaysConnectionStatus, setShowOverlaysConnectionState] =\n      useState(false)\n    useEffect(() => {\n      if (loading || refreshing) {\n        return\n      }\n\n      if (\n        overlaysConnection === 'connecting' ||\n        overlaysConnection === 'reconnecting'\n      ) {\n        const timeout = setTimeout(() => {\n          setShowOverlaysConnectionState(true)\n        }, 1000)\n        return () => clearTimeout(timeout)\n      }\n      return\n    }, [\n      overlaysConnection,\n      loading,\n      refreshing,\n      setShowOverlaysConnectionState,\n    ])\n\n    useEffect(() => {\n      if (loading || refreshing || !showOverlaysConnectionStatus) {\n        return\n      }\n      if (overlaysConnection === 'connected') {\n        setSomethingIsWrong(false)\n        setShowOverlaysConnectionState(false)\n        setTimedOut(false)\n        setContinueAnyway(false)\n      }\n      if (overlaysConnection === 'connecting') {\n        const timeout = setTimeout(() => {\n          setTimedOut(true)\n          // eslint-disable-next-line no-console\n          console.error(\n            `Unable to connect to overlays. Make sure you're calling the 'enableOverlays' function in '@sanity/overlays' correctly`,\n          )\n        }, MAX_TIME_TO_OVERLAYS_CONNECTION)\n        return () => clearTimeout(timeout)\n      }\n      if (overlaysConnection === 'reconnecting') {\n        const timeout = setTimeout(() => {\n          setTimedOut(true)\n          setSomethingIsWrong(true)\n        }, MAX_TIME_TO_OVERLAYS_CONNECTION)\n        return () => clearTimeout(timeout)\n      }\n      if (overlaysConnection === 'disconnected') {\n        setSomethingIsWrong(true)\n      }\n      return\n    }, [loading, overlaysConnection, refreshing, showOverlaysConnectionStatus])\n\n    const previewLocationRoute = useMemo(() => {\n      const previewUrl = new URL(params.preview || '/', targetOrigin)\n      const { pathname, search } = withoutSecretSearchParams(previewUrl)\n\n      return `${pathname}${search}`\n    }, [params.preview, targetOrigin])\n\n    const onIFrameLoad = useCallback(() => {\n      setLoading(false)\n      setRefreshing(false)\n    }, [])\n\n    return (\n      <MotionConfig\n        transition={prefersReducedMotion ? { duration: 0 } : undefined}\n      >\n        <TooltipDelayGroupProvider delay={1000}>\n          <Card\n            flex=\"none\"\n            padding={2}\n            shadow={1}\n            style={{ position: 'relative' }}\n          >\n            <Flex align=\"center\" gap={2} style={{ minHeight: 0 }}>\n              {toggleNavigator && (\n                <Tooltip\n                  animate\n                  content={<Text size={1}>Toggle navigator</Text>}\n                  fallbackPlacements={['bottom-start']}\n                  padding={2}\n                  placement=\"bottom\"\n                  portal\n                >\n                  <Button\n                    aria-label=\"Toggle navigator\"\n                    fontSize={1}\n                    icon={PanelLeftIcon}\n                    mode=\"bleed\"\n                    onClick={toggleNavigator}\n                    padding={3}\n                    selected={navigatorEnabled}\n                  />\n                </Tooltip>\n              )}\n\n              <Tooltip\n                animate\n                content={\n                  <Flex align=\"center\" style={{ whiteSpace: 'nowrap' }}>\n                    <Box padding={1}>\n                      <Text size={1}>\n                        {overlayEnabled\n                          ? 'Disable edit overlay'\n                          : 'Enable edit overlay'}\n                      </Text>\n                    </Box>\n                    <Box paddingY={1}>\n                      <Hotkeys\n                        keys={['Alt']}\n                        style={{ marginTop: -4, marginBottom: -4 }}\n                      />\n                    </Box>\n                  </Flex>\n                }\n                fallbackPlacements={['bottom-start']}\n                padding={1}\n                placement=\"bottom\"\n                portal\n              >\n                <Card\n                  as=\"label\"\n                  flex=\"none\"\n                  padding={3}\n                  style={{\n                    lineHeight: 0,\n                    borderRadius: 999,\n                    userSelect: 'none',\n                  }}\n                  tone={overlayEnabled ? 'positive' : undefined}\n                >\n                  <Flex align=\"center\" gap={2}>\n                    <div style={{ margin: -2 }}>\n                      <StyledSwitch\n                        checked={overlayEnabled}\n                        onChange={toggleOverlay}\n                        disabled={iframeIsBusy}\n                      />\n                    </div>\n                    <Box>\n                      <Text muted size={1} weight=\"medium\">\n                        Edit\n                      </Text>\n                    </Box>\n                  </Flex>\n                </Card>\n              </Tooltip>\n\n              {devMode && (\n                <Tooltip\n                  animate\n                  content={\n                    <Text size={1}>\n                      {refreshing ? 'Refreshing' : 'Refresh preview'}\n                    </Text>\n                  }\n                  fallbackPlacements={['bottom-start']}\n                  padding={2}\n                  placement=\"bottom\"\n                  portal\n                >\n                  <Button\n                    aria-label=\"Refresh preview\"\n                    fontSize={1}\n                    icon={RefreshIcon}\n                    mode=\"bleed\"\n                    loading={refreshing}\n                    onClick={handleRefresh}\n                    padding={3}\n                  />\n                </Tooltip>\n              )}\n\n              <Box flex={1}>\n                <PreviewLocationInput\n                  onChange={onPathChange}\n                  openPopup={openPopup}\n                  origin={previewLocationOrigin}\n                  value={previewLocationRoute}\n                  unstable_showUnsafeShareUrl={unstable_showUnsafeShareUrl}\n                />\n              </Box>\n\n              {unstable_showUnsafeShareUrl && (\n                <Flex align=\"center\" flex=\"none\" gap={1}>\n                  <MenuButton\n                    button={\n                      <Button\n                        fontSize={1}\n                        iconRight={ShareIcon}\n                        mode=\"bleed\"\n                        padding={3}\n                        space={2}\n                      />\n                    }\n                    id=\"location-menu\"\n                    menu={\n                      <Menu>\n                        <ShareUrlMenuItems\n                          initialUrl={initialUrl}\n                          openPopup={openPopup}\n                          previewLocationOrigin={previewLocationOrigin}\n                          previewLocationRoute={previewLocationRoute}\n                        />\n                      </Menu>\n                    }\n                    popover={{\n                      animate: true,\n                      constrainSize: true,\n                      placement: 'bottom',\n                      portal: true,\n                    }}\n                  />\n                </Flex>\n              )}\n\n              <Flex align=\"center\" flex=\"none\" gap={1}>\n                <MenuButton\n                  button={\n                    <Button\n                      fontSize={1}\n                      iconRight={ChevronDownIcon}\n                      mode=\"bleed\"\n                      padding={3}\n                      space={2}\n                      text={PERSPECTIVE_TITLES[perspective]}\n                      loading={\n                        iframeIsBusy ||\n                        (loadersConnection === 'connecting' &&\n                          previewKitConnection !== 'connected')\n                      }\n                      disabled={loadersConnection !== 'connected'}\n                    />\n                  }\n                  id=\"perspective-menu\"\n                  menu={\n                    <Menu style={{ maxWidth: 240 }}>\n                      <MenuItem\n                        fontSize={1}\n                        onClick={() => setPerspective('previewDrafts')}\n                        padding={3}\n                        pressed={perspective === 'previewDrafts'}\n                        tone={PERSPECTIVE_TONES['previewDrafts']}\n                      >\n                        <Flex align=\"flex-start\" gap={3}>\n                          <Box flex=\"none\">\n                            <Text size={1}>\n                              {createElement(\n                                PERSPECTIVE_ICONS['previewDrafts'],\n                              )}\n                            </Text>\n                          </Box>\n                          <Stack flex={1} space={2}>\n                            <Text size={1} weight=\"medium\">\n                              {PERSPECTIVE_TITLES['previewDrafts']}\n                            </Text>\n                            <Text muted size={1}>\n                              View this page with latest draft content\n                            </Text>\n                          </Stack>\n                          <Box flex=\"none\">\n                            <Text\n                              muted\n                              size={1}\n                              style={{\n                                opacity:\n                                  perspective === 'previewDrafts' ? 1 : 0,\n                              }}\n                            >\n                              <CheckmarkIcon />\n                            </Text>\n                          </Box>\n                        </Flex>\n                      </MenuItem>\n                      <MenuItem\n                        fontSize={1}\n                        onClick={() => setPerspective('published')}\n                        padding={3}\n                        pressed={perspective === 'published'}\n                        tone={PERSPECTIVE_TONES['published']}\n                      >\n                        <Flex align=\"flex-start\" gap={3}>\n                          <Box flex=\"none\">\n                            <Text size={1}>\n                              {createElement(PERSPECTIVE_ICONS['published'])}\n                            </Text>\n                          </Box>\n                          <Stack flex={1} space={2}>\n                            <Text size={1} weight=\"medium\">\n                              {PERSPECTIVE_TITLES['published']}\n                            </Text>\n                            <Text muted size={1}>\n                              View this page with published content\n                            </Text>\n                          </Stack>\n                          <Box flex=\"none\">\n                            <Text\n                              muted\n                              size={1}\n                              style={{\n                                opacity: perspective === 'published' ? 1 : 0,\n                              }}\n                            >\n                              <CheckmarkIcon />\n                            </Text>\n                          </Box>\n                        </Flex>\n                      </MenuItem>\n                    </Menu>\n                  }\n                  popover={{\n                    animate: true,\n                    constrainSize: true,\n                    placement: 'bottom',\n                    portal: true,\n                  }}\n                />\n              </Flex>\n\n              <Flex align=\"center\" flex=\"none\" gap={1}>\n                <Tooltip\n                  animate\n                  content={<Text size={1}>Full viewport</Text>}\n                  fallbackPlacements={['bottom-start']}\n                  padding={2}\n                  placement=\"bottom\"\n                  portal\n                >\n                  <Button\n                    aria-label=\"Full viewport\"\n                    fontSize={1}\n                    icon={DesktopIcon}\n                    mode=\"bleed\"\n                    onClick={setDesktopMode}\n                    padding={3}\n                    selected={mode === 'desktop'}\n                  />\n                </Tooltip>\n                <Tooltip\n                  animate\n                  content={<Text size={1}>Narrow viewport</Text>}\n                  padding={2}\n                  placement=\"bottom\"\n                  portal\n                >\n                  <Button\n                    aria-label=\"Narrow viewport\"\n                    fontSize={1}\n                    icon={MobileDeviceIcon}\n                    mode=\"bleed\"\n                    onClick={setMobileMode}\n                    padding={3}\n                    selected={mode === 'mobile'}\n                  />\n                </Tooltip>\n              </Flex>\n            </Flex>\n          </Card>\n\n          <Card flex={1} tone=\"transparent\">\n            <Flex\n              align=\"center\"\n              height=\"fill\"\n              justify=\"center\"\n              padding={mode === 'desktop' ? 0 : 2}\n              sizing=\"border\"\n              style={{\n                position: 'relative',\n                cursor: iframeIsBusy ? 'wait' : undefined,\n              }}\n            >\n              <AnimatePresence>\n                {!somethingIsWrong &&\n                !loading &&\n                !refreshing &&\n                showOverlaysConnectionStatus &&\n                !continueAnyway ? (\n                  <MotionFlex\n                    initial=\"initial\"\n                    animate=\"animate\"\n                    exit=\"exit\"\n                    variants={spinnerVariants}\n                    justify=\"center\"\n                    align=\"center\"\n                    style={{\n                      inset: `0`,\n                      position: `absolute`,\n                      backdropFilter: timedOut\n                        ? 'blur(16px) saturate(0.5) grayscale(0.5)'\n                        : 'blur(2px)',\n                      ['transition' as string]:\n                        'backdrop-filter 0.2s ease-in-out',\n                      // @TODO Because of Safari we have to do this\n                      WebkitBackdropFilter: timedOut\n                        ? 'blur(16px) saturate(0.5) grayscale(0.5)'\n                        : 'blur(2px)',\n                      WebkitTransition:\n                        '-webkit-backdrop-filter 0.2s ease-in-out',\n                      zIndex: 1,\n                    }}\n                  >\n                    <Flex\n                      style={{ ...sizes[mode] }}\n                      justify=\"center\"\n                      align=\"center\"\n                      direction=\"column\"\n                      gap={4}\n                    >\n                      {timedOut && (\n                        <Button\n                          disabled\n                          fontSize={1}\n                          mode=\"ghost\"\n                          text=\"Continue anyway\"\n                          style={{ opacity: 0 }}\n                        />\n                      )}\n                      <Card\n                        radius={2}\n                        tone={timedOut ? 'caution' : 'inherit'}\n                        padding={4}\n                        shadow={1}\n                      >\n                        <Flex\n                          justify=\"center\"\n                          align=\"center\"\n                          direction=\"column\"\n                          gap={4}\n                        >\n                          <Spinner muted />\n                          <Text muted size={1}>\n                            {timedOut ? (\n                              <>\n                                Unable to connect, check the browser console for\n                                more information.\n                              </>\n                            ) : (\n                              'Connecting'\n                            )}\n                          </Text>\n                        </Flex>\n                      </Card>\n                      {timedOut && (\n                        <Button\n                          fontSize={1}\n                          // mode=\"ghost\"\n                          tone=\"critical\"\n                          onClick={handleContinueAnyway}\n                          text=\"Continue anyway\"\n                        />\n                      )}\n                    </Flex>\n                  </MotionFlex>\n                ) : (loading || iframeIsBusy) && !continueAnyway ? (\n                  <MotionFlex\n                    initial=\"initial\"\n                    animate=\"animate\"\n                    exit=\"exit\"\n                    variants={spinnerVariants}\n                    justify=\"center\"\n                    align=\"center\"\n                    style={{\n                      inset: `0`,\n                      position: `absolute`,\n                      // boxShadow: '0 0 0 1px var(--card-shadow-outline-color)',\n                    }}\n                  >\n                    <Flex\n                      style={{ ...sizes[mode] }}\n                      justify=\"center\"\n                      align=\"center\"\n                      direction=\"column\"\n                      gap={4}\n                    >\n                      <Spinner muted />\n                      <Text muted size={1}>\n                        Loading\n                      </Text>\n                    </Flex>\n                  </MotionFlex>\n                ) : somethingIsWrong && !continueAnyway ? (\n                  <MotionFlex\n                    initial=\"initial\"\n                    animate=\"animate\"\n                    exit=\"exit\"\n                    variants={errorVariants}\n                    justify=\"center\"\n                    align=\"center\"\n                    style={{\n                      background: 'var(--card-bg-color)',\n                      inset: `0`,\n                      position: `absolute`,\n                      borderTop: '1px solid transparent',\n                      boxShadow: '0 0 0 1px var(--card-border-color)',\n                    }}\n                  >\n                    <ErrorCard\n                      flex={1}\n                      message=\"Could not connect to the preview\"\n                      onRetry={handleRetry}\n                      onContinueAnyway={handleContinueAnyway}\n                    >\n                      {devMode && (\n                        <>\n                          {overlaysConnection !== 'connected' && (\n                            <Card padding={3} radius={2} tone=\"critical\">\n                              <Stack space={3}>\n                                <Label muted size={0}>\n                                  Overlay connection status\n                                </Label>\n                                <Code size={1}>{overlaysConnection}</Code>\n                              </Stack>\n                            </Card>\n                          )}\n\n                          {loadersConnection !== 'connected' && (\n                            <Card padding={3} radius={2} tone=\"critical\">\n                              <Stack space={3}>\n                                <Label muted size={0}>\n                                  Loader connection status\n                                </Label>\n                                <Code size={1}>{loadersConnection}</Code>\n                              </Stack>\n                            </Card>\n                          )}\n                        </>\n                      )}\n                    </ErrorCard>\n                  </MotionFlex>\n                ) : null}\n              </AnimatePresence>\n              <IFrame\n                ref={ref}\n                style={{\n                  pointerEvents:\n                    iframeIsBusy && !continueAnyway ? 'none' : 'auto',\n                  boxShadow: '0 0 0 1px var(--card-border-color)',\n                  borderTop: '1px solid transparent',\n                }}\n                src={initialUrl.toString()}\n                initial={['background']}\n                variants={iframeVariants}\n                animate={[\n                  (loading || iframeIsBusy) && !continueAnyway\n                    ? 'background'\n                    : 'active',\n                  refreshing ? 'reloading' : 'idle',\n                  mode,\n                  showOverlaysConnectionStatus && !continueAnyway\n                    ? 'timedOut'\n                    : '',\n                ]}\n                onLoad={onIFrameLoad}\n              />\n            </Flex>\n          </Card>\n        </TooltipDelayGroupProvider>\n      </MotionConfig>\n    )\n  },\n)\n\nconst sizes = {\n  desktop: {\n    width: '100%',\n    height: '100%',\n  },\n  mobile: {\n    width: 375,\n    height: 650,\n  },\n}\n\nconst spinnerVariants = {\n  initial: { opacity: 1 },\n  animate: { opacity: [0, 0, 1] },\n  exit: { opacity: [1, 0, 0] },\n}\n\nconst errorVariants = {\n  initial: { opacity: 1 },\n  animate: { opacity: [0, 0, 1] },\n  exit: { opacity: [1, 0, 0] },\n}\n\nconst iframeVariants = {\n  desktop: {\n    ...sizes.desktop,\n    boxShadow: '0 0 0 0px var(--card-border-color)',\n  },\n  mobile: {\n    ...sizes.mobile,\n    boxShadow: '0 0 0 1px var(--card-border-color)',\n  },\n  background: {\n    opacity: 0,\n    scale: 1,\n  },\n  idle: {\n    scale: 1,\n  },\n  reloading: {\n    scale: [1, 1, 1, 0.98],\n  },\n  active: {\n    opacity: [0, 0, 1],\n    scale: 1,\n  },\n  timedOut: {\n    opacity: [0, 0, 1],\n  },\n}\n\nfunction ShareUrlMenuItems(\n  props: Pick<PreviewFrameProps, 'initialUrl' | 'openPopup'> & {\n    previewLocationOrigin: string\n    previewLocationRoute: string\n  },\n) {\n  const { initialUrl, openPopup, previewLocationOrigin, previewLocationRoute } =\n    props\n\n  const handleOpenPopup = useCallback(\n    (event: React.MouseEvent<HTMLAnchorElement, MouseEvent>) => {\n      event.preventDefault()\n      openPopup(event.currentTarget.href)\n    },\n    [openPopup],\n  )\n\n  return (\n    <>\n      <CopyUrlMenuButton\n        initialUrl={initialUrl}\n        previewLocationOrigin={previewLocationOrigin}\n        previewLocationRoute={previewLocationRoute}\n      />\n      <MenuItem\n        icon={LaunchIcon}\n        text=\"Open preview\"\n        as=\"a\"\n        href={`${previewLocationOrigin}${previewLocationRoute}`}\n        onClick={handleOpenPopup as any}\n        rel=\"opener\"\n        target=\"_blank\"\n      />\n    </>\n  )\n}\n\nfunction CopyUrlMenuButton(\n  props: Pick<PreviewFrameProps, 'initialUrl'> & {\n    previewLocationOrigin: string\n    previewLocationRoute: string\n  },\n) {\n  const { initialUrl, previewLocationOrigin, previewLocationRoute } = props\n\n  const { push: pushToast } = useToast()\n  const client = useClient({ apiVersion: API_VERSION })\n  const currentUser = useCurrentUser()\n  const [disabled, setDisabled] = useState(false)\n\n  return (\n    <MenuItem\n      disabled={disabled}\n      onClick={() => {\n        if (!navigator?.clipboard) {\n          pushToast({\n            closable: true,\n            status: 'error',\n            title: 'Clipboard not supported',\n          })\n          return false\n        }\n        setDisabled(true)\n\n        let id: string | undefined = undefined\n        let url = `${previewLocationOrigin}${previewLocationRoute}`\n        const onFinally = () => {\n          pushToast({\n            id,\n            closable: true,\n            status: 'success',\n            title: 'The URL is copied to the clipboard',\n          })\n          setDisabled(false)\n        }\n        const onError = (error: any) => {\n          pushToast({\n            closable: true,\n            status: 'error',\n            title: 'Copy failed',\n            description: error.message || error.toString(),\n          })\n          setDisabled(false)\n        }\n        if (\n          hasSecretSearchParams(initialUrl) &&\n          typeof ClipboardItem !== 'undefined'\n        ) {\n          const type = 'text/plain'\n          const resolvePreviewUrl = async () => {\n            id = pushToast({\n              closable: true,\n              title: 'Copying URL to clipboard',\n            })\n            const previewUrlSecret = await createPreviewSecret(\n              client,\n              '@sanity/presentation',\n              typeof window === 'undefined' ? '' : location.href,\n              currentUser?.id,\n            )\n\n            const newUrl = setSecretSearchParams(\n              initialUrl,\n              previewUrlSecret.secret,\n              previewLocationRoute,\n            )\n            url = newUrl.toString()\n            return new Blob([url], { type })\n          }\n\n          // Try to save to clipboard then save it in the state if worked\n          const item = new ClipboardItem({\n            [type]: resolvePreviewUrl(),\n          })\n          navigator.clipboard.write([item]).then(onFinally).catch(onError)\n        } else {\n          navigator.clipboard.writeText(url).then(onFinally).catch(onError)\n        }\n      }}\n      text=\"Copy link\"\n      icon={CopyIcon}\n    />\n  )\n}\n","import { studioPath } from '@sanity/client/csm'\nimport { urlStringToPath } from '@sanity/visual-editing-helpers'\n\nimport { PresentationStateParams } from '../types'\n\nexport function parseId(rawId: string | undefined): string | undefined {\n  if (rawId === undefined) {\n    return undefined\n  }\n\n  const segments = decodeURIComponent(rawId)?.split('.')\n\n  if (segments[0] === 'drafts') {\n    segments.shift()\n  }\n\n  return segments.join('.')\n}\n\nexport function parsePath(rawPath: string | undefined): string | undefined {\n  if (rawPath === undefined) {\n    return undefined\n  }\n\n  return studioPath.toString(urlStringToPath(decodeURIComponent(rawPath)))\n}\n\nexport function parseRouterState(\n  state: PresentationStateParams,\n): PresentationStateParams {\n  return {\n    id: parseId(state.id),\n    path: parsePath(state.path),\n    type: state.type,\n  }\n}\n","import { studioPath } from '@sanity/client/csm'\nimport { pathToUrlString } from '@sanity/visual-editing-helpers'\nimport isEqual from 'lodash.isequal'\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react'\nimport { NavigateOptions, RouterContextValue, RouterState } from 'sanity/router'\n\nimport { debounce } from './lib/debounce'\nimport { parseRouterState } from './lib/parse'\nimport {\n  DeskDocumentPaneParams,\n  PresentationParams,\n  PresentationStateParams,\n  SetPresentationParams,\n} from './types'\n\nfunction pruneObject<T extends RouterState | PresentationParams>(obj: T): T {\n  return Object.fromEntries(\n    Object.entries(obj).filter(\n      ([, value]) => value !== undefined && value !== '' && value !== null,\n    ),\n  ) as T\n}\n\nexport function useParams({\n  initialPreviewUrl,\n  routerNavigate,\n  routerState,\n  routerSearchParams,\n}: {\n  initialPreviewUrl: URL\n  routerNavigate: RouterContextValue['navigate']\n  routerState: PresentationStateParams\n  routerSearchParams: {\n    [k: string]: string\n  }\n}): {\n  deskParams: DeskDocumentPaneParams\n  navigate: (nextState: RouterState, options?: NavigateOptions) => void\n  params: PresentationParams\n  setParams: SetPresentationParams\n} {\n  const [params, setParamsState] = useState<PresentationParams>(() => {\n    const { id, path, type } = parseRouterState(routerState)\n\n    return {\n      id,\n      type,\n      path,\n      preview:\n        routerSearchParams.preview ||\n        `${initialPreviewUrl.pathname}${initialPreviewUrl.search}`,\n      perspective: routerSearchParams.perspective,\n      inspect: routerSearchParams.inspect,\n      rev: routerSearchParams.rev,\n      since: routerSearchParams.since,\n      template: routerSearchParams.template,\n      view: routerSearchParams.view,\n      // assist\n      pathKey: routerSearchParams.pathKey,\n      instruction: routerSearchParams.instruction,\n      // comments\n      comment: routerSearchParams.comment,\n    }\n  })\n\n  const setParams = useCallback((newParams: Partial<PresentationParams>) => {\n    setParamsState((state) => {\n      const nextState = { ...state, ...newParams }\n      if (isEqual(pruneObject(state), pruneObject(nextState))) {\n        return state\n      }\n      return nextState\n    })\n  }, [])\n\n  const deskParams = useMemo<DeskDocumentPaneParams>(\n    () =>\n      pruneObject({\n        inspect: params.inspect,\n        path: params.path,\n        rev: params.rev,\n        since: params.since,\n        template: params.template,\n        view: params.view,\n        // assist\n        pathKey: params.pathKey,\n        instruction: params.instruction,\n        // comments\n        comment: params.comment,\n      }),\n    [\n      params.inspect,\n      params.path,\n      params.rev,\n      params.since,\n      params.template,\n      params.view,\n      params.pathKey,\n      params.instruction,\n      params.comment,\n    ],\n  )\n\n  useEffect(() => {\n    const { id, path, type } = parseRouterState(routerState)\n\n    const timeout = setTimeout(\n      () =>\n        setParams({\n          id,\n          type: type === '*' ? undefined : type,\n          path,\n          preview:\n            routerSearchParams.preview ||\n            `${initialPreviewUrl.pathname}${initialPreviewUrl.search}`,\n          perspective: routerSearchParams.perspective,\n          inspect: routerSearchParams.inspect,\n          rev: routerSearchParams.rev,\n          since: routerSearchParams.since,\n          template: routerSearchParams.template,\n          view: routerSearchParams.view,\n          // assist\n          pathKey: routerSearchParams.pathKey,\n          instruction: routerSearchParams.instruction,\n          // comments\n          comment: routerSearchParams.comment,\n        }),\n      0,\n    )\n    return () => clearTimeout(timeout)\n  }, [initialPreviewUrl, routerSearchParams, routerState, setParams])\n\n  const navigate = useMemo(() => {\n    // Debounce navigation to mitigate various event related race conditions\n    return debounce((nextState: RouterState, options?: NavigateOptions) => {\n      const state = pruneObject(nextState)\n      routerNavigate(state, options)\n    }, 50)\n  }, [routerNavigate])\n\n  const previewRef = useRef(params.preview)\n\n  useEffect(() => {\n    const previousPreview = previewRef.current\n    previewRef.current = params.preview\n\n    const type = params.type\n    const id = params.id\n    const path = params.path\n      ? pathToUrlString(studioPath.fromString(params.path))\n      : undefined\n\n    const searchParams = pruneObject({\n      preview: params.preview,\n      perspective: params.perspective === 'published' ? 'published' : undefined,\n      inspect: params.inspect,\n      rev: params.rev,\n      since: params.since,\n      template: params.template,\n      view: params.view,\n      // assist\n      pathKey: params.pathKey,\n      instruction: params.instruction,\n      // comments\n      comment: params.comment,\n    }) satisfies PresentationParams\n\n    const replace = params.preview === previousPreview\n    const timeout = setTimeout(\n      () =>\n        navigate(\n          {\n            type,\n            id,\n            path,\n            _searchParams: Object.entries(\n              searchParams as Record<string, string>,\n            ),\n          },\n          { replace },\n        ),\n      0,\n    )\n    return () => clearTimeout(timeout)\n  }, [navigate, params])\n\n  return {\n    navigate,\n    setParams,\n    deskParams,\n    params,\n  }\n}\n","import { createPreviewSecret } from '@sanity/preview-url-secret/create-secret'\nimport { definePreviewUrl } from '@sanity/preview-url-secret/define-preview-url'\nimport { startTransition, useEffect, useMemo, useState } from 'react'\nimport {\n  type SanityClient,\n  useActiveWorkspace,\n  useClient,\n  useCurrentUser,\n} from 'sanity'\nimport { suspend } from 'suspend-react'\n\nimport { API_VERSION } from './constants'\nimport { PreviewUrlOption } from './types'\n\nexport function usePreviewUrl(\n  previewUrl: PreviewUrlOption,\n  toolName: string,\n  previewSearchParam: string | null,\n): URL {\n  const client = useClient({ apiVersion: API_VERSION })\n  const workspace = useActiveWorkspace()\n  const basePath = workspace?.activeWorkspace?.basePath || '/'\n  const workspaceName = workspace?.activeWorkspace?.name || 'default'\n  const deps = useSuspendCacheKeys(toolName, basePath, workspaceName)\n  const previewUrlSecret = usePreviewUrlSecret(\n    typeof previewUrl === 'object' || typeof previewUrl === 'function',\n    deps,\n  )\n  return suspend(async () => {\n    if (typeof previewUrl === 'string') {\n      const resolvedUrl = new URL(previewUrl, location.origin)\n      let resultUrl = resolvedUrl\n      try {\n        if (previewSearchParam) {\n          const restoredUrl = new URL(previewSearchParam, resolvedUrl)\n          if (restoredUrl.origin === resolvedUrl.origin) {\n            resultUrl = restoredUrl\n          }\n        } else if (document.referrer) {\n          const referrerUrl = new URL(document.referrer)\n          if (referrerUrl.origin === resolvedUrl.origin) {\n            resultUrl = referrerUrl\n          }\n        }\n      } catch {\n        // ignore\n      }\n      // Prevent infinite recursion\n      if (\n        location.origin === resultUrl.origin &&\n        (resultUrl.pathname.startsWith(`${basePath}/`) ||\n          resultUrl.pathname === basePath)\n      ) {\n        return resolvedUrl\n      }\n      return resultUrl\n    }\n    const resolvePreviewUrl =\n      typeof previewUrl === 'object'\n        ? definePreviewUrl<SanityClient>(previewUrl)\n        : previewUrl\n    const resolvedUrl = await resolvePreviewUrl({\n      client,\n      previewUrlSecret: previewUrlSecret!,\n      previewSearchParam,\n      referrer: typeof document === 'undefined' ? null : document.referrer,\n      studioBasePath: basePath,\n    })\n    return new URL(resolvedUrl, location.origin)\n  }, [...deps, previewUrlSecret]) satisfies URL\n}\n\n// https://github.com/pmndrs/suspend-react?tab=readme-ov-file#making-cache-keys-unique\nconst resolveUUID = Symbol()\n\nfunction useSuspendCacheKeys(\n  toolName: string,\n  basePath: string,\n  workspaceName: string,\n) {\n  const currentUser = useCurrentUser()\n  return useMemo(\n    () => [\n      // Cache based on a few specific conditions\n      '@sanity/presentation',\n      basePath,\n      workspaceName,\n      toolName,\n      currentUser?.id,\n      resolveUUID,\n    ],\n    [basePath, currentUser?.id, toolName, workspaceName],\n  )\n}\n\nfunction usePreviewUrlSecret(\n  enabled: boolean,\n  deps: (string | symbol | undefined)[],\n) {\n  const client = useClient({ apiVersion: API_VERSION })\n  const currentUser = useCurrentUser()\n  const [secretLastExpiredAt, setSecretLastExpiredAt] = useState<string>('')\n\n  const previewUrlSecret = enabled\n    ? suspend(async () => {\n        return await createPreviewSecret(\n          client,\n          '@sanity/presentation',\n          typeof window === 'undefined' ? '' : location.href,\n          currentUser?.id,\n        )\n      }, [...deps, secretLastExpiredAt])\n    : null\n\n  useEffect(() => {\n    if (!previewUrlSecret) return\n    const timeout = setTimeout(() => {\n      startTransition(() =>\n        setSecretLastExpiredAt(previewUrlSecret.expiresAt.toString()),\n      )\n    }, previewUrlSecret.expiresAt.getTime() - Date.now())\n    return () => clearTimeout(timeout)\n  }, [previewUrlSecret])\n\n  return previewUrlSecret?.secret || null\n}\n","import {\n  type ChannelsController,\n  type ChannelStatus,\n  createChannelsController,\n} from '@sanity/channels'\nimport type { ClientPerspective } from '@sanity/client'\nimport { studioPath } from '@sanity/client/csm'\nimport { BoundaryElementProvider, Flex } from '@sanity/ui'\nimport {\n  getQueryCacheKey,\n  isAltKey,\n  isHotkey,\n  type VisualEditingConnectionIds,\n  type VisualEditingMsg,\n} from '@sanity/visual-editing-helpers'\nimport {\n  type ReactElement,\n  startTransition,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport { useUnique } from 'sanity'\nimport {\n  getPublishedId,\n  type Path,\n  type SanityDocument,\n  type Tool,\n  useDataset,\n  useProjectId,\n} from 'sanity'\nimport { RouterContextValue, useRouter } from 'sanity/router'\nimport styled from 'styled-components'\n\nimport {\n  DEFAULT_TOOL_NAME,\n  MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL,\n} from './constants'\nimport { ContentEditor } from './editor/ContentEditor'\nimport LoaderQueries from './loader/LoaderQueries'\nimport { Panel } from './panels/Panel'\nimport { PanelResizer } from './panels/PanelResizer'\nimport { Panels } from './panels/Panels'\nimport { HoldEditState } from './perf/HoldEditState'\nimport { PresentationNavigateProvider } from './PresentationNavigateProvider'\nimport { usePresentationNavigator } from './PresentationNavigator'\nimport { PresentationParamsProvider } from './PresentationParamsProvider'\nimport { PresentationProvider } from './PresentationProvider'\nimport { PreviewFrame } from './preview/PreviewFrame'\nimport type {\n  DeskDocumentPaneParams,\n  LiveQueriesState,\n  LiveQueriesStateValue,\n  PresentationPluginOptions,\n  PresentationStateParams,\n} from './types'\nimport { DocumentOnPage, useDocumentsOnPage } from './useDocumentsOnPage'\nimport { useParams } from './useParams'\nimport { usePreviewUrl } from './usePreviewUrl'\n\nconst Container = styled(Flex)`\n  overflow-x: auto;\n`\n\nexport default function PresentationTool(props: {\n  tool: Tool<PresentationPluginOptions>\n}): ReactElement {\n  const {\n    previewUrl: _previewUrl,\n    components,\n    unstable_showUnsafeShareUrl = false,\n  } = props.tool.options ?? {}\n  const name = props.tool.name || DEFAULT_TOOL_NAME\n  const { unstable_navigator } = components || {}\n\n  const { navigate: routerNavigate, state: routerState } =\n    useRouter() as RouterContextValue & { state: PresentationStateParams }\n  const routerSearchParams = useUnique(\n    Object.fromEntries(routerState._searchParams || []),\n  )\n\n  const initialPreviewUrl = usePreviewUrl(\n    _previewUrl || '/',\n    name,\n    routerSearchParams.preview || null,\n  )\n\n  const [devMode] = useState(() => {\n    const option = props.tool.options?.devMode\n\n    if (typeof option === 'function') return option()\n    if (typeof option === 'boolean') return option\n\n    return (\n      typeof window !== 'undefined' && window.location.hostname === 'localhost'\n    )\n  })\n\n  const targetOrigin = useMemo(() => {\n    return initialPreviewUrl.origin\n  }, [initialPreviewUrl.origin])\n\n  const iframeRef = useRef<HTMLIFrameElement>(null)\n\n  const [channel, setChannel] = useState<ChannelsController<VisualEditingMsg>>()\n\n  const [liveQueries, setLiveQueries] = useState<LiveQueriesState>({})\n\n  const { setParams, params, deskParams } = useParams({\n    initialPreviewUrl,\n    routerNavigate,\n    routerState,\n    routerSearchParams,\n  })\n\n  const [perspective, setPerspective] = useState<ClientPerspective>(() =>\n    params.perspective === 'published' ? params.perspective : 'previewDrafts',\n  )\n\n  const [documentsOnPage, setDocumentsOnPage] = useDocumentsOnPage(perspective)\n\n  const [overlayEnabled, setOverlayEnabled] = useState(true)\n\n  const projectId = useProjectId()\n  const dataset = useDataset()\n\n  const previewRef = useRef<typeof params.preview>()\n\n  const idRef = useRef(params.id)\n\n  const [preloadRefs, setPreloadRefs] = useState<DocumentOnPage[]>(() =>\n    documentsOnPage\n      .slice(0, 3)\n      .map((d) => ({ ...d, _id: getPublishedId(d._id) })),\n  )\n\n  // Update the perspective when the param changes\n  useEffect(() => {\n    if (perspective !== params.perspective) {\n      setParams({ perspective })\n    }\n  }, [params.perspective, perspective, setParams])\n\n  useEffect(() => {\n    setPreloadRefs(\n      documentsOnPage\n        .slice(0, 3)\n        .map((d) => ({ ...d, _id: getPublishedId(d._id) })),\n    )\n  }, [documentsOnPage])\n\n  useEffect(() => {\n    if (params.id !== idRef.current) {\n      idRef.current = params.id\n\n      if (params.id) {\n        setPreloadRefs((p) => {\n          const exists = p.find((d) => d._id === params.id)\n\n          if (exists) return p\n\n          return p.slice(1).concat([{ _id: params.id!, _type: params.type! }])\n        })\n      }\n    }\n  }, [params])\n\n  const [overlaysConnection, setOverlaysConnection] =\n    useState<ChannelStatus>('connecting')\n  const [loadersConnection, setLoadersConnection] =\n    useState<ChannelStatus>('connecting')\n  const [previewKitConnection, setPreviewKitConnection] =\n    useState<ChannelStatus>('connecting')\n\n  const [popups] = useState<Set<Window>>(() => new Set())\n  const handleOpenPopup = useCallback(\n    (url: string) => {\n      const source = window.open(url, '_blank')\n      if (source) {\n        popups.add(source)\n      }\n    },\n    [popups],\n  )\n\n  useEffect(() => {\n    if (popups.size && channel) {\n      // loop popups and call channel.addSource\n      for (const source of popups) {\n        if (source && 'closed' in source && !source.closed) {\n          channel.addSource(source)\n        }\n      }\n    }\n  }, [channel, popups, popups.size])\n\n  useEffect(() => {\n    const target = iframeRef.current?.contentWindow\n\n    if (!target) return\n\n    const nextChannel = createChannelsController<VisualEditingMsg>({\n      id: 'presentation' satisfies VisualEditingConnectionIds,\n      target,\n      targetOrigin,\n      connectTo: [\n        {\n          id: 'overlays' satisfies VisualEditingConnectionIds,\n          heartbeat: true,\n          onStatusUpdate: setOverlaysConnection,\n          onEvent(type, data) {\n            if (type === 'overlay/focus' && 'id' in data) {\n              setParams({\n                id: data.id,\n                path: data.path,\n                type: data.type,\n              })\n            } else if (type === 'overlay/navigate') {\n              if (previewRef.current !== data.url) {\n                const isInitialNavigation = previewRef.current === undefined\n\n                previewRef.current = data.url\n                setParams(\n                  isInitialNavigation\n                    ? { preview: data.url }\n                    : { id: undefined, type: undefined, preview: data.url },\n                )\n              }\n            } else if (type === 'overlay/toggle') {\n              setOverlayEnabled(data.enabled)\n            }\n          },\n        },\n        {\n          id: 'loaders' satisfies VisualEditingConnectionIds,\n          heartbeat: true,\n          onStatusUpdate: setLoadersConnection,\n          onEvent(type, data) {\n            if (type === 'loader/documents') {\n              setDocumentsOnPage(data.perspective, data.documents)\n            } else if (\n              type === 'loader/query-listen' &&\n              data.projectId === projectId &&\n              data.dataset === dataset\n            ) {\n              if (\n                typeof data.heartbeat === 'number' &&\n                data.heartbeat! < MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL\n              ) {\n                throw new Error(\n                  `Loader query listen heartbeat interval must be at least ${MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL}ms`,\n                )\n              }\n              setLiveQueries((prev) => ({\n                ...prev,\n                [getQueryCacheKey(data.query, data.params)]: {\n                  perspective: data.perspective,\n                  query: data.query,\n                  params: data.params,\n                  receivedAt: Date.now(),\n                  heartbeat: data.heartbeat ?? false,\n                } satisfies LiveQueriesStateValue,\n              }))\n            }\n          },\n        },\n        {\n          id: 'preview-kit' satisfies VisualEditingConnectionIds,\n          heartbeat: true,\n          onStatusUpdate: setPreviewKitConnection,\n          onEvent(type, data) {\n            if (\n              type === 'preview-kit/documents' &&\n              data.projectId === projectId &&\n              data.dataset === dataset\n            ) {\n              setDocumentsOnPage(data.perspective, data.documents)\n            }\n          },\n        },\n      ],\n    })\n    setChannel(nextChannel)\n\n    return () => {\n      nextChannel.destroy()\n      setChannel(undefined)\n    }\n  }, [dataset, projectId, setDocumentsOnPage, setParams, targetOrigin])\n\n  useEffect(() => {\n    const interval = setInterval(\n      () =>\n        startTransition(() =>\n          setLiveQueries((liveQueries) => {\n            if (Object.keys(liveQueries).length < 1) {\n              return liveQueries\n            }\n\n            const now = Date.now()\n            const hasAnyExpired = Object.values(liveQueries).some(\n              (liveQuery) =>\n                liveQuery.heartbeat !== false &&\n                now > liveQuery.receivedAt + liveQuery.heartbeat,\n            )\n            if (!hasAnyExpired) {\n              return liveQueries\n            }\n            const next = {} as LiveQueriesState\n            for (const [key, value] of Object.entries(liveQueries)) {\n              if (\n                value.heartbeat !== false &&\n                now > value.receivedAt + value.heartbeat\n              ) {\n                continue\n              }\n              next[key] = value\n            }\n            return next\n          }),\n        ),\n      MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL,\n    )\n    return () => clearInterval(interval)\n  }, [])\n\n  const handleFocusPath = useCallback(\n    // eslint-disable-next-line no-warning-comments\n    // @todo nextDocumentId may not be needed with this strategy\n    (nextDocumentId: string, nextPath: Path) => {\n      setParams({\n        // Dont need to explicitly set the id here because it was either already set via postMessage or is the same if navigating in the document pane\n        path: studioPath.toString(nextPath),\n      })\n    },\n    [setParams],\n  )\n\n  const handlePreviewPath = useCallback(\n    (nextPath: string) => {\n      const url = new URL(nextPath, initialPreviewUrl.origin)\n      const preview = url.pathname + url.search\n      if (\n        url.origin === initialPreviewUrl.origin &&\n        preview !== params.preview\n      ) {\n        setParams({ id: undefined, path: undefined, preview })\n      }\n    },\n    [initialPreviewUrl, params, setParams],\n  )\n\n  const handleDeskParams = useCallback(\n    (deskParams: DeskDocumentPaneParams) => {\n      setParams({ ...deskParams })\n    },\n    [setParams],\n  )\n\n  useEffect(() => {\n    if (params.id && params.path) {\n      channel?.send('overlays', 'presentation/focus', {\n        id: params.id,\n        path: params.path,\n      })\n    } else {\n      channel?.send('overlays', 'presentation/blur', undefined)\n    }\n  }, [channel, params.id, params.path])\n\n  // Dispatch a navigation message whenever the preview param changes\n  // @todo This will cause a reflection of received navigation messages which could be problematic\n  useEffect(() => {\n    if (\n      previewRef.current &&\n      params.preview &&\n      previewRef.current !== params.preview\n    ) {\n      previewRef.current = params.preview\n      if (overlaysConnection !== 'connected' && iframeRef.current) {\n        iframeRef.current.src = `${targetOrigin}${params.preview}`\n      } else {\n        channel?.send('overlays', 'presentation/navigate', {\n          url: params.preview,\n          type: 'push',\n        })\n      }\n    }\n  }, [channel, overlaysConnection, targetOrigin, params.preview])\n\n  const toggleOverlay = useCallback(\n    () => channel?.send('overlays', 'presentation/toggleOverlay', undefined),\n    [channel],\n  )\n\n  // The current document being edited, it's put on the fast track for super low latency updates\n  const [liveDocument, setLiveDocument] = useState<SanityDocument | null>(null)\n  const onDocumentChange = useCallback(\n    (document: SanityDocument | null) => setLiveDocument(document),\n    [],\n  )\n\n  useEffect(() => {\n    const handleKeyUp = (e: KeyboardEvent) => {\n      if (isAltKey(e)) {\n        toggleOverlay()\n      }\n    }\n    const handleKeydown = (e: KeyboardEvent) => {\n      if (isAltKey(e)) {\n        toggleOverlay()\n      }\n\n      if (isHotkey(['mod', '\\\\'], e)) {\n        toggleOverlay()\n      }\n    }\n    window.addEventListener('keydown', handleKeydown)\n    window.addEventListener('keyup', handleKeyUp)\n    return () => {\n      window.removeEventListener('keydown', handleKeydown)\n      window.removeEventListener('keyup', handleKeyUp)\n    }\n  }, [toggleOverlay])\n\n  const [boundaryElement, setBoundaryElement] = useState<HTMLDivElement | null>(\n    null,\n  )\n\n  const [{ navigatorEnabled, toggleNavigator }, PresentationNavigator] =\n    usePresentationNavigator({ unstable_navigator })\n\n  return (\n    <>\n      <PresentationProvider\n        deskParams={deskParams}\n        devMode={devMode}\n        name={name}\n        params={params}\n        setParams={setParams}\n      >\n        {/* perf improvement: preload edit state */}\n        {preloadRefs.map((d) => (\n          <HoldEditState id={d._id} key={d._id} type={d._type} />\n        ))}\n\n        <PresentationNavigateProvider setParams={setParams}>\n          <PresentationParamsProvider params={params}>\n            <Container height=\"fill\">\n              <Panels>\n                <PresentationNavigator />\n                <Panel\n                  id=\"preview\"\n                  minWidth={325}\n                  defaultSize={navigatorEnabled ? 50 : 75}\n                  order={3}\n                >\n                  <Flex\n                    direction=\"column\"\n                    flex={1}\n                    height=\"fill\"\n                    ref={setBoundaryElement}\n                  >\n                    <BoundaryElementProvider element={boundaryElement}>\n                      <PreviewFrame\n                        initialUrl={initialPreviewUrl}\n                        navigatorEnabled={navigatorEnabled}\n                        onPathChange={handlePreviewPath}\n                        openPopup={handleOpenPopup}\n                        overlayEnabled={overlayEnabled}\n                        params={params}\n                        perspective={perspective}\n                        ref={iframeRef}\n                        setPerspective={setPerspective}\n                        targetOrigin={targetOrigin}\n                        toggleNavigator={toggleNavigator}\n                        toggleOverlay={toggleOverlay}\n                        loadersConnection={loadersConnection}\n                        overlaysConnection={overlaysConnection}\n                        previewKitConnection={previewKitConnection}\n                        unstable_showUnsafeShareUrl={\n                          unstable_showUnsafeShareUrl\n                        }\n                      />\n                    </BoundaryElementProvider>\n                  </Flex>\n                </Panel>\n                <PanelResizer order={4} />\n                <Panel id=\"content\" minWidth={325} order={5}>\n                  <ContentEditor\n                    refs={documentsOnPage}\n                    deskParams={deskParams}\n                    documentId={params.id}\n                    documentType={params.type}\n                    onDeskParams={handleDeskParams}\n                    onFocusPath={handleFocusPath}\n                    onDocumentChange={onDocumentChange}\n                    previewUrl={params.preview}\n                  />\n                </Panel>\n              </Panels>\n            </Container>\n          </PresentationParamsProvider>\n        </PresentationNavigateProvider>\n      </PresentationProvider>\n      {channel && (\n        <>\n          <LoaderQueries\n            key=\"published\"\n            activePerspective={perspective === 'published'}\n            channel={channel}\n            liveQueries={liveQueries}\n            perspective=\"published\"\n            // Only send the liveDocument if it's a published document\n            liveDocument={\n              liveDocument?._id?.startsWith('drafts.') ? null : liveDocument\n            }\n          />\n          <LoaderQueries\n            key=\"previewDrafts\"\n            activePerspective={perspective === 'previewDrafts'}\n            channel={channel}\n            liveQueries={liveQueries}\n            perspective=\"previewDrafts\"\n            liveDocument={liveDocument}\n          />\n        </>\n      )}\n    </>\n  )\n}\n","import { ClientPerspective } from '@sanity/client'\nimport { useCallback, useMemo, useState } from 'react'\n\nexport type DocumentOnPage = {\n  _id: string\n  _type: string\n  _projectId?: string\n  dataset?: string\n}\n\nexport function useDocumentsOnPage(\n  perspective: ClientPerspective,\n): [\n  DocumentOnPage[],\n  (perspective: ClientPerspective, state: DocumentOnPage[]) => void,\n] {\n  const [state, setState] = useState<\n    Record<ClientPerspective, Map<string, DocumentOnPage>>\n  >(() => ({ published: new Map(), previewDrafts: new Map(), raw: new Map() }))\n\n  const setDocumentsOnPage = useCallback(\n    (perspective: ClientPerspective, documents: DocumentOnPage[]) => {\n      setState((state) => {\n        let changed = false\n        let map = state[perspective]\n        const getKey = (document: DocumentOnPage) => {\n          return `${document._projectId}-${document.dataset}-${document._type}-${document._id}`\n        }\n        const knownKeys = new Set<ReturnType<typeof getKey>>()\n        // Add anything new, and track all keys\n        for (const document of documents) {\n          const key = getKey(document)\n          knownKeys.add(key)\n          if (!map.has(key)) {\n            map.set(key, document)\n            changed = true\n          }\n        }\n        // Remove anything that is no longer on the page\n        for (const key of map.keys()) {\n          if (!knownKeys.has(key)) {\n            map.delete(key)\n            changed = true\n          }\n        }\n\n        if (changed) {\n          map = new Map(map)\n          return { ...state, [perspective]: new Map(map) }\n        }\n\n        return state\n      })\n    },\n    [],\n  )\n\n  const documentsOnPageMap = useMemo(() => {\n    return state[perspective]\n  }, [perspective, state])\n\n  const documentsOnPage = useMemo(() => {\n    return [...documentsOnPageMap.values()]\n  }, [documentsOnPageMap])\n\n  return [documentsOnPage, setDocumentsOnPage]\n}\n"],"names":["jsxRuntime","require","csm","ui","react","sanity","router","styled","index","desk","groqStore","mendoza","icons","createSecret","withoutSecretSearchParams","framerMotion","isEqual","definePreviewUrl","suspendReact","_interopDefaultCompat","e","default","styled__default","isEqual__default","getRandomValues","rnds8","Uint8Array","rng","crypto","bind","Error","byteToHex","i","push","toString","slice","native","randomUUID","v4","options","buf","offset","rnds","random","arr","unsafeStringify","RESPONSE_TIMEOUT","HEARTBEAT_INTERVAL","HANDSHAKE_INTERVAL","HANDSHAKE_MSG_TYPES","isHandshakeMessage","type","some","t","isLegacyHandshakeMessage","data","Array","isArray","every","key","startsWith","createChannelsControllerInternal","config","target","channels","connectTo","map","buffer","id","handler","handshakeHandler","status","interval","heartbeat","stopHandshake","channel","window","clearInterval","find","from","setChannelStatus","sendHandshake","messageHandler","connectionId","args","onEvent","send","responseTo","handleEvents","console","error","origin","domain","to","includes","targetOrigin","isValidMessageEvent","stopHeartbeat","next","onStatusUpdate","uuid","setInterval","startHandshake","heartbeatInverval","startHeartbeat","toFlush","splice","length","forEach","flush","msg","postMessage","expectResponse","maxWait","setTimeout","removeEventListener","transact","warn","eventData","clearTimeout","addEventListener","destroy","n","r","o","u","alt","ctrl","mod","test","navigator","platform","shift","toUpperCase","ErrorCard","props","children","message","onRetry","onContinueAnyway","restProps","retryButton","jsx","Button","fontSize","mode","onClick","text","continueAnywayButton","tone","Card","height","Flex","align","justify","Container","padding","sizing","width","jsxs","Stack","space","Text","size","weight","muted","Inline","Box","usePresentationTool","presentation","useContext","PresentationContext","resolveQueryStringFromParams","nextParams","allowed","params","parts","Object","entries","value","join","encodeQueryString","filter","reduce","obj","BackLink","forwardRef","ref","deskParams","StateLink","state","_searchParams","preview","title","ReferenceChildLink","documentId","documentType","PresentationPaneRouterProvider","onDeskParams","previewUrl","refs","routerState","resolvePathFromState","useRouter","routerSearchParams","useUnique","fromEntries","createPathWithParams","useCallback","context","useMemo","groupIndex","siblingIndex","payload","hasGroupSiblings","groupLength","routerPanesState","ChildLink","childLinkProps","childId","getPublishedId","_id","_type","ParameterizedLink","Fragment","closeCurrentAndAfter","handleEditReference","replaceCurrent","pane","closeCurrent","duplicateCurrent","setView","viewId","setParams","inspect","setPayload","navigateIntent","intentName","intentParams","PaneRouterContext","Provider","RootLayout","PaneLayout","Root","WrappedCode","Code","DocumentListPane","devMode","ids","schemaTypeName","errorParams","setErrorParams","useState","handleRetry","useEffect","flex","overflow","radius","Label","ErrorBoundary","onCatch","DeskToolProvider","direction","DeskDocumentListPane","itemId","paneKey","DocumentListPanel","DocumentPane","onFocusPath","paneDocumentNode","setLayoutCollapsed","useDeskTool","handleRootCollapse","handleRootExpand","style","onExpand","onCollapse","DeskDocumentPane","DocumentPanel","onDocumentChange","editState","useEditState","documentValue","draft","published","handleFocusPath","path","ContentEditor","document","defineListenerContext","createContext","IsEnabledContext","warnedAboutCrossDatasetReference","turboChargeResultIfSourceMap","liveDocument","projectId","dataset","result","perspective","resultSourceMap","applySourceDocuments","sourceDocument","_projectId","unstable__getDocumentCacheKey","unstable__documentsCache","get","changedValue","previousValue","getQueryCacheKey","query","JSON","stringify","LiveStoreProvider","memo","client","refreshInterval","subscriptions","setSubscriptions","snapshots","Map","hooks","cache","subscribe","listener","has","set","listeners","Set","prevSubscriptions","hook","TypeError","add","delete","sub","useHooks","initialSnapshot","onStoreChange","unsubscribe","getSnapshot","turboIds","setTurboIds","turboIdsFromSourceMap","contentSourceMap","nextTurboIds","documents","prevTurboIds","mergedTurboIds","sort","Context","Turbo","QuerySubscription","displayName","LiveStoreProvider$1","setError","revalidate","startRefresh","s","onLine","e4","n2","visibilityState","d","c","f","e3","useRevalidate","shouldRefetch","fulfilled","fetching","controller","AbortController","onFinally","async","signal","fetch","tag","filterResponse","aborted","values","effect","catch","name","finally","abort","snapshot","nextTurboIdsSnapshot","batch","setBatch","batchSet","flat","nextBatch","turboId","nextBatchSlice","LIVE_QUERY_CACHE_BATCH_SIZE","prevBatch","lastMutatedDocumentId","setLastMutatedDocumentId","subscription","listen","events","effectFormat","includePreviousRevision","includeResult","update","effects","apply","cachedDocument","peek","patchDoc","_rev","patchedDocument","applyPatch","updatedKeys","updatedKey","lastDraftDocumentRev","setLastDraftDocumentRev","GetDocuments","missingIds","getDocuments","then","doc","useLiveQuery","initialData","queryParams2","defineStore","queryParams","parse","useQueryParams","store","serverSnapshot","getServerSnapshot","useSyncExternalStore","LoaderQueries","activePerspective","liveQueries","studioClient","useClient","apiVersion","clientConfig","withConfig","PanelsContext","div","Panel","defaultSize","minWidth","maxWidth","order","getPanelStyle","registerElement","unregisterElement","useLayoutEffect","Resizer","ResizerInner","$disabled","PanelResizer","propId","disabled","el","useRef","current","usePanelId","activeResizer","drag","startDragging","stopDragging","isDragging","onMouseDown","event","nativeEvent","onDrag","onDragStop","blur","debounce","fn","timeout","timer","itemKey","getStoredItem","localStorage","getItem","getKeyForPanels","panels","panel","usePanelsStorage","widths","setItem","setStoredItem","setDebounced","getNextWidth","nextWidth","containerWidth","maxWidthPx","minWidthPx","Math","min","max","getPanelWidth","findIndex","toPrecision","getOffset","handleElement","initialOffset","initialHandleElementRect","clientX","getBoundingClientRect","left","isPanel","element","isResizer","getSortedElements","elements","a","b","validateWidths","widthsToValidate","total","remainingWidth","toFixed","abs","PanelsWrapper","Panels","panelsEl","setElements","setWidths","setActiveResizer","panelsRef","flexGrow","pointerEvents","prev","dragRef","innerWidth","dragOffset","panelAfter","panelBefore","resizerIndex","resizerRect","startX","elementsArr","resizer","resizeElement","acc","pageX","preventDefault","stopPropagation","prevWidths","nextWidths","delta","panelsState","initialDragState","initialWidths","pivotPanel","deltaApplied","localeCompare","numeric","getNextWidths","widthsChanged","prevWidth","storage","storedWidths","validatedStoredWidths","defaultWidths","panelsWithoutWidth","remainingWidthTotal","widthsWithNulls","defaultWidth","getDefaultWidths","resizeObserver","ResizeObserver","observe","disconnect","HoldEditState","PresentationNavigateProvider","navigate","PresentationNavigateContext","usePresentationNavigator","unstable_navigator","navigatorProvided","component","_navigatorEnabled","setNavigatorEnabled","defaultValue","setValue","useLocalState","navigatorEnabled","toggleNavigator","enabled","Component","Navigator","NavigatorComponent","navigatorDisabled","PresentationParamsProvider","PresentationParamsContext","PresentationProvider","IFrame","motion","iframe","PreviewLocationInput","basePath","useActiveWorkspace","activeWorkspace","onChange","openPopup","unstable_showUnsafeShareUrl","inputRef","sessionValue","setSessionValue","customValidity","setCustomValidity","handleChange","currentTarget","handleOpenPopup","href","handleKeyDown","absoluteValue","nextValue","handleBlur","resetButton","icon","ResetIcon","TextInput","clearButton","onBlur","onClear","onKeyDownCapture","zIndex","suffix","lineHeight","as","LaunchIcon","rel","MotionFlex","StyledSwitch","Switch","PERSPECTIVE_TITLES","previewDrafts","raw","PERSPECTIVE_TONES","PERSPECTIVE_ICONS","EditIcon","PublishIcon","DatabaseIcon","PreviewFrame","initialUrl","onPathChange","overlayEnabled","setPerspective","toggleOverlay","loadersConnection","overlaysConnection","previewKitConnection","setMode","prefersReducedMotion","usePrefersReducedMotion","setDesktopMode","setMobileMode","loading","setLoading","timedOut","setTimedOut","refreshing","setRefreshing","somethingIsWrong","setSomethingIsWrong","iframeIsBusy","previewLocationOrigin","location","handleRefresh","src","handleContinueAnyway","setContinueAnyway","continueAnyway","showOverlaysConnectionStatus","setShowOverlaysConnectionState","MAX_TIME_TO_OVERLAYS_CONNECTION","M","previewLocationRoute","URL","pathname","search","onIFrameLoad","MotionConfig","transition","duration","TooltipDelayGroupProvider","delay","shadow","position","gap","minHeight","Tooltip","animate","content","fallbackPlacements","placement","portal","PanelLeftIcon","selected","whiteSpace","paddingY","Hotkeys","keys","marginTop","marginBottom","borderRadius","userSelect","margin","checked","RefreshIcon","MenuButton","button","iconRight","ShareIcon","menu","Menu","ShareUrlMenuItems","popover","constrainSize","ChevronDownIcon","MenuItem","pressed","createElement","opacity","CheckmarkIcon","DesktopIcon","MobileDeviceIcon","cursor","AnimatePresence","initial","exit","variants","errorVariants","background","inset","borderTop","boxShadow","spinnerVariants","sizes","Spinner","backdropFilter","WebkitBackdropFilter","WebkitTransition","iframeVariants","onLoad","desktop","mobile","scale","idle","reloading","active","CopyUrlMenuButton","pushToast","useToast","API_VERSION","currentUser","useCurrentUser","setDisabled","clipboard","closable","url","onError","description","hasSecretSearchParams","ClipboardItem","item","previewUrlSecret","createPreviewSecret","newUrl","setSecretSearchParams","secret","Blob","resolvePreviewUrl","write","writeText","CopyIcon","parseId","rawId","segments","decodeURIComponent","split","parsePath","rawPath","studioPath","exec","Number","_key","urlStringToPath","parseRouterState","pruneObject","useParams","initialPreviewUrl","routerNavigate","setParamsState","rev","since","template","view","pathKey","instruction","comment","newParams","nextState","previewRef","previousPreview","pathToUrlString","fromString","searchParams","replace","usePreviewUrl","toolName","previewSearchParam","workspace","deps","workspaceName","resolveUUID","useSuspendCacheKeys","secretLastExpiredAt","setSecretLastExpiredAt","suspend","startTransition","expiresAt","getTime","Date","now","usePreviewUrlSecret","resolvedUrl","resultUrl","restoredUrl","referrer","referrerUrl","studioBasePath","Symbol","exports","_previewUrl","components","tool","DEFAULT_TOOL_NAME","option","hostname","iframeRef","setChannel","setLiveQueries","documentsOnPage","setDocumentsOnPage","setState","changed","getKey","knownKeys","perspective2","documentsOnPageMap","useDocumentsOnPage","setOverlayEnabled","useProjectId","useDataset","idRef","preloadRefs","setPreloadRefs","p","concat","setOverlaysConnection","setLoadersConnection","setPreviewKitConnection","popups","source","open","closed","addSource","contentWindow","nextChannel","sources","sendToSource","WeakMap","destroySource","destroyMany","sendToMany","prevConnectTo","createChannelsController","isInitialNavigation","MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL","receivedAt","liveQuery","nextDocumentId","nextPath","handlePreviewPath","handleDeskParams","setLiveDocument","handleKeyUp","isAltKey","handleKeydown","isHotkey","boundaryElement","setBoundaryElement","PresentationNavigator","BoundaryElementProvider"],"mappings":"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","x_google_ignoreList":[0,1,2,3]}